<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ•´ç†reacté‡Œé¢é‚£äº›å®¹æ˜“è®©äººæ··æ·†çš„æ¦‚å¿µ ğŸ˜‚</title>
      <link href="/2023/04/19/%E6%95%B4%E7%90%86react%E9%87%8C%E9%9D%A2%E9%82%A3%E4%BA%9B%E5%AE%B9%E6%98%93%E8%AE%A9%E4%BA%BA%E6%B7%B7%E6%B7%86%E7%9A%84%E6%A6%82%E5%BF%B5-u-1F602/"/>
      <url>/2023/04/19/%E6%95%B4%E7%90%86react%E9%87%8C%E9%9D%A2%E9%82%A3%E4%BA%9B%E5%AE%B9%E6%98%93%E8%AE%A9%E4%BA%BA%E6%B7%B7%E6%B7%86%E7%9A%84%E6%A6%82%E5%BF%B5-u-1F602/</url>
      
        <content type="html"><![CDATA[<h1 id="reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber"><a href="#reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber" class="headerlink" title="reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber"></a>reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber</h1><p>åœ¨è§£é‡Šä¸ºä»€ä¹ˆä¹‹å‰ï¼Œå…ˆæ¥è¯´ä¸€è¯´react16ä¹‹å‰ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Child componentWillMount&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Child render&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>child<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Child componentDidMount&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentWillReceiveProps</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Child componentWillReceiveProps&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">shouldComponentUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Child shouldComponentUpdate&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentWillUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Child componentWillUpdate&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Child componentDidUpdate&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">count</span>:<span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Child</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-xml">                        this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                            count: this.state.count + 1</span></span><br><span class="line"><span class="language-xml">                        &#125;)</span></span><br><span class="line"><span class="language-xml">                    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                        add</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;this.state.count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ç”¨react15æ¥è¿è¡Œï¼Œchildç»„ä»¶æ²¡æœ‰stateä¸propsï¼Œä½†æ˜¯éšç€Appç»„ä»¶çš„æ›´æ–°ï¼ˆç‚¹å‡»addæŒ‰é’®ï¼‰ï¼Œchildç»„ä»¶ä¹Ÿè·Ÿç€æ›´æ–°äº†ï¼ˆè§¦å‘äº†componentWillReceivePropsã€shouldComponentUpdateã€componentWillUpdateã€renderä¸componentDidUpdateï¼‰ï¼Œè¿™æ˜¾ç„¶ä¸åˆç†ï¼Œä¸‡ä¸€childç»„ä»¶å¾ˆå¤§å‘¢ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œreact16ä¹‹å‰å¯ä»¥ä½¿ç”¨shouldComponentUpdateæ¥é˜»æ­¢ç»„ä»¶ä¸å¿…è¦çš„æ›´æ–°ã€‚</p><p>è™½ç„¶shouldComponentUpdateå¯ä»¥è§£å†³è¿™ç§æƒ…å†µï¼Œä½†æ˜¯è¿™ç§ç°è±¡æš´éœ²äº†reactçš„ä¸€ä¸ªå¼Šç«¯ï¼Œçˆ¶ç»„ä»¶æ›´æ–°ï¼Œå­ç»„ä»¶ä¹Ÿä¼šæ— è„‘æ›´æ–°ï¼Œé™¤éè°ƒç”¨shouldComponentUpdateï¼Œä¸ºä»€ä¹ˆvueæ²¡æœ‰è¿™ç§å¼Šç«¯ï¼ŒåŸå› å°±æ˜¯vueæœ‰å“åº”å¼ç³»ç»Ÿï¼Œæ‰€ä»¥vueå¯ä»¥å¾ˆæ˜ç¡®çš„çŸ¥é“å“ªäº›ä¾èµ–éœ€è¦æ›´æ–°ï¼Œè€Œä¸éœ€è¦é‡æ–°renderæ•´æ£µæ ‘ã€‚æœ‰äº›æƒ…å†µå¯ä»¥ç”¨shouldComponentUpdateè§„é¿æ‰æ— ç”¨æ›´æ–°ï¼Œä½†æ˜¯reactè‚¯å®šæœ‰æœºä¼šé‡æ–°renderä¸€é¢—å·¨å¤§çš„æ ‘ã€‚æˆ‘ä»¬çŸ¥é“reactç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ï¼Œå…ˆè°ƒç”¨renderï¼Œç”Ÿæˆæ–°çš„è™šæ‹Ÿdomï¼Œç„¶åæ‰§è¡Œdiffç®—æ³•ï¼Œæ¯”å¯¹æ–°æ—§è™šæ‹Ÿdomä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œæœ€åä½œç”¨åˆ°çœŸå®domä¸Šã€‚åœ¨è¿™äº›æ­¥éª¤ä¸­ï¼Œå‡å¦‚ç»„ä»¶æ ‘å¾ˆå¤§ï¼Œdiffç®—æ³•åˆ™éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚javascriptæ˜¯å•çº¿ç¨‹è¯­è¨€ï¼Œé•¿æ—¶é—´çš„diffä¼šå¡ä½ä¸»çº¿ç¨‹ï¼Œè¿™ç§ç°è±¡åœ¨react16ä¹‹å‰æ˜¯æ²¡åŠæ³•è§£å†³çš„ã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œreact16å¼•å…¥äº†fiberï¼Œé¦–å…ˆè¯´è¯´ä»€ä¹ˆæ˜¯fiberï¼Œfiberæ˜¯ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥æè¿°ä¸€ä¸ªè™šæ‹Ÿdomï¼Œå‡å¦‚æœ‰ä»¥ä¸‹æ ‘å½¢ç»“æ„<br><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/0193a7ad-6941-4d1c-a999-b556be454daa-image.png" alt="0193a7ad-6941-4d1c-a999-b556be454daa-image.png"></p><p>react16ä¹‹å‰è¿™ä¹ˆæè¿°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnodes = &#123;</span><br><span class="line">    <span class="attr">key</span>:<span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="attr">children</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">key</span>:<span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">            <span class="attr">children</span>:[</span><br><span class="line">                &#123;<span class="attr">key</span>: <span class="string">&#x27;3&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">key</span>: <span class="string">&#x27;4&#x27;</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">key</span>:<span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">            <span class="attr">children</span>:[</span><br><span class="line">                &#123;<span class="attr">key</span>: <span class="string">&#x27;6&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">key</span>: <span class="string">&#x27;7&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">key</span>: <span class="string">&#x27;8&#x27;</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>react16ä¹‹åè¿™ä¹ˆæè¿°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnodes = &#123;</span><br><span class="line">    <span class="attr">key</span>:<span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="attr">child</span>:&#123;</span><br><span class="line">        <span class="attr">key</span>:<span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">        <span class="attr">parent</span>:<span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="attr">child</span>:&#123;</span><br><span class="line">            <span class="attr">key</span>:<span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">            <span class="attr">parent</span>:<span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">            <span class="attr">sibling</span>:&#123;</span><br><span class="line">                <span class="attr">key</span>:<span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">                <span class="attr">parent</span>:<span class="string">&#x27;2&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">sibling</span>:&#123;</span><br><span class="line">            <span class="attr">key</span>:<span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">            <span class="attr">parent</span>:<span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">            <span class="attr">child</span>:&#123;</span><br><span class="line">                <span class="attr">key</span>:<span class="string">&#x27;6&#x27;</span>,</span><br><span class="line">                <span class="attr">parent</span>:<span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">                <span class="attr">sibling</span>:&#123;</span><br><span class="line">                    <span class="attr">key</span>:<span class="string">&#x27;7&#x27;</span>,</span><br><span class="line">                    <span class="attr">parent</span>:<span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">                    <span class="attr">sibling</span>:&#123;</span><br><span class="line">                        <span class="attr">key</span>:<span class="string">&#x27;8&#x27;</span>,</span><br><span class="line">                        <span class="attr">parent</span>:<span class="string">&#x27;5&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”åŒä¸€å¼ å›¾çš„ä¸¤ç§vnodesï¼Œå¾ˆæ˜æ˜¾ï¼Œç¬¬ä¸€ä¸ªvnodesåœ¨diffçš„è¿‡ç¨‹ä¸­æ˜¯æ²¡æ³•æš‚åœçš„ï¼Œå› ä¸ºå®ƒæ¯ä¸ªèŠ‚ç‚¹åªæœ‰childrenï¼Œç¬¬äºŒä¸ªvnodesæ¯ä¸ªèŠ‚ç‚¹çš„æè¿°éƒ½åŒ…å«è‡ªå·±ä¸å…¶ä»–èŠ‚ç‚¹çš„å…³ç³»ï¼Œè¿™æ ·å³ä½¿diffæš‚åœï¼Œä¸‹æ¬¡ç»§ç»­æ—¶ä¹Ÿèƒ½æ‰¾åˆ°æœªå®Œæˆçš„èŠ‚ç‚¹ã€‚</p><p>react16ä»¥åå¼•å…¥äº†è°ƒåº¦å™¨çš„æ¦‚å¿µï¼Œå®ƒçš„ä½œç”¨æ˜¯ç»™ä»»åŠ¡åˆ†çº§ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ç”±ç”¨æˆ·è§¦å‘çš„æ›´æ–°ä¼˜å…ˆçº§æ˜¯å¤§äºç»„ä»¶æ›´æ–°çš„ï¼Œå‡å¦‚reactæ­£åœ¨æ›´æ–°ä¸€ä¸ªå¤§ç»„ä»¶ï¼Œdiffç®—æ³•æ­£åœ¨å¦‚ç«å¦‚è¼çš„å·¥ä½œï¼Œè¿™æ—¶ç”¨æˆ·ç‚¹å‡»äº†æŸä¸ªæŒ‰é’®è¦æ±‚æ˜¾ç¤ºä¸€ä¸ªæç¤ºï¼Œé‚£è¿™ä¸ªæ›´æ–°çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œreactä¼šæš‚åœå¤§ç»„ä»¶çš„æ›´æ–°ï¼ˆä¾èµ–äºfiberèŠ‚ç‚¹çš„å¯æš‚åœç»“æ„ï¼‰ï¼Œå…ˆå»å“åº”æŒ‰é’®çš„æç¤ºï¼Œå®Œäº†ç»§ç»­å¤§ç»„ä»¶çš„æ›´æ–°ï¼Œreactç”¨è¿™ç§æœºåˆ¶æ¥è§£å†³æ›´æ–°å¤§ç»„ä»¶ä¸»çº¿ç¨‹æ²¡æœ‰å“åº”çš„é—®é¢˜ã€‚</p><h1 id="å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–"><a href="#å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–" class="headerlink" title="å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–"></a>å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–</h1><h2 id="renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ"></a>renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ä¸Šé¢è¯´ç»„ä»¶æ›´æ–°å¯ä»¥è¢«æš‚åœï¼Œé‚£ä¼šä¸ä¼šå‡ºç°ç•Œé¢æ›´æ–°ä¸€åŠçš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸ä¼šå‡ºç°çš„ï¼ŒåŸå› æ˜¯ï¼Œreact16ä¹‹åï¼Œç»„ä»¶æ›´æ–°è¢«åˆ†ä¸ºrenderé˜¶æ®µä¸commité˜¶æ®µï¼Œrenderé˜¶æ®µåŒ…æ‹¬renderå‡½æ•°çš„æ‰§è¡Œï¼Œdiffç®—æ³•çš„æ‰§è¡Œï¼Œä¸€æ—¦diffç®—æ³•æ‰§è¡Œå®Œæ¯•ï¼Œç»„ä»¶å¼€å§‹æ›´æ–°çœŸå®domï¼Œå°±è¿›å…¥äº†commité˜¶æ®µï¼Œrenderé˜¶æ®µå¯ä»¥è¢«åå¤æ‰§è¡Œï¼ˆå¯ä¸­æ–­ï¼Œå¯ç»§ç»­ï¼‰ï¼Œè€Œcommité˜¶æ®µæ¯æ¬¡æ›´æ–°åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°domæ¸²æŸ“ä¸€åŠçš„æƒ…å†µã€‚</p><p>é‚£å“ªäº›ç”Ÿå‘½å‘¨æœŸå±äºrenderé˜¶æ®µï¼Œå“ªäº›å±äºcommité˜¶æ®µï¼Œé¦–å…ˆrenderå‡½æ•°è‚¯å®šæ˜¯åœ¨renderé˜¶æ®µæ‰§è¡Œçš„ï¼Œå› ä¸ºrenderå‡½æ•°çš„ä½œç”¨å°±æ˜¯ç”Ÿæˆè™šæ‹Ÿdomï¼Œå®Œäº†æ‰æ˜¯diffç»„ä»¶ä»¥åŠæ›´æ–°çœŸå®domçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥è‚¯å®šrenderå‡½æ•°ä»¥åŠå®ƒä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½å±äºrenderé˜¶æ®µã€‚ä¹‹å‰è¯´è¿‡renderé˜¶æ®µçš„ä»£ç æ˜¯å¯ä»¥è¢«åå¤æ‰§è¡Œçš„ï¼Œè¿™å°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚åœ¨componentWillReceivePropsã€componentWillUpdateè¿™äº›å‡½æ•°å†…æ‰§è¡Œäº†æŸäº›å‰¯ä½œç”¨ä»£ç ï¼Œè¿™ç§ç”Ÿå‘½å‘¨æœŸè¢«åå¤è°ƒç”¨çš„æœºåˆ¶å°±ä¼šå¯¼è‡´å‰¯ä½œç”¨è¢«åå¤æ‰§è¡Œï¼Œè¿™æ˜¾ç„¶ä¸å¯¹ï¼Œreactä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œå¯¹renderé˜¶æ®µçš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸè¿›è¡Œäº†æ”¹é€ ï¼Œå…¶å®ä¸»è¦é‡‡å–äº†ä¸¤ç§æ”¹é€ æ‰‹æ®µï¼š</p><ol><li>æŠŠå®ä¾‹æ–¹æ³•æ”¹æˆé™æ€æ–¹æ³•ï¼Œæ¯”å¦‚æŠŠcomponentWillReceivePropsæ”¹æˆstatic getDerivedStateFromPropsï¼Œè¿™æ ·æ”¹çš„ç›®çš„å°±æ˜¯ä¸è®©è®¿é—®thisï¼Œä¸€ä¸ªçº¯å‡½æ•°è¢«åå¤æ‰§è¡Œå…¶å®æ²¡ä»€ä¹ˆä¸å¥½ã€‚</li><li>æ ‡è®°æŸäº›æ–¹æ³•æ˜¯ä¸å®‰å…¨çš„ï¼Œéšç€ç‰ˆæœ¬çš„å‡çº§ï¼Œé€æ­¥åºŸå¼ƒã€‚</li></ol><p>åº†å¹¸çš„æ˜¯ï¼ŒshouldComponentUpdateè¿™ä¸ªæ–¹æ³•é€ƒè¿‡ä¸€åŠ«ï¼ŒåŸå› å¯èƒ½æ˜¯è¿™ä¸ªæ–¹æ³•è¯­ä¹‰å¤ªæ˜æ˜¾äº†ï¼Œå¤§æ¦‚æ²¡æœ‰ä»€ä¹ˆäººåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æ‰§è¡Œå‰¯ä½œç”¨ä»£ç ã€‚</p><h2 id="commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ"></a>commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ä¸Šé¢è¯´renderå‡½æ•°ä»¥åŠä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½å±äºrenderé˜¶æ®µï¼Œé‚£commité˜¶æ®µå‘¢ï¼Œæœ‰äººä¼šè¯´componentWillUpdateï¼Ÿå¾ˆé—æ†¾ï¼Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸä¹Ÿå±äºrenderé˜¶æ®µï¼Œå¹¶ä¸”react16ä»¥åè¢«æ‰“ä¸Šäº†ä¸å®‰å…¨çš„æ ‡è®°ï¼Œé‚£æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥çŸ¥é“æ›´æ–°è¿›å…¥äº†commité˜¶æ®µï¼Œreact16æ–°åŠ äº†getSnapshotBeforeUpdateï¼Œåˆ«çœ‹è¿™ä¸ªæ–¹æ³•çš„å‘½åä¹Ÿæ˜¯getxxxä¹‹ç±»çš„é£æ ¼ï¼Œå®ƒå´æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆreactè¿™æ¬¡è®©äººå¤§æ–¹çš„è®¿é—®thisï¼ŒåŸå› åœ¨äºæ›´æ–°å·²ç»è¿›å…¥commité˜¶æ®µï¼Œå³ä½¿æœ‰å‰¯ä½œç”¨ä¹Ÿåªæ‰§è¡Œä¸€æ¬¡æ²¡ä»€ä¹ˆä¸å¥½ã€‚</p><p>getSnapshotBeforeUpdateè¿™ä¸ªæ–¹æ³•ä¼šåœ¨diffç»“æŸï¼ˆæ˜¯ç»“æŸä¸æ˜¯ä¸­æ–­ï¼‰ï¼Œå·²ç»çŸ¥é“å“ªäº›doméœ€è¦æ›´æ–°ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¢«æ›´æ–°çš„æ—¶å€™è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç¨³å®šçš„è·å–æ›´æ–°å‰çš„domçŠ¶æ€ã€‚</p><h2 id="æ•è·error"><a href="#æ•è·error" class="headerlink" title="æ•è·error"></a>æ•è·error</h2><p>react16ä»¥åæ–°å¢äº†ä¸€ä¸ªå«getDerivedStateFromErrorçš„ç”Ÿå‘½å‘¨æœŸï¼Œä»è¿™ä¸ªå‡½æ•°çš„åå­—æ¥çœ‹å¾ˆåƒgetDerivedStateFromPropsï¼Œæ²¡é”™å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå°±æ˜¯ä¸è®©ä½ è®¿é—®thisã€‚react16ä¹‹å‰æ˜¯æ€ä¹ˆæ•è·é”™è¯¯å‘¢ï¼Œæœ‰ä¸€ä¸ªå«componentDidCatchçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨react16ä»¥åä¹Ÿä¸€ç›´ä¿ç•™ï¼Œä¸ºä»€ä¹ˆå‡ºç°æ—¢ç”Ÿç‘œä½•ç”Ÿäº®çš„åœºé¢ï¼ŒåŸå› åœ¨äºè¿™ä¿©æ–¹æ³•çš„èŒè´£ä¸åŒï¼Œä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; count, onClick &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">if</span> (count &lt; <span class="number">5</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;getDerivedStateFromError has error&quot;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentDidCatch</span>(<span class="params">error, info</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidCatch has error&quot;</span>, error, info);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>app<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Child</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">count</span>=<span class="string">&#123;this.state.count&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                        this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                            count: this.state.count + 1</span></span><br><span class="line"><span class="language-xml">                        &#125;);</span></span><br><span class="line"><span class="language-xml">                    &#125;&#125;</span></span><br><span class="line"><span class="language-xml">                /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">// react18.2.0</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨å­ç»„ä»¶çš„renderå‡½æ•°é‡Œé¢æŠ›ä¸€ä¸ªé”™ï¼Œç»“æœå‘ç°åªæœ‰getDerivedStateFromErrorå“åº”äº†ï¼Œæˆ‘ä»¬æ¢ä¸ªä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidCatch</span>(<span class="params">error, info</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidCatch has error&quot;</span>, error);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;getDerivedStateFromError has error&quot;</span>, error);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">hasError</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Something went wrong.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">children</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">value</span>: <span class="number">0</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">value</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;I crashed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">value</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">value</span> + <span class="number">1</span> &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>&#123;this.state.value&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125; <span class="comment">// react18.2.0</span></span><br></pre></td></tr></table></figure><p>åœ¨å­ç»„ä»¶çš„componentDidUpdateï¼ˆcommité˜¶æ®µï¼‰é‡Œé¢æŠ›ä¸ªé”™ï¼Œç»“æœgetDerivedStateFromErrorä¸componentDidCatchéƒ½å“åº”äº†ã€‚</p><p>å¯¹æ¯”è¿™ä¸¤ä¸ªä¾‹å­ä½ ä¼šå‘ç°ï¼ŒreactæŠŠæ•è·é”™è¯¯è¿™ä¸ªè¡Œä¸ºåˆ†ä¸ºæœ‰å‰¯ä½œç”¨çš„æ•è·ä¸æ— å‰¯ä½œç”¨çš„æ•è·ï¼Œåƒåœ¨renderå‡½æ•°é‡Œé¢å‘ç”Ÿçš„é”™è¯¯ï¼Œrenderå‡½æ•°å¤„äºrenderé˜¶æ®µï¼Œreactè‚¯å®šä¸å¸Œæœ›å¼€å‘è€…è®¿é—®thisï¼Œæ‰€ä»¥ç†æ‰€å½“ç„¶çš„åªæœ‰getDerivedStateFromErrorå“åº”ï¼Œè€Œåœ¨componentDidUpdateé‡Œé¢æŠ›çš„é”™ï¼Œç”±äºå·²ç»å¤„äºcommité˜¶æ®µï¼Œå¼€å‘è€…æƒ³å¹²ä»€ä¹ˆreactä¸ä¼šå»å¹²é¢„ï¼Œè¿™æ—¶çš„æ•è·é”™è¯¯çš„è¡Œä¸ºå¯èƒ½æ˜¯çº¯çš„ä¹Ÿå¯èƒ½æ˜¯ä¸çº¯çš„ï¼Œæ‰€ä»¥ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šå“åº”ã€‚</p><h2 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a>Suspense</h2><h2 id="hooks"><a href="#hooks" class="headerlink" title="hooks"></a>hooks</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ ahooksä¹‹useLongPress</title>
      <link href="/2023/03/17/%E5%AD%A6%E4%B9%A0ahooks%E4%B9%8BuseLongPress/"/>
      <url>/2023/03/17/%E5%AD%A6%E4%B9%A0ahooks%E4%B9%8BuseLongPress/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¼˜ç”±"><a href="#ç¼˜ç”±" class="headerlink" title="ç¼˜ç”±"></a>ç¼˜ç”±</h1><p>å¯èƒ½æ˜¯å°ç¨‹åºapiç”¨å¤šäº†ï¼Œå‰å‡ å¤©å†™ç½‘é¡µæœ‰ä¸ªéœ€æ±‚æ˜¯ç›‘å¬é•¿æŒ‰ï¼Œç«Ÿç„¶æœ‰ç‚¹ç”Ÿç–ï¼Œå¹¸å¥½ahookså®ç°äº†useLongPressè¿™ä¸ªhookã€‚</p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useLongPress/index.ts">åŸç‰ˆä»£ç </a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> touchSupported =</span><br><span class="line">  isBrowser &amp;&amp;</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  (<span class="string">&#x27;ontouchstart&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span> || (<span class="variable language_">window</span>.<span class="property">DocumentTouch</span> &amp;&amp; <span class="variable language_">document</span> <span class="keyword">instanceof</span> <span class="title class_">DocumentTouch</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useLongPress</span>(<span class="params"></span></span><br><span class="line"><span class="params">  onLongPress: (event: EventType) =&gt; <span class="keyword">void</span>,</span></span><br><span class="line"><span class="params">  target: BasicTarget,</span></span><br><span class="line"><span class="params">  &#123; delay = <span class="number">300</span>, moveThreshold, onClick, onLongPressEnd &#125;: Options = &#123;&#125;,</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> onLongPressRef = <span class="title function_">useLatest</span>(onLongPress);</span><br><span class="line">  <span class="keyword">const</span> onClickRef = <span class="title function_">useLatest</span>(onClick);</span><br><span class="line">  <span class="keyword">const</span> onLongPressEndRef = <span class="title function_">useLatest</span>(onLongPressEnd);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> timerRef = useRef&lt;<span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> <span class="built_in">setTimeout</span>&gt;&gt;();</span><br><span class="line">  <span class="keyword">const</span> isTriggeredRef = <span class="title function_">useRef</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> pervPositionRef = <span class="title function_">useRef</span>(&#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> hasMoveThreshold = !!(</span><br><span class="line">    (moveThreshold?.<span class="property">x</span> &amp;&amp; moveThreshold.<span class="property">x</span> &gt; <span class="number">0</span>) ||</span><br><span class="line">    (moveThreshold?.<span class="property">y</span> &amp;&amp; moveThreshold.<span class="property">y</span> &gt; <span class="number">0</span>)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffectWithTarget</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> targetElement = <span class="title function_">getTargetElement</span>(target);</span><br><span class="line">      <span class="keyword">if</span> (!targetElement?.<span class="property">addEventListener</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">overThreshold</span> = (<span class="params">event: EventType</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; clientX, clientY &#125; = <span class="title function_">getClientPosition</span>(event);</span><br><span class="line">        <span class="keyword">const</span> offsetX = <span class="title class_">Math</span>.<span class="title function_">abs</span>(clientX - pervPositionRef.<span class="property">current</span>.<span class="property">x</span>);</span><br><span class="line">        <span class="keyword">const</span> offsetY = <span class="title class_">Math</span>.<span class="title function_">abs</span>(clientY - pervPositionRef.<span class="property">current</span>.<span class="property">y</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !!(</span><br><span class="line">          (moveThreshold?.<span class="property">x</span> &amp;&amp; offsetX &gt; moveThreshold.<span class="property">x</span>) ||</span><br><span class="line">          (moveThreshold?.<span class="property">y</span> &amp;&amp; offsetY &gt; moveThreshold.<span class="property">y</span>)</span><br><span class="line">        );</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">getClientPosition</span>(<span class="params">event: EventType</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> <span class="title class_">TouchEvent</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">clientX</span>: event.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">clientX</span>,</span><br><span class="line">            <span class="attr">clientY</span>: event.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">clientY</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> <span class="title class_">MouseEvent</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">clientX</span>: event.<span class="property">clientX</span>,</span><br><span class="line">            <span class="attr">clientY</span>: event.<span class="property">clientY</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;Unsupported event type&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">clientX</span>: <span class="number">0</span>, <span class="attr">clientY</span>: <span class="number">0</span> &#125;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">onStart</span> = (<span class="params">event: EventType</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasMoveThreshold) &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; clientX, clientY &#125; = <span class="title function_">getClientPosition</span>(event);</span><br><span class="line">          pervPositionRef.<span class="property">current</span>.<span class="property">x</span> = clientX;</span><br><span class="line">          pervPositionRef.<span class="property">current</span>.<span class="property">y</span> = clientY;</span><br><span class="line">        &#125;</span><br><span class="line">        timerRef.<span class="property">current</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          onLongPressRef.<span class="title function_">current</span>(event);</span><br><span class="line">          isTriggeredRef.<span class="property">current</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;, delay);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">onMove</span> = (<span class="params">event: TouchEvent</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (timerRef.<span class="property">current</span> &amp;&amp; <span class="title function_">overThreshold</span>(event)) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(timerRef.<span class="property">current</span>);</span><br><span class="line">          timerRef.<span class="property">current</span> = <span class="literal">undefined</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">onEnd</span> = (<span class="params">event: EventType, shouldTriggerClick: boolean = <span class="literal">false</span></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (timerRef.<span class="property">current</span>) &#123;</span><br><span class="line">          <span class="built_in">clearTimeout</span>(timerRef.<span class="property">current</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isTriggeredRef.<span class="property">current</span>) &#123;</span><br><span class="line">          onLongPressEndRef.<span class="property">current</span>?.(event);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (shouldTriggerClick &amp;&amp; !isTriggeredRef.<span class="property">current</span> &amp;&amp; onClickRef.<span class="property">current</span>) &#123;</span><br><span class="line">          onClickRef.<span class="title function_">current</span>(event);</span><br><span class="line">        &#125;</span><br><span class="line">        isTriggeredRef.<span class="property">current</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">onEndWithClick</span> = (<span class="params">event: EventType</span>) =&gt; <span class="title function_">onEnd</span>(event, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!touchSupported) &#123;</span><br><span class="line">        targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousedown&#x27;</span>, onStart);</span><br><span class="line">        targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseup&#x27;</span>, onEndWithClick);</span><br><span class="line">        targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseleave&#x27;</span>, onEnd);</span><br><span class="line">        <span class="keyword">if</span> (hasMoveThreshold) targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, onMove);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchstart&#x27;</span>, onStart);</span><br><span class="line">        targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchend&#x27;</span>, onEndWithClick);</span><br><span class="line">        <span class="keyword">if</span> (hasMoveThreshold) targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchmove&#x27;</span>, onMove);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (timerRef.<span class="property">current</span>) &#123;</span><br><span class="line">          <span class="built_in">clearTimeout</span>(timerRef.<span class="property">current</span>);</span><br><span class="line">          isTriggeredRef.<span class="property">current</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!touchSupported) &#123;</span><br><span class="line">          targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mousedown&#x27;</span>, onStart);</span><br><span class="line">          targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mouseup&#x27;</span>, onEndWithClick);</span><br><span class="line">          targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mouseleave&#x27;</span>, onEnd);</span><br><span class="line">          <span class="keyword">if</span> (hasMoveThreshold) targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, onMove);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;touchstart&#x27;</span>, onStart);</span><br><span class="line">          targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;touchend&#x27;</span>, onEndWithClick);</span><br><span class="line">          <span class="keyword">if</span> (hasMoveThreshold) targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;touchmove&#x27;</span>, onMove);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    [],</span><br><span class="line">    target,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆå¿½ç•¥ç§ç§ç»†èŠ‚ï¼ŒuseLongPressè¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š</p><ol><li>onLongPressï¼Œé¡¾åæ€ä¹‰ï¼Œè§¦å‘é•¿æŒ‰äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚</li><li>targetï¼šå¯ä»¥æ˜¯domå…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯å­˜å‚¨domå…ƒç´ çš„refã€‚</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸ªå¯¹è±¡ï¼Œæœ‰å››ä¸ªå­å‚æ•°ï¼šdelay(é•¿æŒ‰å¤šé•¿æ—¶é—´ä»¥åè§¦å‘é•¿æŒ‰äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è§¦å‘é•¿æŒ‰äº‹ä»¶çš„æ—¶é—´)ã€moveThresholdï¼ˆåœ¨é•¿æŒ‰çš„è¿‡ç¨‹ä¸­é¼ æ ‡æˆ–è€…æ‰‹æŒ‡å¦‚æœæœ‰ç§»åŠ¨ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼å­˜åœ¨ï¼Œä¼šæ ¹æ®è¿™ä¸ªå‚æ•°çš„å€¼å†³å®šæ˜¯å¦å“åº”é•¿æŒ‰äº‹ä»¶ï¼‰ã€onClick(å¦‚æœæœ‰è¿™ä¸ªå€¼ï¼Œå¹¶ä¸”é¼ æ ‡æˆ–è€…æ‰‹æŒ‡æŒ‰å‹ç»“æŸï¼Œå¹¶ä¸”æŒ‰å‹æ—¶é—´å°äºdelayï¼Œä¼šè°ƒç”¨onClickå‡½æ•°)ã€onLongPressEnd(å¦‚æœæŒ‰å‹ç»“æŸå·²ç»è§¦å‘è¿‡é•¿æŒ‰äº‹ä»¶ï¼Œåœ¨çœŸæ­£ç»“æŸçš„æ—¶å€™å¦‚æœæœ‰è¿™ä¸ªå€¼ä¼šè°ƒç”¨onLongPressEndå‡½æ•°)ã€‚</li></ol><p>ä»£ç å¼€å¤´é‚£ä¸ªuseEffectWithTargetå…ˆè®¤ä¸ºå°±æ˜¯useEffectï¼Œå…ˆå¿½ç•¥useEffectWithTargetå¤§å¤šæ•°ä»£ç ï¼Œç›´æ¥çœ‹è¿™å‡ å¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!touchSupported) &#123;</span><br><span class="line">    targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousedown&#x27;</span>, onStart);</span><br><span class="line">    targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseup&#x27;</span>, onEndWithClick);</span><br><span class="line">    targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseleave&#x27;</span>, onEnd);</span><br><span class="line">    <span class="keyword">if</span> (hasMoveThreshold) targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, onMove);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchstart&#x27;</span>, onStart);</span><br><span class="line">    targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchend&#x27;</span>, onEndWithClick);</span><br><span class="line">    <span class="keyword">if</span> (hasMoveThreshold) targetElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchmove&#x27;</span>, onMove);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (timerRef.<span class="property">current</span>) &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timerRef.<span class="property">current</span>);</span><br><span class="line">        isTriggeredRef.<span class="property">current</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!touchSupported) &#123;</span><br><span class="line">        targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mousedown&#x27;</span>, onStart);</span><br><span class="line">        targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mouseup&#x27;</span>, onEndWithClick);</span><br><span class="line">        targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mouseleave&#x27;</span>, onEnd);</span><br><span class="line">        <span class="keyword">if</span> (hasMoveThreshold) targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, onMove);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;touchstart&#x27;</span>, onStart);</span><br><span class="line">        targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;touchend&#x27;</span>, onEndWithClick);</span><br><span class="line">        <span class="keyword">if</span> (hasMoveThreshold) targetElement.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;touchmove&#x27;</span>, onMove);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ ¹æ®æ˜¯å¦æ”¯æŒè§¦æ‘¸äº‹ä»¶ï¼Œåˆ†åˆ«ç›‘å¬é¼ æ ‡æˆ–è€…touchäº‹ä»¶ï¼Œå“åº”çš„äº‹ä»¶å¾ˆæœ‰è§„å¾‹ï¼Œåªä¸è¿‡é¼ æ ‡äº‹ä»¶å¤šäº†ä¸ªmouseleaveï¼Œè¿™é‡Œæˆ‘è§‰å¾—touchäº‹ä»¶ä¹Ÿåº”è¯¥åŠ ä¸ªå¯¹åº”çš„ï¼Œæ¯”å¦‚touchcancelã€‚</p><p>onStart</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onStart</span> = (<span class="params">event: EventType</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (hasMoveThreshold) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;clientX, clientY&#125; = <span class="title function_">getClientPosition</span>(event);</span><br><span class="line">        pervPositionRef.<span class="property">current</span>.<span class="property">x</span> = clientX;</span><br><span class="line">        pervPositionRef.<span class="property">current</span>.<span class="property">y</span> = clientY;</span><br><span class="line">    &#125; <span class="comment">// å‡è®¾æ²¡æœ‰moveThresholdï¼Œè¿™ä¸€å¥å…ˆå¿½ç•¥</span></span><br><span class="line">    timerRef.<span class="property">current</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        onLongPressRef.<span class="title function_">current</span>(event);</span><br><span class="line">        isTriggeredRef.<span class="property">current</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;, delay); <span class="comment">//delayç§’åæ‰§è¡ŒonLongPressRef.currentï¼ŒisTriggeredRef.currentè¡¨ç¤ºæ˜¯å¦æ‰§è¡Œè¿‡onLongPress</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>onEndWithClick</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onEndWithClick</span> = (<span class="params">event: EventType</span>) =&gt; <span class="title function_">onEnd</span>(event, <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onEnd</span> = (<span class="params">event: EventType, shouldTriggerClick: boolean = <span class="literal">false</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (timerRef.<span class="property">current</span>) &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timerRef.<span class="property">current</span>); <span class="comment">//é¼ æ ‡æŠ¬èµ·æˆ–è€…è§¦æ‘¸ç»“æŸæ—¶ï¼Œå¦‚æœonLongPressè¿˜æ²¡æœ‰è°ƒç”¨ï¼Œæ¸…é™¤å®šæ—¶å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isTriggeredRef.<span class="property">current</span>) &#123; <span class="comment">//å¦‚æœonLongPresså·²ç»è¢«è°ƒç”¨è¿‡äº†ï¼Œè°ƒç”¨onLongPressEndï¼ˆå¦‚æœæœ‰ï¼‰</span></span><br><span class="line">        onLongPressEndRef.<span class="property">current</span>?.(event);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (shouldTriggerClick &amp;&amp; !isTriggeredRef.<span class="property">current</span> &amp;&amp; onClickRef.<span class="property">current</span>) &#123; </span><br><span class="line">        onClickRef.<span class="title function_">current</span>(event);</span><br><span class="line">    &#125; <span class="comment">// è¿™é‡Œçš„shouldTriggerClickä¸ºtrueï¼Œå¦‚æœonLongPressè¿˜æ²¡æœ‰è¢«è§¦å‘å¹¶ä¸”æœ‰onClickï¼Œè°ƒç”¨onClick</span></span><br><span class="line">    isTriggeredRef.<span class="property">current</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>onStartä¸onEndWithClickå…¶å®å°±æ˜¯onLongPresså‡½æ•°çš„æ ¸å¿ƒã€‚æœ‰æ—¶å€™æŒ‰å‹çš„æ—¶å€™ä¼šç§»åŠ¨ï¼Œè¿™æ—¶å€™æ˜¯å¦è§¦å‘longpressäº‹ä»¶ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦ä¼ moveThresholdã€‚</p><p>è¿™ä¸ªå€¼æ˜¯ä¸ªå¯¹è±¡{x:0,y:0}ï¼Œå¦‚æœæŒ‰å‹çš„è¿‡ç¨‹ä¸­æœ‰ç§»åŠ¨ï¼Œç§»åŠ¨çš„è·ç¦»(x&#x2F;y)å¤§äºmoveThreshold.xæˆ–è€…moveThreshold.yï¼Œå°±ä¼šå–æ¶ˆå“åº”longPressã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onMove</span> = (<span class="params">event: TouchEvent</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (timerRef.<span class="property">current</span> &amp;&amp; <span class="title function_">overThreshold</span>(event)) &#123; <span class="comment">//ç§»åŠ¨çš„æ—¶å€™è¿˜æ²¡æœ‰å“åº”longPressï¼Œå¹¶ä¸”ç§»åŠ¨çš„è·ç¦»è¶…äº†ï¼Œå°±ä¼šå–æ¶ˆå®šæ—¶å™¨</span></span><br><span class="line">        <span class="built_in">clearInterval</span>(timerRef.<span class="property">current</span>);</span><br><span class="line">        timerRef.<span class="property">current</span> = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯useLongPressçš„ä¸»è¦å†…å®¹ã€‚</p><h2 id="useEffectWithTarget"><a href="#useEffectWithTarget" class="headerlink" title="useEffectWithTarget"></a>useEffectWithTarget</h2><p>è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹è¿™ä¸ªhookï¼Œä»£ç åœ¨<a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/utils/createEffectWithTarget.ts">è¿™é‡Œ</a>ï¼Œçœ‹èµ·æ¥åŠŸèƒ½å’ŒuseEffectå·®ä¸å¤šï¼Œåªä¸è¿‡å¤šäº†å¯¹å‰ådomå…ƒç´ çš„å¯¹æ¯”ï¼Œ<a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/utils/createEffectWithTarget.ts#L42">ä»£ç </a>ï¼Œå‚æ•°ä¹Ÿç”±useEffectçš„ä¸¤ä¸ªå˜æˆäº†ä¸‰ä¸ªã€‚æˆ‘è§‰å¾—è¿™ä¸ªhookçš„æ„ä¹‰æ›´å¤šçš„åœ¨äºä»£ç çš„å¯è¯»æ€§ï¼Œç”±äºç¬¬ä¸‰ä¸ªå‚æ•°çš„å­˜åœ¨ï¼Œå¯ä»¥æ˜ç¡®è¡¨ç¤ºè¿™ä¸ªhookæ˜¯ä¸å“ªä¸ªdomå…ƒç´ ç›¸å…³è”ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>äº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦çš„åŒºåˆ«</title>
      <link href="/2023/03/06/%E4%BA%AE%E5%BA%A6%E3%80%81%E5%AF%B9%E6%AF%94%E5%BA%A6%E3%80%81%E9%A5%B1%E5%92%8C%E5%BA%A6%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2023/03/06/%E4%BA%AE%E5%BA%A6%E3%80%81%E5%AF%B9%E6%AF%94%E5%BA%A6%E3%80%81%E9%A5%B1%E5%92%8C%E5%BA%A6%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¼€å§‹ä¹‹å‰å…ˆçœ‹ç½‘ä¸Šå¯¹è¿™ä¸‰è€…çš„è§£é‡Šã€‚</p><p>äº®åº¦ã€å¯¹æ¯”åº¦å’Œé¥±å’Œåº¦æ˜¯å›¾åƒå¤„ç†ä¸­çš„ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µã€‚äº®åº¦æ˜¯æŒ‡å›¾åƒçš„æ˜äº®ç¨‹åº¦ï¼Œå¯¹æ¯”åº¦æ˜¯æŒ‡å›¾åƒä¸­æœ€äº®å’Œæœ€æš—éƒ¨åˆ†ä¹‹é—´çš„å·®å¼‚ï¼Œé¥±å’Œåº¦æ˜¯æŒ‡å›¾åƒä¸­é¢œè‰²çš„é²œè‰³ç¨‹åº¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹æ¯”åº¦è¶Šå¤§ï¼Œå›¾åƒè¶Šæ¸…æ™°é†’ç›®ï¼Œè‰²å½©ä¹Ÿè¶Šé²œæ˜è‰³ä¸½ï¼›è€Œå¯¹æ¯”åº¦å°ï¼Œåˆ™ä¼šè®©æ•´ä¸ªç”»é¢éƒ½ç°è’™è’™çš„ã€‚</p><p>çœ‹è¿™äº›æ–‡å­—å¹¶ä¸èƒ½å®Œå…¨ç†è§£è¿™ä¸‰è€…ï¼Œåè€Œå®¹æ˜“æ··æ·†ï¼Œçœ‹èµ·æ¥è¿™ä¸‰è€…éƒ½èƒ½è°ƒæ•´ç”»é¢çš„æ˜æš—ï¼Œä½†åˆæœ‰æ‰€ä¸åŒã€‚</p><p>ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œä»£ç è¯­è¨€æ˜¯æ¯”äººè¨€æ›´åŠ ç²¾ç¡®çš„ã€‚æ—¢ç„¶ç†è§£ä¸äº†æ–‡å­—ï¼Œå°±çœ‹ä»£ç å¦‚ä½•å®ç°ã€‚</p><h1 id="äº®åº¦"><a href="#äº®åº¦" class="headerlink" title="äº®åº¦"></a>äº®åº¦</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">adjustBrightness</span>(<span class="params">imageData, brightness</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = imageData.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">    data[i] = data[i] * brightness;</span><br><span class="line">    data[i + <span class="number">1</span>] = data[i + <span class="number">1</span>] * brightness;</span><br><span class="line">    data[i + <span class="number">2</span>] = data[i + <span class="number">2</span>] * brightness;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> imageData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ç»™rgbæ¯ä¸ªå€¼ä¹˜ä»¥ä¸€ä¸ªå¤§äº0çš„ç³»æ•°brightnessï¼Œbrightnesså¤§äº1å°±æ˜¯å¢åŠ äº®åº¦ï¼Œbrightnesså°äº1å°±æ˜¯é™ä½äº®åº¦ã€‚æ‰€ä»¥ç”¨ä¸€å¥è¯æ€»ç»“ï¼šè°ƒæ•´äº®åº¦å°±æ˜¯ç»™å›¾ç‰‡ä¸Šæ¯ä¸ªç‚¹åƒç´ çš„rgbå€¼åˆ†åˆ«ä¹˜ä»¥ä¸€ä¸ªç›¸åŒçš„ç³»æ•°ã€‚</p><h1 id="å¯¹æ¯”åº¦"><a href="#å¯¹æ¯”åº¦" class="headerlink" title="å¯¹æ¯”åº¦"></a>å¯¹æ¯”åº¦</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">adjustContrast</span>(<span class="params">imageData, contrast</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = imageData.<span class="property">data</span>;</span><br><span class="line">  <span class="keyword">const</span> factor = (<span class="number">259</span> * (contrast + <span class="number">255</span>)) / (<span class="number">255</span> * (<span class="number">259</span> - contrast));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">    data[i] = factor * (data[i] - <span class="number">128</span>) + <span class="number">128</span>;</span><br><span class="line">    data[i + <span class="number">1</span>] = factor * (data[i + <span class="number">1</span>] - <span class="number">128</span>) + <span class="number">128</span>;</span><br><span class="line">    data[i + <span class="number">2</span>] = factor * (data[i + <span class="number">2</span>] - <span class="number">128</span>) + <span class="number">128</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> imageData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä½“æ€è·¯å’Œè°ƒæ•´äº®åº¦å·®ä¸å¤šï¼Œéƒ½æ˜¯ç»™rgbåˆ†åˆ«ä¹˜ä»¥æŸä¸ªç³»æ•°ï¼Œä½†æ²¡é‚£ä¹ˆç®€å•ï¼Œä¸»è¦æ˜¯è¿™ä¸¤è¡Œè®©äººå¾ˆè´¹è§£ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">const</span> factor = (<span class="number">259</span> * (contrast + <span class="number">255</span>)) / (<span class="number">255</span> * (<span class="number">259</span> - contrast)); <span class="comment">// ä»£ç 1</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">data[i] = factor * (data[i] - <span class="number">128</span>) + <span class="number">128</span>; <span class="comment">// ä»£ç 2</span></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><h2 id="ä»£ç 1"><a href="#ä»£ç 1" class="headerlink" title="ä»£ç 1"></a>ä»£ç 1</h2><p>å…¬å¼ä¸­çš„255è¡¨ç¤ºrgbé¢œè‰²ç©ºé—´çš„æœ€å¤§å–å€¼ï¼Œ259æ˜¯ä¸€ä¸ªç»è¿‡åå¤è¯•éªŒå¾—å‡ºçš„æ•°å­—ï¼Œcontrastå–å€¼-255åˆ°255ï¼ŒæŠŠcontrastå¸¦å…¥è¿™ä¸ªå…¬å¼ï¼Œ259å¯ä»¥è®©è¿™ä¸ªå…¬å¼çš„å–å€¼èŒƒå›´æœ€æ¥è¿‘0åˆ°128ï¼Œè‡³äºæ•´ä¸ªå…¬å¼çš„æ¨å¯¼è¿‡ç¨‹ï¼Œæˆ‘ä¹Ÿæä¸æ¸…æ¥šã€‚</p><p>æˆ‘ä»¬å†™ä¸€äº›ä»£ç æ¥çœ‹ä¸€ä¸‹factorå…·ä½“éƒ½æœ‰å“ªäº›å€¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getFactor</span>(<span class="params">contrast</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="number">259</span> * (contrast + <span class="number">255</span>)) / (<span class="number">255</span> * (<span class="number">259</span> - contrast));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=-<span class="number">255</span>;i&lt;=<span class="number">255</span>;i++)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getFactor</span>(i))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è¿è¡Œç»“æœfactorå–å€¼ä»0åˆ°129.5ï¼Œ129.5è¶‹è¿‘128ï¼Œä½ å¯ä»¥è¯•ä¸€è¯•ï¼ŒæŠŠ259æ”¹æˆ258æˆ–è€…260ï¼Œç»“æœéƒ½ä¸è¶‹è¿‘128ã€‚</p><p>å…¶å®ç”¨åæ ‡ç³»è¡¨ç¤ºæ›´ä¸ºåˆé€‚ï¼šy&#x3D;(259*(x+255))&#x2F;(255*(259-x))</p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/817d9b1e-a8ef-4b65-916b-031c3e94169e-image.png" alt="817d9b1e-a8ef-4b65-916b-031c3e94169e-image.png"></p><p>æŠŠè¿™æ¡æ›²çº¿åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå¦‚æœ-255&lt;x&lt;0,0&lt;y&lt;1;å¦‚æœ0&lt;x&lt;255,1&lt;y&lt;128ã€‚</p><h2 id="ä»£ç 2"><a href="#ä»£ç 2" class="headerlink" title="ä»£ç 2"></a>ä»£ç 2</h2><p>å‡è®¾0&lt;x&lt;255ï¼Œyä»1åˆ°128ï¼ŒæŠŠyå¸¦å…¥ä»£ç 2ã€‚å¸¦å…¥ä¹‹å‰å…ˆè§£é‡Šä¸€ä¸‹ä»£ç 2ï¼Œrgbé¢œè‰²ç©ºé—´çš„å–å€¼èŒƒå›´æ˜¯0-255ï¼Œ128æ˜¯ä¸­ç‚¹ï¼Œä¹‹æ‰€ä»¥å…ˆç”¨è‰²å€¼å‡å»128ï¼Œæ˜¯ä¸ºäº†åˆ¤æ–­è‰²å€¼çš„å¼ºå¼±ï¼Œä½äº128å·¦è¾¹çš„è‰²å€¼å¼±ï¼Œåä¹‹åˆ™å¼ºï¼Œç”±äºfactorå–å€¼1åˆ°128ï¼Œæ­£æ•°ä¹˜ä»¥factorï¼Œç»“æœæ˜¯æ¯”åŸå€¼è¿˜å¤§çš„æ­£æ•°ï¼Œè´Ÿæ•°ä¹˜ä»¥factorï¼Œç»“æœæ˜¯æ¯”åŸå€¼è¿˜å°çš„è´Ÿæ•°ã€‚</p><p>æ‰€ä»¥å¦‚æœx(å¯¹æ¯”åº¦)å¤§äº0ï¼Œä»£ç 2å°±èƒ½ä¿è¯å¼ºè€…æ›´å¼ºï¼Œå¼±è€…æ›´å¼±çš„æ•ˆæœã€‚</p><p>åä¹‹å¦‚æœx(å¯¹æ¯”åº¦)å°äº0ï¼Œä»£ç 2ä¹Ÿèƒ½ä¿è¯å¼ºè€…æ›´å¼±ï¼Œå¼±è€…æ›´å¼ºçš„æ•ˆæœï¼Œå› ä¸ºæ­£æ•°ä¹˜ä»¥å¤§äº0å°äº1çš„æ•°ï¼Œä¼šå˜å°;è´Ÿæ•°ä¹˜ä»¥å¤§äº0å°äº1çš„æ•°ï¼Œä¼šå˜å¤§ã€‚</p><h1 id="é¥±å’Œåº¦"><a href="#é¥±å’Œåº¦" class="headerlink" title="é¥±å’Œåº¦"></a>é¥±å’Œåº¦</h1><p>è¿™ä¸ªå’Œå‰ä¸¤ä¸ªä¸ä¸€æ ·ï¼Œå‰ä¸¤ä¸ªéƒ½æ˜¯å…ˆè®¡ç®—å‡ºä¸€ä¸ªåˆé€‚çš„factorï¼Œç„¶åæ¯ä¸ªåƒç´ rgbåˆ†åˆ«ä¹˜ä»¥è¿™ä¸ªfactorï¼Œè€Œé¥±å’Œåº¦å´æ²¡æœ‰åˆé€‚çš„factorï¼Œé€šå¸¸éƒ½æ˜¯å…ˆæŠŠrgbè½¬æ¢æˆhlsè°ƒèŠ‚é¥±å’Œåº¦ï¼Œå®Œäº†å†è½¬æˆrgbã€‚å°±åƒä¸‹é¢è¿™æ ·</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">adjustSaturation</span>(<span class="params">imageData, saturation</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = imageData.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> r = data[i];</span><br><span class="line">    <span class="keyword">const</span> g = data[i + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">const</span> b = data[i + <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢ä¸º HSL é¢œè‰²ç©ºé—´</span></span><br><span class="line">    <span class="keyword">const</span> hsl = <span class="title function_">rgbToHsl</span>(r, g, b);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ”¹å˜é¥±å’Œåº¦</span></span><br><span class="line">    hsl.<span class="property">s</span> += saturation;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢ä¸º RGB é¢œè‰²ç©ºé—´</span></span><br><span class="line">    <span class="keyword">const</span> rgb = <span class="title function_">hslToRgb</span>(hsl.<span class="property">h</span>, hsl.<span class="property">s</span>, hsl.<span class="property">l</span>);</span><br><span class="line"></span><br><span class="line">    data[i] = rgb.<span class="property">r</span>;</span><br><span class="line">    data[i + <span class="number">1</span>] = rgb.<span class="property">g</span>;</span><br><span class="line">    data[i + <span class="number">2</span>] = rgb.<span class="property">b</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> imageData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¥±å’Œåº¦åˆå«çº¯åº¦ï¼Œé¢œè‰²çš„çº¯åº¦ç”±æŸç§é¢œè‰²çš„ä¸»è‰²å æ¯”å†³å®šçš„ï¼Œæ‰€ä»¥è°ƒèŠ‚é¥±å’Œåº¦å°±æ˜¯è°ƒæ•´æŸç§é¢œè‰²ä¸»è‰²çš„å æ¯”ï¼Œé‚£å¦‚ä½•è°ƒèŠ‚è¿™ä¸ªæ¯”ä¾‹ï¼Œè¿™å’Œä¸€äº›ç”Ÿæ´»ç»éªŒå¾ˆç›¸ä¼¼ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€äº›æµ“å¢¨ï¼Œå¦‚ä½•ç¨€é‡Šï¼Œå¯¹æ²¡é”™ï¼ŒåŠ æ°´å°±èƒ½ç¨€é‡Šã€‚</p><p>é‚£å¦‚ä½•ç¨€é‡Šä¸»è‰²ï¼Œè¿™å°±ä¸èƒ½åŠ æ°´äº†ï¼Œæ˜¯åŠ ç°ï¼Œåœ¨rgbé¢œè‰²ç©ºé—´ä¸­ï¼Œæ‰€æœ‰rgbä¸‰ç§ä¸€æ ·çš„é¢œè‰²éƒ½æ˜¯ç°è‰²ã€‚</p><p>æ‰€ä»¥ç»¼ä¸Šï¼Œè°ƒæ•´æŸç§é¢œè‰²çš„é¥±å’Œåº¦é¦–å…ˆè¦æ‰¾åˆ°å®ƒçš„ä¸»è‰²ï¼Œç„¶åå¾€é‡Œé¢åŠ &#x2F;å‡ç°è‰²ã€‚æœ‰çš„é¢œè‰²ä¸»è‰²å¾ˆå®¹æ˜“æ‰¾åˆ°ï¼Œæ¯”å¦‚rgb(255,10,10)ï¼Œè¦å¢åŠ è¿™ä¸ªé¢œè‰²çš„é¥±å’Œåº¦ï¼Œåªéœ€è¦å‡å°‘gã€bçš„å€¼ï¼Œæ¯”å¦‚é¥±å’Œåº¦æœ€å¤§çš„rgb(255,0,0)ã€‚æœ‰çš„é¢œè‰²åˆ™æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œæ¯”å¦‚rgb(230,233,232)ï¼Œå¯èƒ½å°±æ˜¯å¤§å¤šæ•°é¢œè‰²éƒ½éš¾ä»¥ç®€å•çš„è®¡ç®—å‡ºä¸»è‰²ï¼Œæ‰€ä»¥è°ƒæ•´é¥±å’Œåº¦ä¸èƒ½ç®€å•çš„ç»™rgbä¹˜ä»¥ä¸€ä¸ªfactorã€‚</p><h1 id="HLS"><a href="#HLS" class="headerlink" title="HLS"></a>HLS</h1><p>æœ€åè¯´ä¸€ä¸‹hlsé¢œè‰²ç©ºé—´ï¼Œé€šè¿‡ä¸Šé¢å¯¹é¥±å’Œåº¦çš„è§£é‡Šä½ ä¼šå‘ç°ä½¿ç”¨rgbé¢œè‰²ç©ºé—´å¯èƒ½æœ‰åˆ©äºè®¡ç®—æœºå­˜å‚¨é¢œè‰²ï¼Œä½†æ˜¯ä¸æ–¹ä¾¿äººç±»ç†è§£ï¼Œhlsä¾¿æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œhlsç”±è‰²ç›¸ã€é¥±å’Œåº¦ã€äº®åº¦ç»„æˆï¼Œè‰²ç›¸å°±æ˜¯æˆ‘ä¸Šé¢è¯´çš„ä¸»è‰²ï¼Œå–å€¼ä»0åˆ°360ï¼Œæ‰€ä»¥å¯ä»¥ç†è§£æœ‰360ç§è‰²ç›¸;é¥±å’Œåº¦æŒ‡çš„æ˜¯æŸç§é¢œè‰²è‰²ç›¸çš„å æ¯”(è‰²ç›¸ä¸ç°åº¦çš„æ¯”ä¾‹)ã€‚</p><p>äº®åº¦ä¸é¥±å’Œåº¦ä¹Ÿæ˜¯å®¹æ˜“æ··æ·†çš„ï¼Œå…¶å®å€Ÿç”¨ç”Ÿæ´»ä¸­çš„ç»éªŒå¾ˆå®¹æ˜“åŒºåˆ†ã€‚æˆ‘ä»¬çŸ¥é“å¤§å¤šæ•°ç‰©ä½“æœ¬èº«æ˜¯ä¸å‘å…‰çš„ï¼Œå…‰çº¿ç…§åˆ°ç‰©ä½“ä¸Šï¼Œç‰©ä½“åå°„å…‰çº¿åˆ°äººçœ¼ï¼Œæˆ‘ä»¬æ‰ä¼šçœ‹åˆ°ä¸œè¥¿ï¼Œè¿™é‡Œçš„åå°„å¼ºåº¦å°±æ˜¯äº®åº¦çš„æ¦‚å¿µï¼Œè€Œé¥±å’Œåº¦æŒ‡çš„æ˜¯æŸç§é¢œè‰²ä¸»è‰²çš„å æ¯”ï¼Œæ¯”å¦‚rgb(255,0,0)è¿™ç§é¢œè‰²ï¼Œè™½ç„¶çº¢è‰²çš„çº¯åº¦å¾ˆé«˜ï¼Œä½†æ˜¯æ²¡æœ‰å…‰æºç…§å°„ï¼Œä¹Ÿæ˜¯çœ‹ä¸åˆ°çš„ï¼Œè¿™ç§ç°è±¡ç”¨hlsæè¿°å°±æ˜¯hsl(0, 100%, 0%)ã€‚</p><p>æ˜ç™½äº†å…‰æºçš„å­˜åœ¨ï¼Œäº®åº¦ä¸é¥±å’Œåº¦å¾ˆå®¹æ˜“åŒºåˆ†ï¼Œå¤§å¤šæ•°é¢œè‰²(é™¤äº†ç°è‰²)éƒ½æœ‰é¥±å’Œåº¦ï¼Œä½†æ˜¯ä¸ä¸€å®šæœ‰äº®åº¦ï¼Œå› ä¸ºå¯èƒ½æ²¡æœ‰å…‰æºã€‚æœ‰äº†ä»¥ä¸Šç†è§£ï¼Œé‚£è‰²æ¸©å°±å¾ˆå¥½ç†è§£äº†ï¼Œäº®åº¦ååº”çš„æ˜¯å…‰æºä¸è¢«ç…§å°„ç‰©ä½“åå…‰çš„å¼ºåº¦ï¼Œè€Œè‰²æ¸©é¡¾åæ€ä¹‰åˆ™è¡¨ç¤ºå…‰çš„æ¸©åº¦ï¼Œå…³äºè‰²æ¸©çš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/56252445">è¿™ç¯‡</a>ã€‚è‰²æ¸©ç”¨ç”Ÿæ´»ä¸­çš„ç»éªŒä¹Ÿå¾ˆå¥½ç†è§£ï¼ŒåŒæ ·çš„ç‰©ä½“åœ¨æ—¥å…‰çš„ç…§è€€ä¸‹ä¸åœ¨ç¯å…‰çš„ç…§è€€ä¸‹ï¼Œæ•ˆæœè‚¯å®šä¸ä¸€æ ·ï¼Œå°¤å…¶æ˜¯åƒè‡ªå¦‚é…å¥—çš„é‚£ç§å¤§é»„ç¯ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç™¾åº¦äº‘ç›˜toé˜¿é‡Œäº‘ç›˜</title>
      <link href="/2022/08/07/%E7%99%BE%E5%BA%A6%E4%BA%91%E7%9B%98to%E9%98%BF%E9%87%8C%E4%BA%91%E7%9B%98/"/>
      <url>/2022/08/07/%E7%99%BE%E5%BA%A6%E4%BA%91%E7%9B%98to%E9%98%BF%E9%87%8C%E4%BA%91%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>2Tç™¾åº¦äº‘ç»ˆç©¶è¿˜æ˜¯æ»¡äº†ï¼Œå¸¸å¹´çš„æ—¥ç§¯æœˆç´¯ï¼Œåˆ åˆä¸çŸ¥é“è¯¥è¯¥åˆ å•¥ã€‚é˜¿é‡Œäº‘ç›˜æœ€è¿‘å…´èµ·ï¼Œå¦‚æœèƒ½æŠŠéƒ¨åˆ†æ–‡ä»¶ç§»åˆ°é˜¿é‡Œäº‘ç›˜é‡Œå°±å¥½äº†ï¼Œç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œç™¾åº¦ä¸é˜¿é‡Œçš„æ•°æ®æ˜¯ä¸å¯èƒ½ç›¸é€šçš„ï¼Œä¹Ÿä¸å¯èƒ½ä¼šå‡ºç°å®˜æ–¹çš„xxxè¿ç§»å·¥å…·ä¹‹ç±»çš„ã€‚æ‰€ä»¥ï¼Œè¿™åˆæ˜¯ä¸€ä¸ªå…«ä»™è¿‡æµ·å„æ˜¾ç¥é€šçš„æ´»ï¼Œå¤§å®¶çš„æ€è·¯æ™®ééƒ½æ˜¯å…ˆæŠŠç™¾åº¦äº‘ç›˜é‡Œçš„èµ„æ–™ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åå†ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ï¼Œè¿™è®©æˆ‘æƒ³èµ·æ¥å®‹ä¸¹ä¸¹çš„ä¸€å¥åè¨€ï¼ŒæŠŠå¤§è±¡è£…å†°ç®±åˆ†å‡ æ­¥â€¦</p><p>æ€è·¯æ˜¯è¿™æ ·æ²¡é”™ï¼Œä½†æ˜¯å¤§ç¥çš„åšæ³•è·Ÿæ™®é€šäººå°±æ˜¯ä¸ä¸€æ ·ï¼Œå¯ä»¥å‚è€ƒ<a href="https://www.zhihu.com/question/451854774">è¿™ä¸ª</a> å¸–å­ã€‚æœ¬æ–‡ä»‹ç»çš„æ˜¯ç”¨webdavçš„é‚£ä¸ªã€‚</p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/5e45b33c-8480-4dba-8cf1-8508e26acfa3-image.png" alt="5e45b33c-8480-4dba-8cf1-8508e26acfa3-image.png"></p><h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>æœ¬æ–‡åªé€‚ç”¨äºwindowsæ“ä½œç³»ç»Ÿã€‚</p><p>æ•´ä½“çš„æµç¨‹å°±æ˜¯å¸–å­é‡Œè¯´çš„1ã€2ã€3ã€4ã€5ï¼Œä¸è¿‡ä½œä¸ºä¸€ä¸ªåŠ¡å®çš„æ¬è¿å·¥ï¼Œå®é™…æ“ä½œè¿‡ç¨‹ä¸­æœ‰è·Ÿå¸–å­ä¸ä¸€æ ·çš„åœ°æ–¹ã€‚</p><h2 id="ç¬¬ä¸€å¤„ï¼š"><a href="#ç¬¬ä¸€å¤„ï¼š" class="headerlink" title="ç¬¬ä¸€å¤„ï¼š"></a>ç¬¬ä¸€å¤„ï¼š</h2><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/d98d7fa0-8ced-43b5-9fd8-e09b8bd0e6ca-image.png" alt="d98d7fa0-8ced-43b5-9fd8-e09b8bd0e6ca-image.png"></p><p>ä½œè€…ä¸€ç¬”å¸¦è¿‡â€¦ã€‚æ­£å¸¸æ“ä½œæ˜¯è¿™æ ·çš„ï¼Œæ‰¾åˆ°ä½ ç”µè„‘çš„â€œå¯åŠ¨æˆ–å…³é—­windowsåŠŸèƒ½â€ï¼Œç„¶åæ‰¾åˆ°Hyper-Vé€‰é¡¹ï¼Œå‹¾ä¸Šã€‚</p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/2ac146d3-b31d-45d0-a7d6-1afa9d862691-image.png" alt="2ac146d3-b31d-45d0-a7d6-1afa9d862691-image.png"></p><p>æœ‰äº›äººå¯èƒ½æ‰¾ä¸åˆ°Hyper-Vé€‰é¡¹ï¼ˆæ¯”å¦‚æˆ‘ï¼‰ï¼Œè¿™ç§æƒ…å†µéœ€è¦å•ç‹¬å®‰è£…Hyper-Vï¼Œå‚è€ƒ<a href="https://blog.csdn.net/weixin_37695006/article/details/91589895">è¿™ç¯‡</a> .</p><p>åœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­å‘ç°Hyper-V.cmdä¸‹è½½èµ„æºå¾ˆæ…¢ï¼Œæ‰€ä»¥æœ€å¥½åŠ ä¸Šè¿™ä¸€å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh winhttp set proxy http://127.0.0.1:7890</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ çš„â€œå¯åŠ¨æˆ–å…³é—­windowsåŠŸèƒ½â€œé‡Œé¢å°±èƒ½æ‰¾åˆ°Hyper-Väº†ã€‚</p><h2 id="ç¬¬äºŒå¤„ï¼š"><a href="#ç¬¬äºŒå¤„ï¼š" class="headerlink" title="ç¬¬äºŒå¤„ï¼š"></a>ç¬¬äºŒå¤„ï¼š</h2><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/c83d80c9-7029-442a-9909-7ae7104cfeaf-image.png" alt="c83d80c9-7029-442a-9909-7ae7104cfeaf-image.png"></p><p>åˆæ˜¯ä¸€ç¬”å¸¦è¿‡ã€‚å®é™…æƒ…å†µæ˜¯ä¸‹è½½å®‰è£…éƒ½æ²¡é—®é¢˜ï¼Œä½†æ˜¯è¿è¡Œä¸èµ·æ¥ï¼Œç±»ä¼¼äºè¿™å¼ å›¾ï¼š</p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/ee5cccf5-a51c-4c0e-8d7d-cbf87c801fba-image.png" alt="ee5cccf5-a51c-4c0e-8d7d-cbf87c801fba-image.png"></p><p>è¿™ä¸ªé—®é¢˜æå¾—æˆ‘éƒ½å¿«æ”¾å¼ƒäº†ï¼Œåæ¥æäº†ä¸ªä½ç‰ˆæœ¬çš„<a href="mailto:&#100;&#x6f;&#x63;&#x6b;&#x65;&#114;&#x40;&#x34;&#x2e;&#x35;&#x2e;&#x31;">&#100;&#x6f;&#x63;&#x6b;&#x65;&#114;&#x40;&#x34;&#x2e;&#x35;&#x2e;&#x31;</a>ï¼Œè£…ä¸Šåï¼Œè¿˜æ˜¯ä¸€æ ·çš„ç—‡çŠ¶ï¼Œä¸è¿‡å¼¹äº†å¦ä¸€ä¸ªæç¤ºï¼Œå¤§æ¦‚å†…å®¹æ˜¯æˆ‘æœºå™¨ä¸Šçš„wslç‰ˆæœ¬å¤ªä½ï¼Œæ‰“å¼€ç»™å®šçš„é“¾æ¥æ›´æ–°wslï¼Œç„¶åå†restartã€‚</p><p><a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-manual#step-4---download-the-linux-kernel-update-package">é“¾æ¥</a></p><p>æŒ‰ç…§é“¾æ¥é‡Œé¢çš„æ­¥éª¤æå®Œåï¼Œdockeræœç„¶è·‘èµ·æ¥äº†ã€‚</p><p>å…¶å®ä¹Ÿå¯ä»¥å‡çº§windowsç‰ˆæœ¬ï¼Œæˆ‘åŸå…ˆæ˜¯å®¶åº­ç‰ˆï¼Œå‡çº§åˆ°proï¼Œdockerä¹Ÿè·‘èµ·æ¥äº†ã€‚</p><h2 id="ç¬¬ä¸‰å¤„"><a href="#ç¬¬ä¸‰å¤„" class="headerlink" title="ç¬¬ä¸‰å¤„"></a>ç¬¬ä¸‰å¤„</h2><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/07339a99-030b-4140-b899-366904904ea7-image.png" alt="07339a99-030b-4140-b899-366904904ea7-image.png"></p><p>è¿™ä¸ªä¹Ÿå¾ˆå‘ï¼Œè€è¯´æˆ‘æ²¡æƒé™ä»€ä¹ˆçš„ï¼Œä¸ºæ­¤ï¼Œæˆ‘è¿˜ä¸“é—¨æ³¨å†Œäº†ä¸ªdockerè´¦å·ï¼Œæœ€åçš„ç»“æœæ˜¯zx5253&#x2F;webdav-aliyundriverçš„ä½œè€…åˆ åº“äº†ã€‚å¥½å§ï¼Œé‚£å°±æ‰¾æ›¿ä»£å“ï¼Œæœ€åç”¨çš„æ˜¯<a href="https://github.com/messense/aliyundrive-webdav">è¿™ä¸ª</a></p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/fad8809b-61e5-42bf-9f79-7d553a827bd1-image.png" alt="fad8809b-61e5-42bf-9f79-7d553a827bd1-image.png"></p><h2 id="ç¬¬å››å¤„"><a href="#ç¬¬å››å¤„" class="headerlink" title="ç¬¬å››å¤„"></a>ç¬¬å››å¤„</h2><p>è¿™ä¸€æ­¥éœ€è¦æ³¨æ„çš„æ˜¯é‚£ä¸ªæˆªå›¾</p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/72cef2ba-086b-4c61-b62e-0f532d30471d-image.png" alt="72cef2ba-086b-4c61-b62e-0f532d30471d-image.png"></p><p>çº¢è‰²æ¡†å›¾é‡Œé¢çš„å°ç›¾ç‰Œè¡¨ç¤ºæ˜¯å¦å¯ç”¨httpsï¼Œä¸è¦å‹¾é€‰ã€‚</p><h2 id="ç¬¬äº”å¤„"><a href="#ç¬¬äº”å¤„" class="headerlink" title="ç¬¬äº”å¤„"></a>ç¬¬äº”å¤„</h2><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/38dd9679-108d-4ff1-a924-59787038a263-image.png" alt="38dd9679-108d-4ff1-a924-59787038a263-image.png"></p><p>ç®€ç®€å•å•ä¸‰ä¸ªå­—ï¼šè¿æ¥åã€‚é—®é¢˜æ˜¯æˆ‘æ ¹æœ¬å°±è¿æ¥ä¸ä¸Šã€‚ä¹Ÿæ˜¯å¼¹äº†ä¸ªé”™è¯¯æç¤ºï¼šâ€œç”±äºç›®æ ‡è®¡ç®—æœºç§¯ææ‹’ç»ï¼Œæ— æ³•è¿æ¥â€ã€‚</p><p>è¿™ä¸€æ­¥ä¹Ÿæå¾—æˆ‘å¿«è¦æ”¾å¼ƒäº†ï¼Œç½‘ä¸Šæ‰¾äº†å„ç§åŠæ³•éƒ½æ²¡ç”¨ï¼Œæœ€åè¿˜æ˜¯é‡å¯å¤§æ³•å¥½ï¼Œä¸è¿‡é‡å¯çš„æ˜¯dockerçš„containerï¼Œä¹Ÿå°±æ˜¯è¿™ä¸€æ­¥åœ¨é‡å¯çš„è¿‡ç¨‹ä¸­å‡ºé—®é¢˜äº†ï¼Œè§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œä¸Šä¸€æ­¥å¥‡è¿¹èˆ¬çš„è¿æ¥ä¸Šäº†ã€‚</p><p><a href="https://stackoverflow.com/questions/65272764/ports-are-not-available-listen-tcp-0-0-0-0-50070-bind-an-attempt-was-made-to">å‚è€ƒ</a> </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net stop winnat</span><br><span class="line">docker <span class="built_in">start</span> container_name</span><br><span class="line">net <span class="built_in">start</span> winnat</span><br></pre></td></tr></table></figure><p>ç»è¿‡åæ¥çš„å®è·µï¼Œæˆ‘å‘ç°å…ˆå¯åŠ¨raidriverï¼Œç„¶åå†å¯åŠ¨dockerï¼Œæ˜¯ç›´æ¥å¯ä»¥è¿ä¸Šçš„ã€‚ç¬¬ä¸€æ¬¡æŒ‰æ•™ç¨‹ä¸Šçš„æ­¥éª¤ï¼Œé¡ºåºåè€Œæ˜¯åçš„ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å†™ä¸€ä¸ªå·¦åˆ’åˆ é™¤åŠŸèƒ½</title>
      <link href="/2022/02/13/%E5%86%99%E4%B8%80%E4%B8%AA%E5%B7%A6%E5%88%92%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD/"/>
      <url>/2022/02/13/%E5%86%99%E4%B8%80%E4%B8%AA%E5%B7%A6%E5%88%92%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<p>éœ€æ±‚æ˜¯å†™ä¸€ä¸ªå°ç¨‹åºï¼Œç”¨æ¥å®ç°ä¸€ä¸ªappå¤§éƒ¨åˆ†åŠŸèƒ½ã€‚é‡Œé¢æœ‰ä¸ªåŠŸèƒ½æ˜¯åˆ—è¡¨çš„å·¦åˆ’åˆ é™¤ï¼Œå¯èƒ½appé‚£è¾¹æœ‰ç°æˆçš„ç»„ä»¶&#x2F;åº“å¯ä»¥ç”¨ï¼Œå°ç¨‹åºå®˜æ–¹æ²¡æœ‰æä¾›è¿™æ ·çš„ç»„ä»¶ï¼Œäºæ˜¯æ±‚åŠ©äºgoogleã€‚</p><p>æœåˆ°äº†<a href="https://segmentfault.com/a/1190000014831500">è¿™ä¸ª</a> ,çœ‹èµ·æ¥æŒºå¥½çš„ï¼Œä½†æ˜¯è¦æ±‚é«˜åº¦å›ºå®šï¼Œæˆ‘åˆ—è¡¨é‡Œé¢æœ‰å›¾ç‰‡ï¼Œæˆ‘æ— æ³•ç¡®å®šå›¾ç‰‡çš„é«˜åº¦å›ºå®šï¼Œè·Ÿç›¸å…³äººå‘˜æ²Ÿé€šèµ·æ¥åˆæ˜¯ä¸€å †åºŸè¯ï¼Œç®—æ˜¯å¤‡é€‰ã€‚</p><p>ç„¶åæ‰¾åˆ°äº†<a href="https://nutui.jd.com/#/swipe">è¿™ä¸ª</a></p><p>nutuiçš„swipeç»„ä»¶ï¼Œ<a href="https://github.com/jdf2e/nutui/blob/6e63e992565ce404fbbe3a63d459794f141cb4a9/src/packages/__VUE/swipe/index.taro.vue">æºç </a> vueå†™çš„ï¼Œæˆ‘é¡¹ç›®ç”¨çš„æ˜¯reactï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œvue3çš„Composition apiä¸react hooksæ˜¯å¸ˆå‡ºåŒé—¨ã€‚çœ‹æ‡‚å®ƒç„¶åç¿»è¯‘ä¸€ä¸‹(æˆ‘åˆæ‰¾åˆ°äº†ä¸€ä¸ªé€‚åˆè‡ªå·±çš„å·¨äºº)ã€‚</p><h1 id="æºç è§£è¯»"><a href="#æºç è§£è¯»" class="headerlink" title="æºç è§£è¯»"></a>æºç è§£è¯»</h1><h2 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h2><p>htmlã€cssã€jsæ°¸è¿œæ˜¯ä¸€å®¶äººï¼Œä¸è¦çœ‹ä¸èµ·htmlã€cssï¼Œä¼˜ç§€çš„å¸ƒå±€å¯ä»¥çœå¥½å¤šä»£ç ã€‚</p><iframe src="https://codesandbox.io/embed/distracted-haibt-9sp3o?fontsize=14&hidenavigation=1&theme=light" title="awesome-mestorf-nb8r2" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media" style="width:100%; height:250px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p>å¸ƒå±€åˆ†ä¸º3éƒ¨åˆ†ï¼Œcontentã€leftã€rightï¼Œcontentä¸ºåˆ—è¡¨çš„ä¸»è¦å†…å®¹ï¼Œleft&#x2F;rightåˆ†åˆ«è¡¨ç¤ºå‘å³&#x2F;å·¦æ»‘æ‰€å±•ç¤ºçš„é¢å¤–å†…å®¹ï¼Œç„¶åleftã€rightåˆ†åˆ«ç»å¯¹å®šä½ï¼Œå¹¶ä¸”é…åˆtranslateç§»å‡ºcontentçš„å¯è§èŒƒå›´ã€‚</p><h2 id="é€»è¾‘"><a href="#é€»è¾‘" class="headerlink" title="é€»è¾‘"></a>é€»è¾‘</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view</span><br><span class="line">    :class=&quot;classes&quot;</span><br><span class="line">    :style=&quot;touchStyle&quot;</span><br><span class="line">    @touchstart=&quot;onTouchStart&quot;</span><br><span class="line">    @touchmove=&quot;onTouchMove&quot;</span><br><span class="line">    @touchend=&quot;onTouchEnd&quot;</span><br><span class="line">    @touchcancel=&quot;onTouchEnd&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;view class=&quot;nut-swipe__left&quot; ref=&quot;leftRef&quot; :id=&quot;&#x27;leftRef-&#x27; + refRandomId&quot;&gt;</span><br><span class="line">      &lt;slot name=&quot;left&quot;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line"></span><br><span class="line">    &lt;view class=&quot;nut-swipe__content&quot;&gt;</span><br><span class="line">      &lt;slot name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line"></span><br><span class="line">    &lt;view class=&quot;nut-swipe__right&quot; ref=&quot;rightRef&quot; :id=&quot;&#x27;rightRef-&#x27; + refRandomId&quot;&gt;</span><br><span class="line">      &lt;slot name=&quot;right&quot;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> touchStyle = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">transform</span>: <span class="string">`translate3d(<span class="subst">$&#123;state.offset&#125;</span>px, 0, 0)`</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸€ç›®äº†ç„¶ã€‚æœ‰ä¸‰ä¸ªslotï¼Œåˆ†åˆ«å¯¹åº”ä¸Šè¿°å¸ƒå±€ä¸­çš„contentã€leftã€rightã€‚ç›‘å¬äº†æœ€å¤–å±‚viewçš„touchäº‹ä»¶ï¼Œç›®çš„æ˜¯æ ¹æ®touchæ—¶çš„å„ç§å€¼æ¥æ§åˆ¶offsetçš„å€¼ï¼Œä»è€Œç”ŸæˆtouchStyleï¼Œä½¿æœ€å¤–å±‚çš„viewç§»åŠ¨ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•å¾—åˆ°touchäº‹ä»¶çš„å„ç§å€¼å‘¢ï¼Œä»–ä»¬å°è£…äº†ä¸ª<a href="https://github.com/jdf2e/nutui/blob/6e63e992565ce404fbbe3a63d459794f141cb4a9/src/packages/utils/useTouch/index.ts">useTouch</a> </p><p>ä»£ç è¿˜æ˜¯æŒºç®€çš„</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> startX = <span class="title function_">ref</span>(<span class="number">0</span>); <span class="comment">//æ»‘åŠ¨èµ·å§‹xå€¼</span></span><br><span class="line"><span class="keyword">const</span> startY = <span class="title function_">ref</span>(<span class="number">0</span>);<span class="comment">// æ»‘åŠ¨èµ·å§‹yå€¼</span></span><br><span class="line"><span class="keyword">const</span> deltaX = <span class="title function_">ref</span>(<span class="number">0</span>);<span class="comment">// æ»‘åŠ¨çš„xå€¼</span></span><br><span class="line"><span class="keyword">const</span> deltaY = <span class="title function_">ref</span>(<span class="number">0</span>); <span class="comment">// æ»‘åŠ¨çš„yå€¼</span></span><br><span class="line"><span class="keyword">const</span> offsetX = <span class="title function_">ref</span>(<span class="number">0</span>);<span class="comment">// deltaXçš„ç»å¯¹å€¼</span></span><br><span class="line"><span class="keyword">const</span> offsetY = <span class="title function_">ref</span>(<span class="number">0</span>); <span class="comment">// deltaYçš„ç»å¯¹å€¼</span></span><br><span class="line"><span class="keyword">const</span> direction = ref&lt;<span class="title class_">Direction</span>&gt;(<span class="string">&#x27;&#x27;</span>); <span class="comment">// æ»‘åŠ¨çš„æ–¹å‘</span></span><br></pre></td></tr></table></figure><p>æœ‰ä¸‰ä¸ªå‡½æ•°ï¼Œreset&#x2F;start&#x2F;moveï¼Œstartä¸moveåˆ†åˆ«åœ¨touchStartä¸touchMoveæ—¶è°ƒç”¨ï¼Œç”¨æ¥è®°å½•æ»‘åŠ¨çš„è·ç¦»ï¼Œè°ƒç”¨startæ—¶ä¼šè°ƒç”¨resetã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™é‡Œè®¡ç®—æ»‘åŠ¨æ–¹å‘çš„æ–¹æ³•</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getDirection</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (x &gt; y &amp;&amp; x &gt; <span class="variable constant_">MIN_DISTANCE</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;horizontal&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (y &gt; x &amp;&amp; y &gt; <span class="variable constant_">MIN_DISTANCE</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;vertical&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯æ ¹æ®æ¯æ¬¡æ»‘åŠ¨offsetXä¸offsetYçš„å¤§å°ä»¥åŠæ»‘åŠ¨è·ç¦»æ˜¯å¦å¤§äº10å†³å®šçš„ã€‚</p><p>å†æ¥çœ‹swipeç»„ä»¶å¤„ç†æ»‘åŠ¨çš„é€»è¾‘</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">initWidth</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    leftRefWidth.<span class="property">value</span> = <span class="keyword">await</span> <span class="title function_">getRefWidth</span>(leftRef);</span><br><span class="line">    rightRefWidth.<span class="property">value</span> = <span class="keyword">await</span> <span class="title function_">getRefWidth</span>(rightRef);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">initWidth</span>();</span><br><span class="line">    &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ‹¿åˆ°left slotä¸right slotçš„å®½åº¦ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±æ˜¯0ã€‚ç„¶åä¼šç›‘å¬touchstartã€touchmoveã€touchendäº‹ä»¶ã€‚</p><p>touchstart</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onTouchStart</span>(<span class="params">event: Event</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (props.<span class="property">disabled</span>) <span class="keyword">return</span>;</span><br><span class="line">    touch.<span class="title function_">start</span>(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹³æ·¡æ— å¥‡ï¼Œæ ¸å¿ƒæ˜¯è°ƒç”¨äº†touch.startæ–¹æ³•ã€‚</p><p>onTouchMove</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">onTouchMove</span>(<span class="params">event: Event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">disabled</span>) <span class="keyword">return</span>;</span><br><span class="line">    touch.<span class="title function_">move</span>(event);</span><br><span class="line">    <span class="keyword">if</span> (touch.<span class="title function_">isHorizontal</span>()) &#123;</span><br><span class="line">      state.<span class="property">moving</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="title function_">setoffset</span>(touch.<span class="property">deltaX</span>.<span class="property">value</span>);</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">touchMovePreventDefault</span>) &#123;</span><br><span class="line">        event.<span class="title function_">preventDefault</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">touchMoveStopPropagation</span>) &#123;</span><br><span class="line">        event.<span class="title function_">stopPropagation</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ˜¯è°ƒç”¨touch.moveä»¥åŠsetoffsetæ–¹æ³•ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">setoffset</span> = (<span class="params">deltaX: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">      position = deltaX &gt; <span class="number">0</span> ? <span class="string">&#x27;right&#x27;</span> : <span class="string">&#x27;left&#x27;</span>;</span><br><span class="line">      <span class="keyword">let</span> offset = deltaX;</span><br><span class="line">      <span class="keyword">switch</span> (position) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;left&#x27;</span>:</span><br><span class="line">          <span class="keyword">if</span> (opened &amp;&amp; oldPosition === position) &#123;</span><br><span class="line">            offset = -rightRefWidth.<span class="property">value</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            offset = <span class="title class_">Math</span>.<span class="title function_">abs</span>(deltaX) &gt; rightRefWidth.<span class="property">value</span> ? -rightRefWidth.<span class="property">value</span> : deltaX;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;right&#x27;</span>:</span><br><span class="line">          <span class="keyword">if</span> (opened &amp;&amp; oldPosition === position) &#123;</span><br><span class="line">            offset = leftRefWidth.<span class="property">value</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            offset = <span class="title class_">Math</span>.<span class="title function_">abs</span>(deltaX) &gt; leftRefWidth.<span class="property">value</span> ? leftRefWidth.<span class="property">value</span> : deltaX;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      state.<span class="property">offset</span> = offset;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>è¿™å‡ è¡Œif elseå†™çš„å¾ˆç²¾å¦™ã€‚swipeç»„ä»¶åŒæ—¶æ”¯æŒå·¦&#x2F;å³æ»‘ï¼Œå…ˆæ¥çœ‹å·¦åˆ’çš„é€»è¾‘ã€‚</p><p>openedè¡¨ç¤ºæ˜¯å¦å·²ç»æ‰“å¼€ï¼Œå¦‚æœæ˜¯trueå¹¶ä¸”æœ¬æ¬¡æ»‘åŠ¨æ–¹å‘ä¸ä¸Šä¸€æ¬¡ä¸€è‡´ï¼Œé‚£ä¹ˆoffsetæ°¸è¿œç­‰äº-rightRefWidthã€‚</p><p>å‡è®¾æ˜¯ç¬¬ä¸€æ¬¡æ»‘ï¼Œå¹¶ä¸”right slotä¸ä¸ºç©ºï¼Œèµ°çš„æ˜¯è¿™å¥ä»£ç ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">offset = <span class="title class_">Math</span>.<span class="title function_">abs</span>(deltaX) &gt; rightRefWidth.<span class="property">value</span> ? -rightRefWidth.<span class="property">value</span> : deltaX;</span><br></pre></td></tr></table></figure><p>ç²¾å¦™çš„ä¸‰å…ƒè¡¨è¾¾å¼ï¼Œæ— å½¢ä¸­å¤„ç†äº†å¾ˆå¤šè¾¹ç•Œæƒ…å†µï¼Œå…ˆçœ‹æœ€æ­£å¸¸çš„ï¼šç¬¬ä¸€æ¬¡æ»‘ï¼Œå¹¶ä¸”right slotä¸ä¸ºç©ºã€‚</p><p>è¿™æ—¶Math.abs(deltaX) &lt; rightRefWidthï¼Œæ‰€ä»¥offsetä¸ºdeltaXã€‚</p><p>é‚£ä»€ä¹ˆæ—¶å€™Math.abs(deltaX) &gt;&#x3D; rightRefWidthå‘¢ï¼Œè¦ä¹ˆright slotå®Œå…¨è¢«åˆ’å‡ºï¼Œè¦ä¹ˆright slot ä¸ºç©ºã€‚å‡è®¾right slotä¸ºç©ºï¼Œè¿™æ—¶å†å·¦æ»‘æ˜¯æ»‘ä¸åŠ¨çš„ã€‚</p><p>å³æ»‘åŒç†ã€‚</p><p>onTouchEnd</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onTouchEnd</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (state.<span class="property">moving</span>) &#123;</span><br><span class="line">  state.<span class="property">moving</span> = <span class="literal">false</span>;</span><br><span class="line">  oldPosition = position;</span><br><span class="line">  <span class="keyword">switch</span> (position) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;left&#x27;</span>:</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(state.<span class="property">offset</span>) &lt;= rightRefWidth.<span class="property">value</span> / <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="title function_">close</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        state.<span class="property">offset</span> = -rightRefWidth.<span class="property">value</span>;</span><br><span class="line">        <span class="title function_">open</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;right&#x27;</span>:</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(state.<span class="property">offset</span>) &lt;= leftRefWidth.<span class="property">value</span> / <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="title function_">close</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        state.<span class="property">offset</span> = leftRefWidth.<span class="property">value</span>;</span><br><span class="line">        <span class="title function_">open</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•éšè—ç€ä¸€ä¸ªå°å°çš„äº¤äº’ä½“éªŒã€‚å‡è®¾onTouchEndè§¦å‘æ—¶ï¼Œå·¦æ»‘çš„è·ç¦»å°äºrightRefWidthçš„ä¸€åŠï¼Œä¼šè‡ªåŠ¨closeï¼Œåä¹‹openã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">open</span> = (<span class="params">p: SwipePosition = <span class="string">&#x27;&#x27;</span></span>) =&gt; &#123;</span><br><span class="line">     opened = <span class="literal">true</span>;</span><br><span class="line">     <span class="keyword">if</span> (p) &#123;</span><br><span class="line">       state.<span class="property">offset</span> = p === <span class="string">&#x27;left&#x27;</span> ? -rightRefWidth.<span class="property">value</span> : leftRefWidth.<span class="property">value</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// emit(&#x27;open&#x27;, &#123;</span></span><br><span class="line">     <span class="comment">//   name: props.name,</span></span><br><span class="line">     <span class="comment">//   position: position || p</span></span><br><span class="line">     <span class="comment">// &#125;);</span></span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="keyword">const</span> <span class="title function_">close</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">     state.<span class="property">offset</span> = <span class="number">0</span>;</span><br><span class="line">     opened = <span class="literal">false</span>;</span><br><span class="line">     <span class="comment">// emit(&#x27;close&#x27;, &#123;</span></span><br><span class="line">     <span class="comment">//   name: props.name,</span></span><br><span class="line">     <span class="comment">//   position</span></span><br><span class="line">     <span class="comment">// &#125;);</span></span><br><span class="line">   &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>openä¸closeæ‰€åšçš„äº‹æ˜¯åˆ†åˆ«è®©offsetè¾¾åˆ°æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ä¸‹è½½è…¾è®¯è¯¾å ‚è§†é¢‘</title>
      <link href="/2022/02/05/%E5%A6%82%E4%BD%95%E4%B8%8B%E8%BD%BD%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82%E8%A7%86%E9%A2%91/"/>
      <url>/2022/02/05/%E5%A6%82%E4%BD%95%E4%B8%8B%E8%BD%BD%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82%E8%A7%86%E9%A2%91/</url>
      
        <content type="html"><![CDATA[<p>è…¾è®¯è¯¾å ‚â€œè´´å¿ƒâ€çš„ç»™æˆ‘ä»¬æä¾›äº†å›æ”¾åŠŸèƒ½ï¼Œä½†æ˜¯å›¾å¿ƒç†å®‰æ…°ï¼Œè€æƒ³ç€å¦‚ä½•ä¸‹è½½ä¸‹æ¥æ‰å®‰å¿ƒã€‚ï¼ˆè‡ªå·±çœ‹ï¼Œä¸ä¼ æ’­ï¼‰</p><p>éšä¾¿æ‰“å¼€ä¸€ä¸ªè…¾è®¯è¯¾å ‚è§†é¢‘ï¼Œæ¯”å¦‚<a href="https://ke.qq.com/course/2994329?taid=12141623440683161">è¿™ä¸ª</a> éšä¾¿æ‰¾ä¸€ä¸ªã€‚chromeæµè§ˆå™¨å³å‡»æ£€æŸ¥ï¼Œæ‰“å¼€å¼€å‘è€…æ§åˆ¶å°ï¼ŒNetWorké¢æ¿ï¼Œå†æ¬¡åˆ·æ–°ç½‘é¡µï¼ŒNetWorkç­›é€‰m3u8å…³é”®è¯ã€‚</p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/f4ec5ba9-396e-4fe7-be62-b0c7f54b82f4-image.png" alt="f4ec5ba9-396e-4fe7-be62-b0c7f54b82f4-image.png"></p><p>è¿™ä¾¿æ˜¯è¯¥è§†é¢‘ä¸åŒåˆ†è¾¨ç‡çš„èµ„æºï¼Œè¿™äº›é“¾æ¥æ˜¯ä¸èƒ½ç›´æ¥ä¸‹è½½çš„ï¼Œéœ€è¦è§£å¯†ï¼Œç”¨<a href="https://github.com/nilaoda/N_m3u8DL-CLI/tree/master/N_m3u8DL-CLI">è¿™ä¸ª</a> è§£ï¼Œè²Œä¼¼c#å†™çš„ã€‚</p><p>å¯¹ï¼Œæ²¡é”™ï¼Œæˆ‘å°±æ˜¯æ¬ç”¨å·¥ï¼Œä¸€ç‚¹æŠ€æœ¯å«é‡ä¹Ÿæ²¡æœ‰ã€‚</p><p>å¦‚æœæœ‰å¤šä¸ªè§†é¢‘éœ€è¦ä¸‹è½½ï¼Œä¸Šè¿°è¿‡ç¨‹ç•¥æ˜¾éº»çƒ¦ã€‚å¯ä»¥ç§»æ­¥ç«ç‹æµè§ˆå™¨ï¼Œä¸‹è½½Video DownloadHelper æ’ä»¶ï¼Œè¿™ç©æ„èƒ½ç›´æ¥è¯†åˆ«å‡ºèµ„æºï¼Œå¹¶ä¸”å‘Šè¯‰ä½ ä¸åŒçš„åˆ†è¾¨ç‡ï¼Œç„¶åè¿˜æ˜¯éœ€è¦è§£å¯†m3u8ã€‚</p><p>å¦‚æœéœ€è¦ä¸‹è½½çš„è§†é¢‘å·¨å¤šï¼Œè¿ç”¨æ’ä»¶copyé“¾æ¥éƒ½è§‰çš„éº»çƒ¦ï¼Œåç»­çœ‹èƒ½ä¸èƒ½å†™ä¸ªçˆ¬è™«ä»€ä¹ˆçš„ï¼Œè‡ªåŠ¨copyé“¾æ¥ã€‚ç„¶åç ”ç©¶ä¸‹è§£å¯†m3u8é‚£å·¥å…·æ”¯ä¸æ”¯æŒæ‰¹é‡ä¸‹è½½ï¼Œæš‚æ—¶å°±è¿™æ ·ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ javaå†…éƒ¨ç±»</title>
      <link href="/2022/01/09/%E5%AD%A6%E4%B9%A0java%E5%86%85%E9%83%A8%E7%B1%BB/"/>
      <url>/2022/01/09/%E5%AD%A6%E4%B9%A0java%E5%86%85%E9%83%A8%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä½œä¸ºä¸€ä¸ªåªæ“…é•¿javascriptçš„ä¼ªç¨‹åºå‘˜ï¼Œå­¦ä¹ javaè¿˜æ˜¯æŒºè´¹åŠ²çš„ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œå†åºç„¶å¤§ç‰©ï¼Œä¹Ÿèƒ½åˆ†è€Œæ²»ä¹‹ã€‚</p><p>googleæœå†…éƒ¨ç±»ï¼Œå¥½å¤šæ–‡ç« éƒ½è¯´javaæœ‰å››ç§å†…éƒ¨ç±»ã€‚æˆå‘˜å†…éƒ¨ç±»ï¼Œé™æ€å†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ã€åŒ¿åå†…éƒ¨ç±»ã€‚è®°æ€§å¥½çš„å¯ä»¥ç›´æ¥è®°ä½ï¼Œå½·ä½›å›åˆ°äº†è¯»ä¹¦æ—¶ä»£ã€‚</p><h1 id="å››å¤§å†…éƒ¨ç±»"><a href="#å››å¤§å†…éƒ¨ç±»" class="headerlink" title="å››å¤§å†…éƒ¨ç±»"></a>å››å¤§å†…éƒ¨ç±»</h1><h2 id="æˆå‘˜å†…éƒ¨ç±»"><a href="#æˆå‘˜å†…éƒ¨ç±»" class="headerlink" title="æˆå‘˜å†…éƒ¨ç±»"></a>æˆå‘˜å†…éƒ¨ç±»</h2><p>javaæ˜¯ä¸€é—¨å¼ºå¤§çš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ã€‚åœ¨javaä¸­ï¼Œä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—è¿™æ ·çš„åŸºç¡€æ•°æ®ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°ç»„ã€Mapè¿™æ ·çš„å¤æ‚æ•°æ®ç±»å‹ï¼Œç”šè‡³å¯ä»¥æ˜¯åˆ«çš„ç±»çš„å®ä¾‹ï¼Œé‚£ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯ä¸€ä¸ªç±»å‘¢ï¼Ÿ</p><p>æ‰€ä»¥æŠŠä¸€ä¸ªç±»æ”¾åœ¨javaçš„æˆå‘˜å˜é‡ä½ç½®ä¸Šï¼Œè¿™ä¸ªç±»å°±æ˜¯æˆå‘˜å†…éƒ¨ç±»ï¼Œæ”¾åˆ°é™æ€å˜é‡ä½ç½®ä¸Šï¼Œè¿™ä¸ªç±»å°±æ˜¯é™æ€å†…éƒ¨ç±»ã€‚</p><p>æ‰€ä»¥å¾ˆå®¹æ˜“å†™å‡ºè¿™æ ·çš„ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">xxxOuterClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;1212&quot;</span>;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Inner</span>&#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span>&#123;</span><br><span class="line">            System.out.println(a); <span class="comment">//æ ‡è®°1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TY</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">xxxOuterClass</span> <span class="variable">n</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">xxxOuterClass</span>();</span><br><span class="line">        xxxOuterClass.<span class="type">Inner</span> <span class="variable">m</span> <span class="operator">=</span> n.<span class="keyword">new</span> <span class="title class_">Inner</span>(); <span class="comment">//æ ‡è®°2</span></span><br><span class="line">        m.log();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>javaè¿™é—¨è¯­è¨€å•ä»é•¿ç›¸ä¸Šè¿˜æ˜¯æŒºåƒtypescriptçš„ã€‚ä½†æ˜¯typescriptæ˜¯æ²¡æœ‰å†…éƒ¨ç±»æ¦‚å¿µçš„ã€‚ä¸Šé¢é‚£æ®µä»£ç æœ‰å‡ å¤„å¥‡æ€ªçš„åœ°æ–¹ï¼Œé¦–å…ˆæ˜¯æ ‡è®°1é‚£ä¸ªå­¤é›¶é›¶çš„aå˜é‡ï¼Œå®é™…ä¸Šjavaä¼šå…ˆæ‰¾Innerä¸Šæœ‰æ²¡æœ‰å«açš„æˆå‘˜å˜é‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†å»æ‰¾xxxOuterClassã€‚</p><p>å†æ¥çœ‹æ ‡è®°2ï¼Œå†…éƒ¨ç±»æ˜¯æ€ä¹ˆè¢«å®ä¾‹åŒ–çš„ã€‚æˆå‘˜å†…éƒ¨ç±»ä¾é™„äºå®ƒæ‰€å¯¹åº”çš„å¤–éƒ¨ç±»ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®ä¾‹åŒ–ä¸€ä¸ªå¤–éƒ¨ç±»ã€‚è¿™ä¸å¥‡æ€ªï¼Œæƒ³ä¹Ÿèƒ½æƒ³é€šï¼Œå¥‡æ€ªçš„æ˜¯new æ“ä½œç¬¦å°±ç„¶å¯ä»¥é‚£æ ·ä½¿ç”¨ã€‚æŒ‰ç…§æ­£å¸¸çš„æ€ç»´ï¼Œéš¾é“ä¸æ˜¯xxxOuterClass.Inner m &#x3D; new n.Inner()å—ï¼Ÿ</p><p>æ—¢ç„¶ä¸€ä¸ªç±»å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªç±»çš„æˆå‘˜ï¼Œé‚£ä¹ˆInneræ˜¯å¦èƒ½è¢«è®¿é—®ä¿®é¥°ç¬¦ä¿®é¥°å‘¢ï¼Ÿå®é™…ä¸Šåˆ†åˆ«ç”¨publicã€protectedã€privateä¿®é¥°Innerï¼Œå¹¶ä¸æŠ¥é”™ï¼Œåªä¸è¿‡ç”¨privateä¿®é¥°Innerï¼Œåœ¨TYä¸­ä¸èƒ½å®ä¾‹åŒ–Innerã€‚é‚£ç»§æ‰¿å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TY2</span> <span class="keyword">extends</span> <span class="title class_">xxxOuterClass</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TY2</span> <span class="variable">ty</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TY2</span>();</span><br><span class="line">        TY2.<span class="type">Inner</span> <span class="variable">inner</span> <span class="operator">=</span> ty.<span class="keyword">new</span> <span class="title class_">Inner</span>();</span><br><span class="line">        inner.log();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><h2 id="é™æ€å†…éƒ¨ç±»"><a href="#é™æ€å†…éƒ¨ç±»" class="headerlink" title="é™æ€å†…éƒ¨ç±»"></a>é™æ€å†…éƒ¨ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">xxxOuterClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;1212&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Inner</span>&#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;cwwd&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TY</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        xxxOuterClass.<span class="type">Inner</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">xxxOuterClass</span>.Inner();</span><br><span class="line">        m.log();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™æ€å†…éƒ¨ç±»å’Œé™æ€å˜é‡å·®ä¸å¤šã€‚</p><h2 id="å±€éƒ¨å†…éƒ¨ç±»"><a href="#å±€éƒ¨å†…éƒ¨ç±»" class="headerlink" title="å±€éƒ¨å†…éƒ¨ç±»"></a>å±€éƒ¨å†…éƒ¨ç±»</h2><p>æ‰€è°“å±€éƒ¨å†…éƒ¨ç±»å°±æ˜¯è¯´ä¸€ä¸ªç±»å¯ä»¥å†™åˆ°æŸä¸ªæ–¹æ³•å†…éƒ¨ã€‚ ä½ ç”¨å­¦jsçš„æ€ç»´å»å­¦javaå°±æ„Ÿè§‰ç‰¹åˆ«çƒ¦ï¼Œä»€ä¹ˆèŠ±èŠ±è‰è‰éƒ½è¦èµ·ä¸ªåå­—ã€‚è¿™ä¸æ˜¯ç†æ‰€å½“ç„¶çš„å—ï¼Ÿ</p><h2 id="åŒ¿åå†…éƒ¨ç±»"><a href="#åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»"></a>åŒ¿åå†…éƒ¨ç±»</h2><p>åŒ¿åå†…éƒ¨ç±»ä¸æ˜¯è¯´æŸä¸ªç±»æ²¡æœ‰åå­—ï¼Œè€Œæ˜¯è¯´ä½ å¯ä»¥ç›´æ¥ç»§æ‰¿&#x2F;å®ç°æŸä¸ªç±»ï¼Œç„¶åç›´æ¥newï¼Œä¸ç”¨å†™é‚£ä¹ˆå¤šç¹æ–‡ç¼›èŠ‚ã€‚é€šå¸¸é…åˆæ¥å£ä¸æŠ½è±¡ç±»æ¥ä½¿ç”¨ã€‚çœ‹ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span>  <span class="title class_">xxxFoo</span>&#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">xxxFoo2</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">log2</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TY</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">xxxFoo</span> <span class="variable">foo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">xxxFoo</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;xxxFoo log&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">xxxFoo2</span> <span class="variable">foo2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">xxxFoo2</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log2</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;xxxFoo2 log&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨javaä¸­ï¼ŒæŠ½è±¡ç±»åªèƒ½è¢«ç»§æ‰¿ï¼Œä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œæ¥å£åªèƒ½è¢«å®ç°ï¼Œä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ã€‚ç°åœ¨æœ‰äº†ç‰¹ä¾‹ï¼Œé™¤éè¢«ç”¨äºåŒ¿åå†…éƒ¨ç±»ã€‚</p><p>ä¸Šé¢çš„ä»£ç æŒ‰æ­£å¸¸æ€è·¯åº”è¯¥è¿™æ ·å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span>  <span class="title class_">xxxFoo</span>&#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">xxxFoo2</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">log2</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TY</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">xxxFoo3</span> <span class="keyword">extends</span> <span class="title class_">xxxFoo</span>&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;log1&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">xxxFoo3</span> <span class="variable">foo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">xxxFoo3</span>();</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">xxxFoo4</span> <span class="keyword">implements</span> <span class="title class_">xxxFoo2</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log2</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;log2&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸæ¥å¦‚æ­¤ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰€è°“åŒ¿åï¼Œç¡®å®çœäº†ä¸¤ä¸ªåå­—ã€‚ä½†æ˜¯è½¬å¿µä¸€æƒ³ï¼Œè¿™ä¸æ˜¯æ¦‚å¿µå†²çªå˜›ï¼Œæ˜æ˜æŠ½è±¡ç±»å’Œæ¥å£éƒ½ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œä¸ºå•¥ç”¨äºåŒ¿åå†…éƒ¨ç±»å°±å¯ä»¥ã€‚å…¶å®åŒ¿åå†…éƒ¨ç±»æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œjavaç¼–è¯‘å™¨ä¼šå¸®å¿™è¡¥é½ç¼ºå¤±çš„è¯­æ³•ã€‚ç¨å¾®æ”¹ä¸€ä¸‹ä¸Šé¢çš„ä¾‹å­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span>  <span class="title class_">xxxFoo</span>&#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">xxxFoo2</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">log2</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TY</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">xxxFoo</span> <span class="variable">foo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">xxxFoo</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;log1&quot;</span>);</span><br><span class="line">                System.out.println(<span class="built_in">this</span>.getClass()); <span class="comment">// class TY$1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">xxxFoo2</span> <span class="variable">foo2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">xxxFoo2</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log2</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;log2&quot;</span>);</span><br><span class="line">                System.out.println(<span class="built_in">this</span>.getClass()); <span class="comment">// class TY$2</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        foo.log();</span><br><span class="line">        foo2.log2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æ²¡æœ‰ï¼Œè¿˜æ˜¯ä¼šæœ‰ç±»ï¼Œåªä¸è¿‡ä¸ç”¨å¼€å‘è€…æ“å¿ƒã€‚</p><h1 id="ç›´æ¥ç»§æ‰¿å†…éƒ¨ç±»"><a href="#ç›´æ¥ç»§æ‰¿å†…éƒ¨ç±»" class="headerlink" title="ç›´æ¥ç»§æ‰¿å†…éƒ¨ç±»"></a>ç›´æ¥ç»§æ‰¿å†…éƒ¨ç±»</h1><p>æˆ‘ä»¬å¯ä»¥å…ˆå®ä¾‹åŒ–å‡ºå¤–éƒ¨ç±»ï¼Œç„¶åå†å®ä¾‹åŒ–å‡ºå†…éƒ¨ç±»ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ç»§æ‰¿ä¸€ä¸ªå†…éƒ¨ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">xxxxOuter</span>&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">xxxInner</span>&#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;log&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">xxxInner2</span> <span class="keyword">extends</span> <span class="title class_">xxxxOuter</span>.xxxInner&#123;</span><br><span class="line">    xxxInner2(xxxxOuter wi)&#123;</span><br><span class="line">        wi.<span class="built_in">super</span>(); <span class="comment">//æ ‡è®°1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">xxxInner2</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">xxxInner2</span>(<span class="keyword">new</span> <span class="title class_">xxxxOuter</span>());</span><br><span class="line">        m.log();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆå‘˜å†…éƒ¨ç±»ä¾èµ–ä¸å¤–éƒ¨ç±»ï¼Œæ‰€ä»¥xxxInner2çš„æ„é€ å‡½æ•°å¿…é¡»æ¥æ”¶ä¸€ä¸ªxxxxOuterçš„å®ä¾‹ï¼Œç„¶åè°ƒç”¨å…¶superæ–¹æ³•ã€‚</p><p>ä½†æ˜¯å¥‡æ€ªçš„æ˜¯ï¼Œåœ¨æˆ‘çš„ideaä¸Šwi.superæ ‡çº¢äº†ï¼Œideaè®¤ä¸ºwiä¸Šæ²¡æœ‰superè¿™ä¸ªæ–¹æ³•ï¼Ÿä½†å´å¯ä»¥è¿è¡Œï¼ä¸ºå•¥è¿™é‡Œéœ€è¦è°ƒç”¨wiä¸Šçš„superæ–¹æ³•ï¼Œsuperä¸æ˜¯è¡¨ç¤ºçˆ¶ç±»&#x2F;çˆ¶ç±»æ„é€ å™¨å˜›ï¼ŒxxxxOuterå¹¶æ²¡æœ‰çˆ¶ç±»ï¼Œä¸ºå•¥è¿™é‡Œä¸å†™æˆwi.constructor()ä¹‹ç±»çš„æ›´è¯­ä¹‰åŒ–çš„apiï¼Ÿ</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ vue-clamp</title>
      <link href="/2021/12/21/%E5%AD%A6%E4%B9%A0vue-clamp/"/>
      <url>/2021/12/21/%E5%AD%A6%E4%B9%A0vue-clamp/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><a href="https://github.com/Justineo/vue-clamp">é¡¹ç›®åœ°å€</a></p><p>æ— æ„é—´çœ‹åˆ°è¿™ä¸ªåº“ï¼Œåˆ©ç”¨getClientRectsä¸äºŒåˆ†æ³•å®ç°å¤šè¡Œæ–‡å­—çš„è¶…å‡ºæˆªæ–­ï¼Œè™½è¯´flexæ›´ç®€æ´ï¼Œä½†æ˜¯æƒ³èµ·æˆ‘nå¹´å‰å…¼å®¹IEæ—¶çš„ç—›æ¥šï¼Œè™½è¯´ç°åœ¨ä¸ç”¨å…¼å®¹IEäº†ï¼Œä½†æ˜¯åŸç†ä»€ä¹ˆçš„è¿˜æ˜¯å¿ä¸ä½ç…ä¸€çœ¼ã€‚</p><p>å…³é”®æ˜¯çŸ¥ä¸çŸ¥é“<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getClientRects">getClientRects</a> ã€‚è¿™ç©æ„å…¼å®¹æ€§å¥½å¼ºå¤§ã€‚å‡å¦‚æ˜¯è¡Œå†…å…ƒç´ è°ƒç”¨getClientRectsï¼Œä¼šè¿”å›ä¸€ä¸ªrectsé›†åˆï¼Œè¿™ä¸ªé›†åˆçš„lengthå°±æ˜¯æ–‡æœ¬çš„è¡Œæ•°ï¼Œå¥½ç®€æ´ï¼Œå®Œå…¨ä¸ç”¨å…³å¿ƒè¡Œé«˜ä»€ä¹ˆçš„ã€‚</p><h1 id="api"><a href="#api" class="headerlink" title="api"></a>api</h1><ol><li>tag: ç”±äºå†…éƒ¨æ˜¯ç”±renderå‡½æ•°ç”Ÿæˆçš„vnodeï¼Œæ¯”èµ·templateï¼Œtagæ˜¯å¯ä»¥å˜çš„ï¼Œé»˜è®¤æ˜¯divã€‚</li><li>autoresize: å†…éƒ¨ä½¿ç”¨resize-detectorè¿™ä¸ªåº“ç›‘å¬ç»„ä»¶çš„resizeäº‹ä»¶ï¼Œsizeå˜åŒ–æ—¶ï¼Œæ›´æ–°æˆªæ–­çŠ¶æ€ã€‚</li><li>max-lines: æœ€å¤§è¡Œæ•°</li><li>max-height: æœ€å¤§é«˜åº¦ã€‚max-heightä¸max-linesæŒ‡å®šä¸€ä¸ªå³å¯ã€‚</li><li>ellipsis: çœç•¥ç¬¦å·ï¼Œé»˜è®¤â€¦</li><li>location: ellipsisçš„ä½ç½®ï¼Œé»˜è®¤endã€‚</li><li>expanded: åˆå§‹çŠ¶æ€æ˜¯å¦å±•å¼€ï¼Œé»˜è®¤falseã€‚</li></ol><p>slot</p><ol><li>defaultï¼šé»˜è®¤æ’æ§½ä¸ºæ–‡æœ¬çš„å®é™…å†…å®¹ï¼ˆéå±•ç¤ºå†…å®¹ï¼‰ã€‚</li><li>after&#x2F;beforeï¼šè¿™ä¿©æ’æ§½å–å…¶ä¸€ï¼Œå…³äºå®ƒä»¬çš„slot scopeåé¢ä¼šè¯´ã€‚</li></ol><h1 id="ç”¨ä»£ç ç®€è¿°åŸç†"><a href="#ç”¨ä»£ç ç®€è¿°åŸç†" class="headerlink" title="ç”¨ä»£ç ç®€è¿°åŸç†"></a>ç”¨ä»£ç ç®€è¿°åŸç†</h1><p>vueç»„ä»¶ä¸å¥½è§£é‡Šï¼Œè¯­æ³•çµæ´»&#x2F;éšæ„ï¼Œå„ç§æ•°æ®è‡ªåŠ¨å“åº”ï¼Œè®¡ç®—å±æ€§ä»€ä¹ˆçš„äº’ç›¸ä¾èµ–ï¼Œè¯»èµ·æ¥æŒºçˆ½çš„ï¼Œç»™åˆ«äººè§£é‡Šå¯å¤ªéš¾äº†ã€‚æ‰€ä»¥æˆ‘å…ˆå†™ä¸ªå°è€Œç¾çš„clampï¼Œæ–¹ä¾¿ç†è§£æ ¸å¿ƒåŸç†ã€‚</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">props</span>:&#123;</span><br><span class="line">      <span class="attr">lines</span>:&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">          <span class="attr">default</span>: <span class="number">3</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">text</span>:<span class="variable language_">this</span>.<span class="title function_">getText</span>(),</span><br><span class="line">            <span class="attr">offsetSet</span>: <span class="variable language_">this</span>.<span class="title function_">getText</span>().<span class="property">length</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> [content] = <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ref</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;content&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="title function_">isOverflow</span>())&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">search</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>:&#123;</span><br><span class="line">        <span class="title function_">search</span>(<span class="params"><span class="keyword">from</span>=<span class="number">0</span>,to=<span class="variable language_">this</span>.text.length</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(to-<span class="keyword">from</span>&lt;=<span class="number">3</span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">offset</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>((<span class="keyword">from</span> + to) / <span class="number">2</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">text</span>.<span class="property">textContent</span> = <span class="variable language_">this</span>.<span class="property">text</span>.<span class="title function_">slice</span>(<span class="number">0</span>,<span class="variable language_">this</span>.<span class="property">offset</span>)</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="title function_">isOverflow</span>())&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">search</span>(<span class="keyword">from</span>,<span class="variable language_">this</span>.<span class="property">offset</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">search</span>(<span class="variable language_">this</span>.<span class="property">offset</span>,to)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">getText</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">const</span> [content] = (<span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span> || []).<span class="title function_">filter</span>(</span><br><span class="line">                <span class="function">(<span class="params">node</span>) =&gt;</span> !node.<span class="property">tag</span> &amp;&amp; !node.<span class="property">isComment</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> content ? content.<span class="property">text</span> : <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">getLines</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">text</span>.<span class="title function_">getClientRects</span>().<span class="property">length</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">isOverflow</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">getLines</span>() &gt; <span class="variable language_">this</span>.<span class="property">lines</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªæœ‰ä¸€ä¸ªpropsï¼ˆlinesï¼šè¡¨ç¤ºæ–‡æœ¬çš„è¡Œæ•°ï¼‰ï¼Œdataé‡Œé¢æœ‰ä¸¤ä¸ªå±æ€§textä¸offsetï¼Œtextè¡¨ç¤ºåŸå§‹çš„æ–‡æœ¬ï¼Œoffsetæ˜¯ä¸ªä¿¡æ ‡ï¼Œè¡¨ç¤ºå‘ç”Ÿæˆªæ–­çš„ä½ç½®ï¼Œåªè¦offsetä¸ç­‰äºtextçš„é•¿åº¦ï¼Œå°±è®¤ä¸ºæ–‡æœ¬å‘ç”Ÿäº†æˆªæ–­ã€‚</p><p>renderå‡½æ•°é‡Œé¢æ‹¿åˆ°äº†é»˜è®¤æ’æ§½çš„vnodeï¼Œå¹¶ç”¨spanæ¸²æŸ“å‡ºæ¥ï¼Œä¸ºä»€ä¹ˆæ˜¯spanï¼Œå› ä¸ºåªæœ‰è¡Œå†…å…ƒç´ è°ƒç”¨getClientRectsæ‰ä¼šè¿”å›æ–‡æœ¬é•¿åº¦ã€‚ä»è¿™é‡Œè¿˜å¯ä»¥çœ‹å‡ºï¼Œæ’æ§½ä¸æ¸²æŸ“ç«Ÿç„¶å¯ä»¥åˆ†å¼€ï¼ï¼<br>ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¼šæ¸²æŸ“å‡ºå…¨éƒ¨æ–‡æœ¬ï¼Œåœ¨mountedé‡Œé¢é€šè¿‡isOverflowåˆ¤æ–­æ˜¯å¦æº¢å‡ºï¼Œå³æ–‡æœ¬çš„å®é™…è¡Œæ•°æ˜¯å¦å¤§äºprops.linesï¼Œå¦‚æœå‘ç”Ÿäº†æº¢å‡ºï¼Œè°ƒç”¨searchæ–¹æ³•ï¼Œsearchæ–¹æ³•ä½¿ç”¨äº†äºŒåˆ†æ³•ä¸åœçš„æ”¹å˜offsetçš„ä½ç½®ï¼Œç›´åˆ°fromä¸toçš„å·®å€¼å°äºç­‰äº3ï¼Œä¸ºä»€ä¹ˆæ˜¯3å‘¢ï¼Œæˆ‘çŒœæ˜¯çœç•¥å·(â€¦)çš„é•¿åº¦ï¼Œè¿™æ ·å°±ç®—å‡ºäº†æœ€ä½³çš„offsetä»¥åŠæœ€ä½³çš„æˆªæ–­æ–‡æœ¬ã€‚</p><h1 id="æºç è§£è¯»"><a href="#æºç è§£è¯»" class="headerlink" title="æºç è§£è¯»"></a>æºç è§£è¯»</h1><p>æºç ä¸æˆ‘é‚£ä¸ªæœ‰ä»€ä¹ˆä¸åŒï¼š</p><ol><li>æ”¯æŒæ›´å¤šçš„props</li><li>æ£€æµ‹å…ƒç´ çš„å°ºå¯¸æ˜¯å¦å‘ç”Ÿå˜åŒ–</li><li>æ”¯æŒæ›´å¤šçš„æ’æ§½</li></ol><p>å¯ä»¥è‡ªå®šä¹‰tagï¼Œè®¾ç½®æ˜¯å¦æ£€æµ‹å…ƒç´ çš„å°ºå¯¸å˜åŒ–ï¼Œæ˜¯å¦ä»¥maxHeightä»£æ›¿maxLinesï¼Œè®¾ç½®çœç•¥å·çš„æ–‡æœ¬ï¼ˆé»˜è®¤æ˜¯â€¦ï¼‰ï¼Œä»¥åŠçœç•¥å·çš„ä½ç½®ã€‚expandedè®¾ç½®åˆæ¬¡æ¸²æŸ“æ˜¯å¦å±•å¼€æ–‡æœ¬.</p><p>å…ˆä»renderå‡½æ•°çœ‹èµ·ã€‚<br><a href="https://github.com/Justineo/vue-clamp/blob/master/src/components/Clamp.js#L227">render</a><br>æ•´ä½“æ¥çœ‹ï¼Œå¤šäº†beforeä¸afteræ’æ§½çš„é€»è¾‘ï¼Œbeforeä¸afterå–å…¶ä¸€ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯this.$scopedSlotsè¿™ä¸ªapiï¼Œä½œç”¨åŸŸæ’æ§½åœ¨renderå‡½æ•°é‡Œé¢ç«Ÿç„¶æ˜¯è¿™æ ·ç”¨çš„ï¼Œscopeå°±æ˜¯ä¼ é€’ç»™æ’æ§½çš„ä½œç”¨åŸŸï¼Œthis.$scopedSlots.before&#x2F;afer(scope)çš„ç»“æœæ˜¯vnodeã€‚ç„¶åç«Ÿç„¶å¯ä»¥æŠŠç»„ä»¶çš„æ–¹æ³•ä¼ ç»™scopeï¼Œåˆå­¦åˆ°äº†ã€‚</p><p>mountedè°ƒç”¨initï¼Œinitå†…éƒ¨æœ‰ä¸€äº›æ˜¯å¦æ£€æµ‹å…ƒç´ å°ºå¯¸å˜åŒ–çš„é€»è¾‘ï¼Œç”¨äº†resize-detectorï¼Œè¿™ä¸ªåº“ä¹Ÿæ˜¯ä½œè€…å†™çš„ï¼Œinitæœ€ç»ˆè°ƒç”¨updateã€‚updateå¼€ç¯‡æœ‰ä¸ªlocalExpandedï¼Œè¿™ä¸ªå°±æ˜¯props.expandedï¼Œå†…éƒ¨å†™äº†å‡ ä¸ªwatchæ¥åŒæ­¥ä¸¤è€…çš„çŠ¶æ€ã€‚ç„¶åè°ƒç”¨searchï¼Œå’Œä¸Šé¢çš„ç²¾ç®€ç‰ˆä¸ä¸€æ ·çš„æ˜¯å¤šäº†ä¸ªstepToFitæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å¾®è°ƒoffsetï¼Œå³åœ¨ç”¨äºŒåˆ†æ³•å¾—åˆ°æœ€ç»ˆçš„æ–‡æœ¬åï¼Œæœ€åä¸€è¡Œæ–‡æœ¬çš„é•¿åº¦å¯èƒ½ä¸æ»¡ä¸€è¡Œï¼Œå…ˆè°ƒç”¨fillæ–¹æ³•ä½¿æ–‡æœ¬å……æ»¡ä¸€è¡Œï¼ˆå¯èƒ½å‘ç”Ÿæ¢è¡Œï¼‰ï¼Œç„¶åè°ƒç”¨clampæ–¹æ³•ä½¿æ–‡æœ¬åˆšå¥½å……æ»¡ä¸€è¡Œã€‚</p><p>åŸç†å°±æ˜¯è¿™æ ·ã€‚çœ‹ä¸€ä¸‹githubä¸Šçš„demoã€‚</p><p>before&#x2F;afteræ’æ§½æ˜¯ä¸ªbuttonï¼Œç‚¹å‡»buttonè°ƒç”¨äº†toggleæ–¹æ³•ã€‚</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">toggle () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">localExpanded</span> = !<span class="variable language_">this</span>.<span class="property">localExpanded</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å¥è¯ä¼šè§¦å‘localExpandedçš„watch</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (val) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">clampAt</span>(<span class="variable language_">this</span>.<span class="property">text</span>.<span class="property">length</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">update</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœlocalExpandedä¸ºtrueï¼Œè¿˜åŸæ–‡æœ¬ï¼Œå¦åˆ™ï¼Œé‡æ–°æˆªæ–­æ–‡æœ¬ã€‚</p><p>æœ€åï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯mountedé‡Œé¢çš„watchå†™æ³•</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.$watch(</span><br><span class="line">  <span class="function">(<span class="params">vm</span>) =&gt;</span> [vm.<span class="property">maxLines</span>, vm.<span class="property">maxHeight</span>, vm.<span class="property">ellipsis</span>, vm.<span class="property">isClamped</span>].<span class="title function_">join</span>(),</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">update</span></span><br><span class="line">)</span><br><span class="line"><span class="variable language_">this</span>.$watch(<span class="function">(<span class="params">vm</span>) =&gt;</span> [vm.<span class="property">tag</span>, vm.<span class="property">text</span>, vm.<span class="property">autoresize</span>].<span class="title function_">join</span>(), <span class="variable language_">this</span>.<span class="property">init</span>)</span><br></pre></td></tr></table></figure><p>åˆå­¦åˆ°äº†ï¼Œè¿™ç§åšæ³•å¯ä»¥åŒæ—¶watchå¤šä¸ªå‚æ•°ï¼Œæ‰§è¡Œç›¸åŒçš„é€»è¾‘ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ ahooksä¹‹useRequest</title>
      <link href="/2021/12/03/%E5%AD%A6%E4%B9%A0ahooks%E4%B9%8BuseRequest/"/>
      <url>/2021/12/03/%E5%AD%A6%E4%B9%A0ahooks%E4%B9%8BuseRequest/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ahooksç®—æ˜¯react hooksç”Ÿæ€åº“é‡è¦çš„ä¸€ç¯ï¼Œå…¶ä¸­useRequestç®—æ˜¯ä½¿ç”¨æ¯”è¾ƒå¤šçš„hooksã€‚ï¼ˆè¯•é—®å“ªä¸ªå‰ç«¯é¡µé¢æ²¡æœ‰httpè¯·æ±‚ï¼‰</p><h1 id="useRequestçš„è‡ªæˆ‘ä»‹ç»"><a href="#useRequestçš„è‡ªæˆ‘ä»‹ç»" class="headerlink" title="useRequestçš„è‡ªæˆ‘ä»‹ç»"></a>useRequestçš„è‡ªæˆ‘ä»‹ç»</h1><p>useRequest æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¼‚æ­¥æ•°æ®ç®¡ç†çš„ Hooksï¼ŒReact é¡¹ç›®ä¸­çš„ç½‘ç»œè¯·æ±‚åœºæ™¯ä½¿ç”¨ useRequest å°±å¤Ÿäº†ã€‚</p><p>useRequest é€šè¿‡æ’ä»¶å¼ç»„ç»‡ä»£ç ï¼Œæ ¸å¿ƒä»£ç æå…¶ç®€å•ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰©å±•å‡ºæ›´é«˜çº§çš„åŠŸèƒ½ã€‚ç›®å‰å·²æœ‰èƒ½åŠ›åŒ…æ‹¬â€¦.</p><p>ä¸»è¦æ˜¯ç¬¬äºŒå¥ï¼šuseRequestçš„æ ¸å¿ƒä»£ç å¾ˆç®€å•ï¼Œå…¶ä»–ä»€ä¹ˆé˜²æŠ–ã€èŠ‚æµéƒ½æ˜¯é€šè¿‡æ’ä»¶å®ç°çš„ã€‚</p><h1 id="ä»£ç åˆ†å±‚"><a href="#ä»£ç åˆ†å±‚" class="headerlink" title="ä»£ç åˆ†å±‚"></a>ä»£ç åˆ†å±‚</h1><p>å¸¦ç€ä¸Šä¸€èŠ‚çš„å®˜æ–¹ä»‹ç»æ¥çœ‹useRequestçš„ä»£ç åˆ†å±‚<br><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/useRequest.ts">å…¥å£æ–‡ä»¶</a></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> useRequest&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span> <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt;(</span><br><span class="line">  <span class="attr">service</span>: <span class="title class_">Service</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;,</span><br><span class="line">  options?: <span class="title class_">Options</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;,</span><br><span class="line">  plugins?: <span class="title class_">Plugin</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;[],</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">return</span> useRequestImplement&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;(service, options, [</span><br><span class="line">    ...(plugins || []),</span><br><span class="line">    useDebouncePlugin,</span><br><span class="line">    useLoadingDelayPlugin,</span><br><span class="line">    usePollingPlugin,</span><br><span class="line">    useRefreshOnWindowFocusPlugin,</span><br><span class="line">    useThrottlePlugin,</span><br><span class="line">    useRefreshDeps,</span><br><span class="line">    useCachePlugin,</span><br><span class="line">    useRetryPlugin,</span><br><span class="line">    useReadyPlugin,</span><br><span class="line">  ] <span class="keyword">as</span> <span class="title class_">Plugin</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;[]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>useRequestæ¥æ”¶serviceã€optionsã€pluginä¸‰ä¸ªå‚æ•°ï¼Œéšååˆè°ƒç”¨äº†useRequestImplementå‡½æ•°ï¼Œå‚æ•°ä¸ºserviceã€optionsï¼Œpluginså˜æˆè‡ªå®šä¹‰pluginsä¸å†…ç½®pluginsçš„é›†åˆã€‚</p><p>å…¶ä¸­serviceæ˜¯ä¸€ä¸ªè¿”å›promiseçš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å°è£…http requestçš„å‡½æ•°ã€‚optionsåˆ™æ˜¯ä¸€ä¸ªå‚æ•°å¤§é›†åˆï¼Œé™¤äº† <a href="https://ahooks-next.surge.sh/zh-CN/hooks/use-request/basic#options">base option</a> ä»¥å¤–ï¼Œè¿˜åŒ…æ‹¬å†…ç½®æ’ä»¶çš„optionsã€‚</p><p>ä»è¿™é‡Œå…¶å®å°è¯äº†å®˜æ–¹çš„è¯´æ³•ï¼šuseRequestçš„æ ¸å¿ƒåŠŸèƒ½ç®€å•ï¼Œå…¶ä»–çš„åŠŸèƒ½éƒ½æ˜¯æ’ä»¶å®ç°çš„ï¼ˆåŒ…æ‹¬å†…ç½®æ’ä»¶ä¸è‡ªå®šä¹‰æ’ä»¶ï¼‰ã€‚æ‰’ä¸€æ‰’useRequestImplementçš„æºç ï¼Œçœ‹çœ‹å¤§ä½¬æ‰€è¯´çš„ç®€å•åˆ°åº•æœ‰å¤šç®€å•ã€‚</p><p><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/useRequestImplement.ts#L12">useRequestImplement</a></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> useRequestImplement&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span> <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt;(</span><br><span class="line">  <span class="attr">service</span>: <span class="title class_">Service</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;,</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Options</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt; = &#123;&#125;,</span><br><span class="line">  <span class="attr">plugins</span>: <span class="title class_">Plugin</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;[] = [],</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; manual = <span class="literal">false</span>, ...rest &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fetchOptions = &#123;</span><br><span class="line">    manual,</span><br><span class="line">    ...rest,</span><br><span class="line">  &#125;;  <span class="comment">//è¿™ä¸¤å¥æŒºè´¹è§£çš„ï¼Œå…¶å®å¯ä»¥æ›´ç®€ const fetchOptions = &#123;manual:false,...options&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> serviceRef = <span class="title function_">useLatest</span>(service); <span class="comment">//ç¬¬ä¸€ä¸ªæ—æ”¯useLatestã€‚</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="title function_">useUpdate</span>(); <span class="comment">// ç¬¬äºŒä¸ªæ—æ”¯</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fetchInstance = <span class="title function_">useCreation</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> initState = plugins.<span class="title function_">map</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p?.<span class="property">onInit</span>?.(fetchOptions)).<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">    <span class="comment">// ç¬¬å…­ä¸ªæ—æ”¯</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Fetch</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;(</span><br><span class="line">      serviceRef,</span><br><span class="line">      fetchOptions,</span><br><span class="line">      update,</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, ...initState),</span><br><span class="line">    );</span><br><span class="line">  &#125;, []); <span class="comment">// useCreationç¬¬ä¸‰ä¸ªæ—æ”¯</span></span><br><span class="line">  fetchInstance.<span class="property">options</span> = fetchOptions;</span><br><span class="line">  <span class="comment">// run all plugins hook</span></span><br><span class="line">  fetchInstance.<span class="property">pluginImpls</span> = plugins.<span class="title function_">map</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> <span class="title function_">p</span>(fetchInstance, fetchOptions)); <span class="comment">// ä»è¿™ä¸€å¥å¯ä»¥æ¨å‡ºæ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¥æ”¶fetchInstanceä¸fetchOptionsçš„å‡½æ•°ã€‚</span></span><br><span class="line">    <span class="comment">// æ‰§è¡Œæ‰€æœ‰çš„æ’ä»¶ï¼Œå¹¶æŠŠç»“æœå­˜åˆ°fetchInstance.pluginImplsä¸Š</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">useMount</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// ç¬¬å››ä¸ªæ—æ”¯</span></span><br><span class="line">    <span class="keyword">if</span> (!manual) &#123;</span><br><span class="line">      <span class="comment">// useCachePlugin can set fetchInstance.state.params from cache when init</span></span><br><span class="line">      <span class="keyword">const</span> params = fetchInstance.<span class="property">state</span>.<span class="property">params</span> || options.<span class="property">defaultParams</span> || [];</span><br><span class="line">      <span class="comment">// @ts-ignore</span></span><br><span class="line">      fetchInstance.<span class="title function_">run</span>(...params);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useUnmount</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// ç¬¬äº”ä¸ªæ—æ”¯</span></span><br><span class="line">    fetchInstance.<span class="title function_">cancel</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">loading</span>: fetchInstance.<span class="property">state</span>.<span class="property">loading</span>,</span><br><span class="line">    <span class="attr">data</span>: fetchInstance.<span class="property">state</span>.<span class="property">data</span>,</span><br><span class="line">    <span class="attr">error</span>: fetchInstance.<span class="property">state</span>.<span class="property">error</span>,</span><br><span class="line">    <span class="attr">params</span>: fetchInstance.<span class="property">state</span>.<span class="property">params</span> || [],</span><br><span class="line">    <span class="attr">cancel</span>: <span class="title function_">useMemoizedFn</span>(fetchInstance.<span class="property">cancel</span>.<span class="title function_">bind</span>(fetchInstance)),</span><br><span class="line">    <span class="attr">refresh</span>: <span class="title function_">useMemoizedFn</span>(fetchInstance.<span class="property">refresh</span>.<span class="title function_">bind</span>(fetchInstance)),</span><br><span class="line">    <span class="attr">refreshAsync</span>: <span class="title function_">useMemoizedFn</span>(fetchInstance.<span class="property">refreshAsync</span>.<span class="title function_">bind</span>(fetchInstance)),</span><br><span class="line">    <span class="attr">run</span>: <span class="title function_">useMemoizedFn</span>(fetchInstance.<span class="property">run</span>.<span class="title function_">bind</span>(fetchInstance)),</span><br><span class="line">    <span class="attr">runAsync</span>: <span class="title function_">useMemoizedFn</span>(fetchInstance.<span class="property">runAsync</span>.<span class="title function_">bind</span>(fetchInstance)),</span><br><span class="line">    <span class="attr">mutate</span>: <span class="title function_">useMemoizedFn</span>(fetchInstance.<span class="property">mutate</span>.<span class="title function_">bind</span>(fetchInstance)),</span><br><span class="line">  &#125; <span class="keyword">as</span> <span class="title class_">Result</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;;</span><br><span class="line">&#125;<span class="comment">// ç¬¬ä¸ƒä¸ªæ—æ”¯useMemoizedFn</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸€æ³¢ç²—ç•¥çš„é˜…è¯»è™½ç„¶é‡åˆ°äº†6ä¸ªæ—æ”¯ï¼Œä½†æ˜¯æ ¹æ®å˜é‡çš„å‘½åä»¥åŠå®˜æ–¹æ–‡æ¡£æˆ‘ä»¬å¯ä»¥çŒœä¸€çŒœuseRequestImplementéƒ½å¹²äº†ä»€ä¹ˆäº‹ã€‚</p><p><a href="https://ahooks-next.surge.sh/zh-CN/hooks/use-latest">useLatest</a><br><a href="https://ahooks-next.surge.sh/zh-CN/hooks/use-update">useUpdate</a><br><a href="https://ahooks-next.surge.sh/zh-CN/hooks/use-creation">useCreation</a><br><a href="https://ahooks-next.surge.sh/zh-CN/hooks/use-mount">useMount</a><br><a href="https://ahooks-next.surge.sh/zh-CN/hooks/use-unmount">useUnmount</a><br><a href="https://ahooks-next.surge.sh/zh-CN/hooks/use-memoized-fn">useMemoizedFn</a></p><p>é€šè¿‡æ–‡æ¡£å¯ä»¥çœ‹å‡ºuseLatestçš„ä½œç”¨æ˜¯è¿”å›æŸä¸ªå‚æ•°çš„æœ€æ–°å€¼ï¼ŒuseCreationçš„ä½œç”¨æ˜¯ä½¿æŸä¸ªå€¼ä¿æŒç»å¯¹ä¸å˜ï¼ˆé™¤éä¾èµ–å‘ç”Ÿå˜åŒ–ï¼‰,useMemoizedFnçš„ä½œç”¨æ˜¯ä½¿å‡½æ•°çš„åœ°å€æ°¸è¿œä¸å˜ã€‚è¿™ä¸‰ä¸ªéƒ½å±äºæ€§èƒ½ä¼˜åŒ–hookï¼Œå¯¹äºæˆ‘ä»¬ç†è§£useRequestå¯ä»¥æš‚æ—¶å¿½ç•¥ã€‚</p><p>è€ŒuseUpdateï¼Œé¡¾åæ€ä¹‰ï¼Œè¿”å›ä¸€ä¸ªå¼ºåˆ¶åˆ·æ–°çš„å‡½æ•°ï¼Œç”¨äºæ•´ä¸ªç»„ä»¶æ ‘é‡æ–°æ¸²æŸ“ã€‚</p><p>useMountä¸useUnmountå±äºç”Ÿå‘½å‘¨æœŸhookï¼Œåˆ†åˆ«åœ¨ç»„ä»¶æŒ‚è½½ä¸å¸è½½æ—¶è§¦å‘ã€‚</p><p>ç»¼ä¸Šï¼ŒuseRequestImplementåšçš„äº‹å…¶å®å°±æ˜¯ï¼Œé€šè¿‡new Fetchç”Ÿæˆä¸€ä¸ªfetchInstanceå®ä¾‹ï¼Œå‚æ•°é™¤äº†serviceRefã€fetchOptionsã€updateå¤–ï¼Œè¿˜æœ‰initStateã€‚ç…ä¸€çœ¼initStateã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initState = plugins.<span class="title function_">map</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p?.<span class="property">onInit</span>?.(fetchOptions)).<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">Plugin</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span> <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = &#123;</span><br><span class="line">  (<span class="attr">fetchInstance</span>: <span class="title class_">Fetch</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;, <span class="attr">options</span>: <span class="title class_">Options</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;): <span class="title class_">PluginReturn</span>&lt;</span><br><span class="line">    <span class="title class_">TData</span>,</span><br><span class="line">    <span class="title class_">TParams</span></span><br><span class="line">  &gt;;</span><br><span class="line">  onInit?: <span class="function">(<span class="params">options: Options&lt;TData, TParams&gt;</span>) =&gt;</span> <span class="title class_">Partial</span>&lt;<span class="title class_">FetchState</span>&lt;<span class="title class_">TData</span>, <span class="title class_">TParams</span>&gt;&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»è¿™ä¸¤å¤„å¯ä»¥çœ‹å‡ºæ¯ä¸ªpluginéƒ½å¯ä»¥æœ‰ä¸ªonInitå‡½æ•°ï¼Œè¿”å›å€¼æ˜¯éƒ¨åˆ†FetchStateå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„é›†åˆå°±æ˜¯initStateã€‚ ç…ä¸€çœ¼Fetchçš„æ„é€ å‡½æ•°ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> serviceRef: MutableRefObject&lt;Service&lt;TData, TParams&gt;&gt;,</span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> options: Options&lt;TData, TParams&gt;,</span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> subscribe: Subscribe,</span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> initState: Partial&lt;FetchState&lt;TData, TParams&gt;&gt; = &#123;&#125;,</span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      ...<span class="variable language_">this</span>.<span class="property">state</span>,</span><br><span class="line">      <span class="attr">loading</span>: !options.<span class="property">manual</span>,</span><br><span class="line">      ...initState,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼ŒonInitçš„ä½œç”¨å…¶å®å°±æ˜¯åœ¨åˆå§‹åŒ–fetchInstanceæ—¶ï¼Œé€šè¿‡æ’ä»¶çš„å½¢å¼ç”ŸæˆinitStateï¼ŒinitStateä¼šåœ¨new Fetchæ—¶ä½œä¸ºstateçš„é»˜è®¤å€¼ã€‚</p><p>å›åˆ°ä¸»çº¿ï¼Œç”ŸæˆfetchInstanceå®ä¾‹åï¼Œä¼šåœ¨fetchInstanceä¸Šæ”¾ä¸€äº›ä¸œè¥¿ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fetchInstance.<span class="property">options</span> = fetchOptions;</span><br><span class="line">  <span class="comment">// run all plugins hooks</span></span><br><span class="line">fetchInstance.<span class="property">pluginImpls</span> = plugins.<span class="title function_">map</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> <span class="title function_">p</span>(fetchInstance, fetchOptions)); <span class="comment">// ä»è¿™ä¸€å¥å¯ä»¥æ¨å‡ºæ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¥æ”¶fetchInstanceä¸fetchOptionsçš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œæ‰€æœ‰çš„æ’ä»¶ï¼Œå¹¶æŠŠç»“æœå­˜åˆ°fetchInstance.pluginImplsä¸Š</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/types.ts#L16">PluginReturn</a></p><p>pluginImplså…¶å®å°±æ˜¯ä¸€ä¸ªå«æœ‰onBeforeã€onRequestâ€¦ç­‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„å¯¹è±¡é›†åˆã€‚è€Œè¿™äº›ç”Ÿå‘½å‘¨æœŸå°±æ˜¯æ’ä»¶ç³»ç»Ÿçš„çµé­‚ã€‚Fetchå†…éƒ¨é€šè¿‡ä¸€ä¸ªå«runPluginHandlerçš„å‡½æ•°è°ƒç”¨å„ä¸ªæ’ä»¶ï¼ˆpluginImplsï¼‰ã€‚</p><p>å¤§æ¦‚ç…ä¸€çœ¼<a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/Fetch.ts#L37">runPluginHandler</a> çš„å®ç°</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">runPluginHandler</span>(<span class="params">event: keyof PluginReturn&lt;TData, TParams&gt;, ...rest: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> r = <span class="variable language_">this</span>.<span class="property">pluginImpls</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> i[event]?.(...rest)).<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, ...r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹Fetchå†…éƒ¨éƒ½åœ¨ä»€ä¹ˆæ—¶æœºè°ƒç”¨runPluginHandlerã€‚</p><p><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/Fetch.ts#L43">runAsync</a><br><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/Fetch.ts#L136">cancel</a><br><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/Fetch.ts#L155">mutate</a></p><p>runAsyncæ–¹æ³•ä¼šåœ¨è¯·æ±‚çš„å„ä¸ªé˜¶æ®µè°ƒç”¨runPluginHandlerï¼ˆè¯·æ±‚å‰&#x2F;ä¸­&#x2F;åâ€¦ï¼‰ï¼ŒonBefore&#x2F;onRequest&#x2F;onSuccessâ€¦ï¼Œè€Œè¿™äº›é’©å­å‡½æ•°æˆ–è€…ç›´æ¥å¹²é¢„runAsyncçš„æ‰§è¡Œï¼Œæˆ–è€…é€šè¿‡è¿”å›<a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/types.ts#L16">çº¦å®šçš„å€¼</a> æ¥å¹²é¢„runAsyncçš„æ‰§è¡Œã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæ‰€è°“çš„æ’ä»¶å°±æ˜¯ä¸€ä¸ªè¿”å›PluginReturnçš„å‡½æ•°ï¼Œè€ŒPluginReturnä¸­çš„å„ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¼šåœ¨Fetchçš„å…³é”®æ–¹æ³•æ‰§è¡Œæ—¶è°ƒç”¨ã€‚</p><p>è¿™å°±æ˜¯æ’ä»¶çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å†™æ’ä»¶æ¥æ‰§è¡Œä¸Šè¿°è¿‡ç¨‹ã€‚</p><p>å›åˆ°ä¸»çº¿ã€‚åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡ŒfetchInstance.run()ï¼ˆå‡è®¾manualä¸ºfalseï¼‰ï¼Œç»„ä»¶å¸è½½æ—¶æ‰§è¡ŒfetchInstance.cancel()ï¼Œç„¶åè¿”å›ä¸€å¤§å †fetchInstanceçš„å±æ€§&#x2F;æ–¹æ³•ã€‚</p><h1 id="æ—æ”¯"><a href="#æ—æ”¯" class="headerlink" title="æ—æ”¯"></a>æ—æ”¯</h1><h2 id="Fetchç±»"><a href="#Fetchç±»" class="headerlink" title="Fetchç±»"></a>Fetchç±»</h2><p>ç”¨é¢å‘å¯¹è±¡çš„æ€ç»´å°è£…äº†useRequestå…³äºç½‘ç»œè¯·æ±‚çš„å‡ ä¸ªapiï¼Œåœ¨è¿™é‡Œæ’ä¸€å¥è¯ï¼Œæˆ‘ä»¥å‰ä¸é‡è§†é¢å‘å¯¹è±¡é‚£ä¸€å¥—ä¸œè¥¿ï¼Œå…¶å®åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œé¢å‘å¯¹è±¡çš„å¯å°è£…æ€§ä¸ä»£ç çš„å¯è¯»æ€§æ˜¯ä¼˜äºå‡½æ•°å¼ç¼–ç¨‹çš„ï¼Œé…åˆtypescriptçš„ç±»å‹ç³»ç»Ÿå†™èµ·æ¥ä¸è¦å¤ªçˆ½ã€‚</p><p>Fetchæ´‹æ´‹æ´’æ´’150+ä»£ç ï¼Œä»runå‡½æ•°å¼€åˆ€ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="title function_">run</span>(<span class="params">...params: TParams</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">runAsync</span>(...params).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">onError</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>runå‡½æ•°è°ƒç”¨äº†runAsyncå‡½æ•°ã€‚é‚£runä¸runAsyncæœ‰å•¥åŒºåˆ«å‘¢ï¼Œæ–‡æ¡£æ˜¯è¿™æ ·å†™çš„ã€‚<br><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/65b965bf-b6f8-4928-a641-0b986ccc5274-image.png" alt="65b965bf-b6f8-4928-a641-0b986ccc5274-image.png"><br>è¿™å¥è¯å…·æœ‰è¯¯å¯¼ä½œç”¨ï¼ŒrunAsyncæœ¬è´¨ä¸Šæ˜¯ä¸ªasyncå‡½æ•°.<br><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/Fetch.ts#L94">onSuccess</a><br><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/Fetch.ts#L103">resolve</a><br><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/Fetch.ts#L115">onError</a><br><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/Fetch.ts#L124">reject</a><br>ä»£ç å¾ˆæ¸…æ™°ï¼Œrunè°ƒç”¨äº†runAsync,åè€…åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ç®¡æ˜¯optionsé‡Œé¢çš„success&#x2F;errorï¼Œè¿˜æ˜¯promiseå½¢å¼çš„resolve&#x2F;rejectéƒ½ä¼šæ‰§è¡Œã€‚</p><p>è€Œæ•´ä¸ªrunAsyncçš„æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œè¯·æ±‚å‰&#x2F;ä¸­&#x2F;åã€‚</p><p>è¯·æ±‚å‰ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">count</span> += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> currentCount = <span class="variable language_">this</span>.<span class="property">count</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  stopNow = <span class="literal">false</span>,</span><br><span class="line">  returnNow = <span class="literal">false</span>,</span><br><span class="line">  ...state</span><br><span class="line">&#125; = <span class="variable language_">this</span>.<span class="title function_">runPluginHandler</span>(<span class="string">&#x27;onBefore&#x27;</span>, params);</span><br><span class="line"></span><br><span class="line"><span class="comment">// stop request</span></span><br><span class="line"><span class="keyword">if</span> (stopNow) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">  <span class="attr">loading</span>: <span class="literal">true</span>,</span><br><span class="line">  params,</span><br><span class="line">  ...state,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// return now</span></span><br><span class="line"><span class="keyword">if</span> (returnNow) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(state.<span class="property">data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">onBefore</span>?.(params);</span><br></pre></td></tr></table></figure><p>å¯ä»¥å…ˆå¿½ç•¥é‚£ä¸ªå¥‡æ€ªçš„countï¼Œè¿˜æ˜¯æŒºç®€å•çš„ï¼Œå…ˆæ˜¯è°ƒç”¨äº†æ‰€æœ‰æ’ä»¶çš„onBeforeé’©å­ã€‚å¦‚æœstopNow &#x3D;&#x3D;&#x3D; trueï¼Œè¿”å›ä¸€ä¸ªç©ºçš„promiseï¼Œå¦åˆ™è°ƒç”¨setStateè®¾ç½®paramså’Œloadingï¼Œè¿™é‡Œçš„setStateå’Œreactçš„setStateæ˜¯é›·é”‹å’Œé›·å³°å¡”çš„å…³ç³»ã€‚<br><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/Fetch.ts#L29">setState</a></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setState</span>(<span class="params">s: Partial&lt;FetchState&lt;TData, TParams&gt;&gt; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">        ...<span class="variable language_">this</span>.<span class="property">state</span>,</span><br><span class="line">        ...s,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">subscribe</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨äº†ä¸€ä¸ªå¥‡æ€ªçš„subscribeå‡½æ•°ï¼Œè¿™ä¸ªsubscribeå°±æ˜¯Fetchå®ä¾‹åŒ–æ—¶ä¼ å…¥çš„updateå‡½æ•°ï¼ˆuseUpdateï¼‰ï¼Œç›®çš„æ˜¯ä½¿ç»„ä»¶rerenderï¼Œè®©reactç»„ä»¶æ‹¿åˆ°æœ€æ–°çš„Fetchæˆå‘˜å˜é‡ã€‚</p><p>å›åˆ°runAsyncä¸»çº¿ã€‚å¦‚æœreturnNow &#x3D;&#x3D;&#x3D; trueï¼Œè¿”å›ç©ºçš„promiseï¼Œä¸å‰ä¸€æ­¥éª¤ä¸åŒçš„æ˜¯ï¼Œè¿™æ—¶çš„loadingæ˜¯trueã€‚ç„¶åè°ƒç”¨optionsçš„onBeforeå‡½æ•°ï¼Œè¯´æ˜æ’ä»¶çš„onBeforeæ˜¯å…ˆäºoptions.onBeforeæ‰§è¡Œçš„ï¼Œå¹¶ä¸”å¯ä»¥å¹²é¢„æ˜¯å¦æ‰§è¡Œoptions.onBeforeã€‚</p><p>è¯·æ±‚ä¸­ä¸è¯·æ±‚ååˆ†åˆ«å¯¹åº”try&#x2F;catchä»£ç å—ï¼Œæš‚ä¸”å¿½ç•¥countï¼Œå…ˆè°ƒç”¨æ’ä»¶çš„onRequesté’©å­ï¼Œè¯·æ±‚å¯ä»¥åœ¨æ’ä»¶ä¸­å‘èµ·ï¼Œå‡å¦‚æ’ä»¶æ²¡æœ‰è¿”å›servicePromiseæˆ–è€…æ²¡æœ‰è¯·æ±‚ï¼ŒrunAsyncä¼šè‡ªå·±æ‰§è¡Œserverï¼Œè¯·æ±‚å®Œæˆä»¥åè®¾ç½®stateï¼Œè°ƒç”¨options.onSuccessï¼Œæ’ä»¶çš„onSuccessé’©å­ï¼Œoptions.onFinallyã€‚</p><p>è¯·æ±‚åä¸è¯·æ±‚ä¸­æ€è·¯ç±»ä¼¼ï¼Œå°±ä¸é‡å¤äº†ã€‚å›è¿‡å¤´æ¥çœ‹é‚£ä¸ªcountå‘ç°é™¤äº†runAsyncï¼Œcancelä¹Ÿè®¿é—®äº†countï¼Œä»è¿™é‡Œå¤§æ¦‚èƒ½çŒœåˆ°ï¼ŒrunAsyncä¸­ä¹‹æ‰€ä»¥æœ‰é‚£ä¹ˆå¤šcurrentCountä¸countçš„æ¯”å¯¹ï¼Œç›®çš„å°±æ˜¯æ£€æµ‹è¯·æ±‚æœ‰æ²¡æœ‰è¢«å–æ¶ˆï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„å–æ¶ˆé‚£æ¡è¯·æ±‚ï¼‰</p><p>å‰©ä¸‹çš„refreshã€refreshAsyncä¸mutateï¼Œå‰ä¸¤ä¸ªå°±ä¸è¯´äº†ï¼Œæ¥çœ‹<a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/Fetch.ts#L155">mutate</a> çš„å®ç°ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">targetData</span>: <span class="title class_">TData</span> | <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> data === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  targetData = <span class="title function_">data</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">data</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  targetData = data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">runPluginHandler</span>(<span class="string">&#x27;onMutate&#x27;</span>, targetData);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: targetData,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä»£ç å¾ˆæ¸…æ™°ï¼Œæ‰€åšçš„äº‹å°±æ˜¯ä¸è°ƒç”¨serverç›´æ¥setState(data)ï¼Œé¡ºä¾¿è°ƒç”¨æ’ä»¶çš„onMutateé’©å­ï¼Œä»ä»£ç æ¥çœ‹ï¼Œdataè¿˜å¯ä»¥æ˜¯ä¸ªå‡½æ•°ã€‚</p><h2 id="hooks"><a href="#hooks" class="headerlink" title="hooks"></a>hooks</h2><h3 id="useLatest"><a href="#useLatest" class="headerlink" title="useLatest"></a>useLatest</h3><p><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useLatest/index.ts">useLatest</a><br>ç®€ç®€å•å•å‡ è¡Œä»£ç ï¼Œé“ä¸å‡ºè¿™ä¸ªhooksçš„çœŸè°›ï¼Œæˆ‘ä»¬æ¥çœ‹å®˜æ–¹<a href="https://ahooks-next.surge.sh/zh-CN/hooks/use-latest">ä¾‹å­</a> ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useLatest &#125; <span class="keyword">from</span> <span class="string">&#x27;ahooks&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> latestCountRef = <span class="title function_">useLatest</span>(count);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> interval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(latestCountRef.<span class="property">current</span> + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(interval);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>count: &#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æŠŠuseLatestå»æ‰</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useLatest &#125; <span class="keyword">from</span> <span class="string">&#x27;ahooks&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// const latestCountRef = useLatest(count);</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> interval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(count+<span class="number">1</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(interval);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>count: &#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥è‡ªå·±ç”¨codesanboxè¿è¡Œè¿è¡Œä¸€ä¸‹è¿™æ®µä»£ç ï¼Œä¼šå‘ç°jsxä¸­countçš„å€¼æ°¸è¿œéƒ½æ˜¯1ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæ¯æ¬¡setIntervalåœ¨è§¦å‘å›è°ƒæ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°çš„åœ°å€éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è°ƒç”¨çš„å›è°ƒå‡½æ•°éƒ½æ˜¯åŒä¸€ä¸ªï¼Œä¸€æ—¦å‡½æ•°å”¯ä¸€ï¼Œè¯¥å‡½æ•°åœ¨åˆ›å»ºæ—¶æ‹¥æœ‰çš„é—­åŒ…å°±å”¯ä¸€ï¼Œè€Œcountåœ¨æ¯æ¬¡rerenderæ—¶éƒ½ä¼šé‡æ–°ç”Ÿæˆï¼Œæ‰€ä»¥å‚¨å­˜åœ¨setIntervalå‡½æ•°é—­åŒ…é‡Œçš„countæ°¸è¿œéƒ½æ˜¯ç¬¬ä¸€æ¬¡çš„countã€‚</p><p>ç¨å¾®æ”¹ä¸€ç‚¹ä»£ç ï¼ŒéªŒè¯ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">func</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;count&#x27;</span>,count)</span><br><span class="line">  <span class="title function_">setCount</span>(count+<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">func.<span class="property">time</span> = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line"><span class="keyword">const</span> interval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(func.<span class="property">time</span>)</span><br><span class="line">  <span class="title function_">func</span>()</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(interval);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡è¾“å‡ºçš„func.timeéƒ½æ˜¯åŒä¸€ä¸ªå€¼ï¼Œcountä¹Ÿæ˜¯åŒä¸€ä¸ªå€¼ã€‚è¿™å°±éªŒè¯äº†ä¸Šè¿°å‡½æ•°å”¯ä¸€ï¼Œé—­åŒ…å”¯ä¸€çš„ç»“è®ºã€‚</p><p>é‚£æ€ä¹ˆæ‰èƒ½è®©ä»£ç æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>å‡½æ•°ä¸å”¯ä¸€ã€‚</li><li>å‡½æ•°å”¯ä¸€ï¼Œä½†æ˜¯é—­åŒ…é‡Œçš„countæ˜¯ä¸å¯å˜çš„ã€‚</li></ol><p>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼š</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">func</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;count&#x27;</span>,count)</span><br><span class="line">      <span class="title function_">setCount</span>(count+<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    func.<span class="property">time</span> = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">    <span class="keyword">const</span> interval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(func.<span class="property">time</span>)</span><br><span class="line">      <span class="title function_">func</span>()</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;unbind&#x27;</span>)</span><br><span class="line">      <span class="built_in">clearInterval</span>(interval);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [count]);</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥æŒºå¥½çš„ï¼Œåªéœ€è¦æ”¹å˜ä¸€äº›useEffectçš„ä¾èµ–ï¼Œä½†æ˜¯ä»logå¯ä»¥çœ‹å‡ºï¼Œä¼šä¸åœçš„è¾“å‡ºunbindï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼æ˜¯é€šè¿‡ä¸åœçš„unbind&#x2F;bindçš„æ–¹å¼æ¥å®ç°å‡½æ•°çš„ä¸å”¯ä¸€ï¼Œè¿™å°±ä¸å¥½äº†ã€‚</p><p>ç¬¬äºŒç§æ–¹æ¡ˆï¼š</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> latesCount = <span class="title function_">useRef</span>(count)</span><br><span class="line">  latesCount.<span class="property">current</span> = count</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">func</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;count&#x27;</span>,count)</span><br><span class="line">      <span class="title function_">setCount</span>(latesCount.<span class="property">current</span>+<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    func.<span class="property">time</span> = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">    <span class="keyword">const</span> interval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(func.<span class="property">time</span>)</span><br><span class="line">      <span class="title function_">func</span>()</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;unbind&#x27;</span>)</span><br><span class="line">      <span class="built_in">clearInterval</span>(interval);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>count: &#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»logå¯ä»¥çœ‹å‡ºfuncå”¯ä¸€ï¼Œfuncä¸­çš„countä¹Ÿå”¯ä¸€ï¼Œä½†æ˜¯jsxä¸­çš„countä¼šæŒç»­çš„å¢åŠ ã€‚è¿™æ˜¯å› ä¸ºsetCountçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸å†æ˜¯funcé—­åŒ…ä¸­ä¸å˜çš„countï¼Œè€Œæ˜¯latesCount.currentã€‚</p><h3 id="useMemoizedFn"><a href="#useMemoizedFn" class="headerlink" title="useMemoizedFn"></a>useMemoizedFn</h3><p><a href="https://ahooks-next.surge.sh/zh-CN/hooks/use-memoized-fn">å®˜æ–¹ä¾‹å­</a></p><p>ä¸ºä»€ä¹ˆå­˜åœ¨è¿™ä¸ªhookï¼ŒuseCallbackåˆæœ‰ä»€ä¹ˆç¼ºç‚¹ã€‚ä¸ºä»€ä¹ˆè¦ä¿è¯å‡½æ•°çš„åœ°å€æ°¸è¿œä¸å˜ï¼Œä¸¾ä¸ªä¾‹å­æ¥çœ‹ä¸€çœ‹è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useCallback &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useLatest &#125; <span class="keyword">from</span> <span class="string">&#x27;ahooks&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// const latestCountRef = useLatest(count);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onClickHandler = <span class="title function_">useCallback</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>)</span><br><span class="line">  &#125;,[count])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClickHandler&#125;</span>&gt;</span>add count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Child</span> = (<span class="params">props</span>)=&gt;&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child render&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>æˆ‘æ˜¯child<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡ç‚¹å‡»add count buttonï¼ŒChildç»„ä»¶éƒ½ä¼šrerenderï¼Œä¸‡ä¸€Childç»„ä»¶å¾ˆå¤§ï¼Œæˆ–è€…åµŒå¥—å±‚æ¬¡å¾ˆæ·±å‘¢ï¼Œè¿™æ— ç–‘å¸¦æ¥äº†å·¨å¤§çš„æ€§èƒ½é—®é¢˜ã€‚</p><p>ç”¨React.memoåŒ…ä¸€ä¸‹ä¼šå¥½ä¸€ç‚¹ã€‚</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child render&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>æˆ‘æ˜¯child<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ç‚¹å‡»add count buttonï¼ŒChildç»„ä»¶å°±ä¸æ¸²æŸ“äº†ã€‚ä½†æ˜¯React.momoåœ¨propså˜åŒ–æ—¶è¿˜æ˜¯ä¼šrerenderï¼Œä»£ç æ”¹æˆè¿™æ ·ã€‚</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// const latestCountRef = useLatest(count);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onClickHandler = <span class="title function_">useCallback</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>)</span><br><span class="line">  &#125;,[count])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClickHandler&#125;</span>&gt;</span>add count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">func</span>=<span class="string">&#123;onClickHandler&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child render&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>æˆ‘æ˜¯child<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ç‚¹å‡»add count buttonï¼ŒChildç»„ä»¶ç«Ÿç„¶é‡æ–°æ¸²æŸ“äº†ï¼Œç”±æ­¤å¯è§ï¼Œæ¯æ¬¡setCountï¼ŒonClickHandleréƒ½ä¼šæŒ‡å‘ä¸€ä¸ªæ–°çš„å‡½æ•°åœ°å€ã€‚æ€ä¹ˆè§„é¿å‘¢ï¼Œæ¥çœ‹ä¸€çœ‹useMemoizedFnçš„å®ç°ã€‚</p><p><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useMemoizedFn/index.ts">useMemoizedFn</a></p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> useMemoizedFn&lt;T <span class="keyword">extends</span> noop&gt;(<span class="attr">fn</span>: T) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`useMemoizedFn expected parameter is a function, got <span class="subst">$&#123;<span class="keyword">typeof</span> fn&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fnRef = useRef&lt;T&gt;(fn);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// why not write `fnRef.current = fn`?</span></span><br><span class="line">  <span class="comment">// https://github.com/alibaba/hooks/issues/728</span></span><br><span class="line">  fnRef.<span class="property">current</span> = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> fn, [fn]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> memoizedFn = useRef&lt;T&gt;();</span><br><span class="line">  <span class="keyword">if</span> (!memoizedFn.<span class="property">current</span>) &#123;</span><br><span class="line">    memoizedFn.<span class="property">current</span> = <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">      <span class="comment">// eslint-disable-next-line @typescript-eslint/no-invalid-this</span></span><br><span class="line">      <span class="keyword">return</span> fnRef.<span class="property">current</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125; <span class="keyword">as</span> T;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> memoizedFn.<span class="property">current</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>useMemoizedFnæœ¬è´¨ä¸Šæ˜¯ä¸ªé«˜é˜¶å‡½æ•°ã€‚æœ‰ä¸¤ä¸ªuseRefï¼Œä¸€ä¸ªå­˜å‚¨å˜åŒ–çš„fnï¼Œä¸€ä¸ªå­˜å‚¨æ°¸è¿œä¸å˜çš„memoizedFnï¼Œè°ƒç”¨useMemoizedFnæ—¶çœŸæ­£è°ƒç”¨çš„æ˜¯memoizedFnï¼Œç„¶ååœ¨memoizedFnå†…éƒ¨è°ƒç”¨æœ€æ–°çš„fnã€‚é«˜é˜¶å‡½æ•°çš„æ€è·¯ã€‚</p><p>PS: è¿™é‡Œæœ‰ä¸ªæƒ³æ³•ï¼ŒuseCallbackä¸ºå•¥ä¼šæœ‰è¿™ä¹ˆå¤šçš„é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯æˆ‘ä»¬ç”¨é”™äº†å‘¢ï¼Ÿreact hooksçš„è®¾è®¡åˆè¡·æ˜¯ä½¿å‡½æ•°å¼ç»„ä»¶æ‹¥æœ‰çŠ¶æ€ï¼Œé‚£æˆ‘ä»¬è¦æ˜¯èƒ½ä¿è¯è¢«useCallbackç¼“å­˜çš„å‡½æ•°éƒ½æ˜¯çº¯å‡½æ•°ï¼Œæ˜¯ä¸æ˜¯å°±ä¸å­˜åœ¨é—­åŒ…é—®é¢˜ã€‚å‡å¦‚ä¸Šé¢çš„ä¾‹å­å†™æˆè¿™æ ·ï¼š</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> onClickHandler = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">count</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>)</span><br><span class="line">  &#125;,[])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-xml">          onClickHandler(count)</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;add count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> <span class="attr">func</span>=<span class="string">&#123;onClickHandler&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child render&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>æˆ‘æ˜¯child<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·å†™æ˜¯ä¸æ˜¯ä¹Ÿä¸å­˜åœ¨é—­åŒ…é—®é¢˜ã€‚</p><p>2022.08.02æ›´æ–°ï¼Œä¸Šé¢çš„å†™æ³•è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œè™½ç„¶è§£å†³äº†å‡½æ•°çš„å¼•ç”¨é—®é¢˜ï¼Œä½†å´å¤§å¤§å¢åŠ äº†å¿ƒæ™ºè´Ÿæ‹…ï¼Œå‡å¦‚æŸä¸ªæ–¹æ³•æœ‰å¥½å‡ ä¸ªä¾èµ–ï¼Œå¹¶ä¸”æœ‰å¥½å‡ å¤„è°ƒç”¨ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½è¦ä¼ å¤§ä¸€å †â€œçœ‹ä¼¼æ— ç”¨â€œçš„å‚æ•°ï¼Œè¿™æ ·å°±ä¸å¦‚åœ¨å®šä¹‰å‡½æ•°æ—¶â€œæ ‡æ˜â€ä¾èµ–æ–¹ä¾¿ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">a,b,c,d,e</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;,[])</span><br><span class="line"><span class="title function_">foo</span>(a,b,c,d,e)</span><br><span class="line"><span class="comment">//è¿™æ ·æ¯æ¬¡è°ƒç”¨fooï¼Œéƒ½å¿…é¡»ä¼ aã€bã€cã€dã€eã€‚è¿™æ ·å€’ä¸å¦‚å®šä¹‰fooæ—¶åªå†™ä¸€éä¾èµ–æ–¹ä¾¿ï¼Œä½†è¿™æ ·åˆä¼šå¸¦æ¥å‡½æ•°åœ°å€é—®é¢˜ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦useMemoizedFnï¼Œæˆ–è€…å…³æ³¨ä¸€ä¸‹reactæ–°çš„hooksï¼ŒuseEvent</span></span><br></pre></td></tr></table></figure><h3 id="useCreation"><a href="#useCreation" class="headerlink" title="useCreation"></a>useCreation</h3><p><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useCreation/index.ts">useCreation</a><br><a href="https://ahooks.js.org/zh-CN/hooks/use-creation">æ–‡æ¡£</a></p><p>æ­£å¦‚å®˜æ–¹æ–‡æ¡£è¯´çš„é‚£æ ·ï¼ŒuseRefå¹¶ä¸èƒ½ä¿è¯å‚æ•°ç»å¯¹ä¸å˜ï¼Œæ‰€ä»¥éœ€è¦useCreationï¼Œæˆ‘ä»¬æ¥çœ‹æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> useCreation&lt;T&gt;(<span class="attr">factory</span>: <span class="function">() =&gt;</span> T, <span class="attr">deps</span>: <span class="title class_">DependencyList</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; current &#125; = <span class="title function_">useRef</span>(&#123;</span><br><span class="line">    deps,</span><br><span class="line">    <span class="attr">obj</span>: <span class="literal">undefined</span> <span class="keyword">as</span> <span class="literal">undefined</span> | T,</span><br><span class="line">    <span class="attr">initialized</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (current.<span class="property">initialized</span> === <span class="literal">false</span> || !<span class="title function_">depsAreSame</span>(current.<span class="property">deps</span>, deps)) &#123;</span><br><span class="line">    current.<span class="property">deps</span> = deps;</span><br><span class="line">    current.<span class="property">obj</span> = <span class="title function_">factory</span>();</span><br><span class="line">    current.<span class="property">initialized</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> current.<span class="property">obj</span> <span class="keyword">as</span> T;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸å†æ˜¯å®ä¾‹æœ¬èº«ï¼Œè€Œæ˜¯è¿”å›å®ä¾‹çš„å·¥å‚å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¾èµ–ï¼Œç±»å‹å’Œå†…ç½®hookç±»å‹ä¸€æ ·ã€‚ç”¨ä¸€ä¸ªuseRefæ¥ä¿å­˜å®ä¾‹ç›¸å…³çš„ä¸€äº›å‚æ•°ï¼Œåªæœ‰å½“initializedä¸ºfalseæˆ–è€…depså‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰é‡æ–°æ‰§è¡Œå·¥å‚å‡½æ•°ï¼Œæœ€åè¿”å›å®ä¾‹ï¼Œå¦‚æœè¯¥å®ä¾‹æ²¡æœ‰ä¾èµ–ï¼Œé‚£ä¹ˆè¯¥å®ä¾‹å°±ä¼šå”¯ä¸€ã€‚</p><h3 id="useUpdate"><a href="#useUpdate" class="headerlink" title="useUpdate"></a>useUpdate</h3><figure class="highlight typescript"><figcaption><span>jsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">useUpdate</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [, setState] = <span class="title function_">useState</span>(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> <span class="title function_">setState</span>(&#123;&#125;), []);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useUpdate;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè°ƒç”¨useStateçš„setStateä¼šä½¿ç»„ä»¶æ ‘é‡æ–°æ¸²æŸ“ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥è¾¾åˆ°å¼ºåˆ¶åˆ·æ–°çš„ç›®çš„ã€‚</p><h3 id="useMount"><a href="#useMount" class="headerlink" title="useMount"></a>useMount</h3><h3 id="useUnmount"><a href="#useUnmount" class="headerlink" title="useUnmount"></a>useUnmount</h3><p>useMountä¸useUnmountã€‚è¿™ä¿©ç®—æ˜¯æœ€æ²¡å­˜åœ¨æ„Ÿçš„hookï¼Œå†…éƒ¨å®ç°åŸç†éƒ½æ˜¯useEffectã€‚</p><h1 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h1><h2 id="å†…ç½®æ’ä»¶"><a href="#å†…ç½®æ’ä»¶" class="headerlink" title="å†…ç½®æ’ä»¶"></a>å†…ç½®æ’ä»¶</h2><h3 id="useDebouncePlugin"><a href="#useDebouncePlugin" class="headerlink" title="useDebouncePlugin"></a>useDebouncePlugin</h3><p><a href="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useRequest/src/plugins/useDebouncePlugin.ts">useDebouncePlugin</a><br>å¤§è‡´çœ‹ä¸€ä¸‹ä»£ç ï¼Œå‘ç°æ ¸å¿ƒå®ç°æ˜¯è°ƒäº†lodashçš„debounceæ–¹æ³•ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨lodashï¼Œç©¶å…¶åŸå› ï¼Œè¿˜è¦ä»debounceçš„åŸç†è¯´èµ·ã€‚</p><p><a href="https://github.com/lodash/lodash/blob/master/debounce.js">debounce</a><br>è¿™ä¸œè¥¿çœŸåç›´è§‰ï¼Œdebounceæœ¬è´¨ä¸Šæ˜¯ä¸ªé«˜é˜¶å‡½æ•°ï¼Œä½ ä¼ ä¸€ä¸ªfuncå‡½æ•°ï¼Œå®ƒç»™ä½ è¿”å›ä¸€ä¸ªdebouncedå‡½æ•°ï¼Œè‡³äºå‰©ä¸‹çš„é‚£äº›lastArgsã€lastThisâ€¦å˜é‡ï¼Œå…¨å­˜åœ¨debouncedå‡½æ•°çš„é—­åŒ…ä¸­ï¼Œæ‰€ä»¥ä¿æŒdebouncedçš„å”¯ä¸€ï¼ˆé—­åŒ…å”¯ä¸€ï¼‰æ˜¯é‡ä¸­ä¹‹é‡ã€‚çœ‹ä¸€ä¸ªéreactçš„ä¾‹å­ã€‚</p><p><a href="https://cn.vuejs.org/v2/guide/computed.html#%E4%BE%A6%E5%90%AC%E5%99%A8">vue debounce</a><br>createdæ—¶åœ¨thisä¸Šæ”¾äº†ä¸€ä¸ªdebouncedGetAnswerå‡½æ•°ï¼Œå°±æ˜¯ä¸ºäº†ä¿æŒdebouncedçš„é—­åŒ…å”¯ä¸€ã€‚</p><p>æ‰€ä»¥ä¸è®ºæ˜¯è¿™é‡Œçš„useDebouncePluginè¿˜æ˜¯å•ç‹¬çš„useDebounceFnï¼Œæ‰€åšçš„äº‹éƒ½æ˜¯è®©debouncedå‡½æ•°åœ¨ç»„ä»¶å¤šæ¬¡æ¸²æŸ“ä¸­ä¿æŒå”¯ä¸€ã€‚</p><h2 id="è‡ªå®šä¹‰æ’ä»¶"><a href="#è‡ªå®šä¹‰æ’ä»¶" class="headerlink" title="è‡ªå®šä¹‰æ’ä»¶"></a>è‡ªå®šä¹‰æ’ä»¶</h2><p>PS: æœ€è¿‘ä¸šåŠ¡æ¯”è¾ƒå¿™ï¼Œå†åŠ ä¸Šahooksä»£ç ä¸åœåœ¨å˜åŠ¨ã€‚å…ˆåˆåˆ°masterï¼Œç­‰è¿‡æ®µæ—¶é—´å†çœ‹ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ react-whether</title>
      <link href="/2021/11/21/%E5%AD%A6%E4%B9%A0react-whether/"/>
      <url>/2021/11/21/%E5%AD%A6%E4%B9%A0react-whether/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æˆ‘ä»¬åœ¨ç”¨reactå†™ä¸šåŠ¡æ—¶ï¼Œå¸¸å¸¸è¦å¤„ç†ä¸€äº›æ¡ä»¶é€»è¾‘ï¼Œç”±äºjsxé‡Œé¢åªæœ‰å†™è¡¨è¾¾å¼ï¼Œä¸èƒ½å†™è¯­å¥ï¼Œæ‰€ä»¥æœ‰æ—¶ä¸å¾—ä¸å†™ä¸€å¤§å¨è¿™æ ·çš„ä»£ç ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        isMatch ? <span class="language-xml"><span class="tag">&lt;<span class="name">CommentA</span>/&gt;</span></span> : <span class="language-xml"><span class="tag">&lt;<span class="name">CommentB</span>/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦ä¹ˆåƒè¿™æ ·æŠŠå¤§ç‰‡é€»è¾‘å°è£…æˆç»„ä»¶ï¼Œè¦ä¹ˆå†™ä¸ªå‡½æ•°</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &#123;<span class="variable language_">this</span>.<span class="title function_">renderComponent</span>()&#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">renderComponent</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> isMatch ? <span class="language-xml"><span class="tag">&lt;<span class="name">CommentA</span>/&gt;</span></span> : <span class="language-xml"><span class="tag">&lt;<span class="name">CommentB</span>/&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸å®Œç¾ï¼Œæœ‰æ—¶å€™å¹¶ä¸æƒ³å‡­ç©ºå†™ä¸€ä¸ªæ–¹æ³•æˆ–è€…å°è£…ç»„ä»¶ï¼Œå¹¶ä¸”ä»£ç å¯è¯»æ€§ä¹Ÿä¸å¥½ã€‚</p><p>é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´ä¼˜é›…çš„æ–¹æ³•ï¼Œå½“ç„¶æœ‰ï¼Œæ‰€è°“å‰äººæ ½æ ‘ï¼Œåäººä¹˜å‡‰ï¼Œæˆ‘ä»¬åªè¦è™šå¿ƒå­¦ä¹ å°±å¯ä»¥äº†ã€‚</p><p><a href="https://github.com/otakustay/react-whether">react-whether</a> ,çœ‹æ–‡æ¡£å¯ä»¥å»è¿™é‡Œï¼Œæœ¬æ–‡ä»‹ç»çš„æ˜¯å…¶æºç ã€‚</p><h1 id="æºç è§£è¯»"><a href="#æºç è§£è¯»" class="headerlink" title="æºç è§£è¯»"></a>æºç è§£è¯»</h1><p>é¦–å…ˆæ‰“å¼€src&#x2F;index.ts</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;<span class="keyword">default</span> <span class="keyword">as</span> <span class="title class_">Whether</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./Whether&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;<span class="keyword">default</span> <span class="keyword">as</span> <span class="title class_">Match</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./Match&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;<span class="keyword">default</span> <span class="keyword">as</span> <span class="title class_">Else</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./Else&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä»æ–‡æ¡£å¯ä»¥çœ‹å‡º<a href="https://github.com/otakustay/react-whether/blob/master/src/Whether.tsx">Whether</a> æ˜¯å…¶root componentã€‚</p><p>ä»ä»£ç å¯ä»¥çœ‹å‡ºWhetheræœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ï¼Œé™¤äº†childrenï¼Œæ¥æ”¶matcheså’Œcontextä¸¤ä¸ªpropã€‚</p><p>ä»£ç å¼€ç¯‡åˆ¤æ–­matchesæ˜¯ä¸æ˜¯ä¸€ä¸ªbooleanï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨åˆ¤æ–­æœ‰æ²¡æœ‰ä¼ matchesï¼Œå¦‚æœmatchesæ˜¯ä¸ªbooleanï¼Œèµ°çš„æ˜¯IfElseModeæˆ–è€…IfModeï¼Œå¦åˆ™èµ°çš„æ˜¯SwitchModeã€‚</p><p>é€šè¿‡è®¡ç®—Whetherçš„childrençš„æ•°é‡countï¼Œæ¥åˆ¤æ–­æ˜¯IfElseModeæˆ–è€…IfModeï¼Œå¦‚æœcount &lt;&#x3D; 1,èµ°çš„æ˜¯IfModeï¼Œå¦‚æœcount &gt; 1 å¹¶ä¸”chidrençš„æœ€åä¸€é¡¹æ˜¯elseï¼Œèµ°çš„æ˜¯IfElseModeï¼Œå¦åˆ™èµ°çš„æ˜¯IfModeã€‚</p><p><a href="https://github.com/otakustay/react-whether/blob/master/src/IfMode.tsx">IfMode</a><br><a href="https://github.com/otakustay/react-whether/blob/master/src/IfElseMode.tsx">IfElseMode</a></p><p>è¿™ä¿©è´§ä»£ç å¾ˆç›¸ä¼¼ï¼Œå†…éƒ¨éƒ½è°ƒç”¨äº†Renderç»„ä»¶</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Render</span>&gt;&#123;matches ? children : <span class="literal">null</span>&#125;&lt;<span class="regexp">/Render&gt; /</span><span class="regexp">/IfMode</span></span><br><span class="line"><span class="regexp">&lt;Render&gt;&#123;matches ? ifChildren : elseChildren&#125;&lt;/</span><span class="title class_">Render</span>&gt; <span class="comment">//IfElseMode</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯åªä¼ matchesçš„æƒ…å†µï¼Œæ¥ä¸‹æ¥çœ‹åªä¼ contextçš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯switchMode</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> matches !== <span class="string">&#x27;boolean&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> elements = <span class="title class_">Children</span>.<span class="title function_">toArray</span>(children) <span class="keyword">as</span> <span class="title class_">Array</span>&lt;<span class="title class_">React</span>.<span class="property">ReactElement</span>&lt;<span class="built_in">any</span>&gt;&gt;;</span><br><span class="line">        <span class="keyword">const</span> branches = elements.<span class="title function_">map</span>(elementToBranch);</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">SwitchMode</span> <span class="attr">context</span>=<span class="string">&#123;context&#125;</span> <span class="attr">branches</span>=<span class="string">&#123;branches&#125;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elementToBranch = (&#123;<span class="keyword">type</span>, props&#125;: <span class="title class_">React</span>.<span class="property">ReactElement</span>&lt;<span class="built_in">any</span>&gt;): <span class="title class_">MatchProp</span> | <span class="function"><span class="params">BranchPropWithSelector</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="title class_">Match</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> props;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">selector</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">children</span>: props.<span class="property">children</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>elementToBranch çš„ä½œç”¨æ˜¯æ•´åˆpropsä¸childrenï¼Œç”Ÿæˆç»Ÿä¸€çš„branchesï¼Œå› ä¸ºchildrenå¯èƒ½æ˜¯Matchï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ã€‚æœ€åè°ƒç”¨SwitchModeç»„ä»¶ã€‚</p><p><a href="https://github.com/otakustay/react-whether/blob/master/src/SwitchMode.tsx">SwitchMode</a></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">SwitchMode</span>: <span class="title class_">React</span>.<span class="property">SFC</span>&lt;<span class="title class_">SwitchModeProp</span>&gt; = <span class="function">(<span class="params">&#123;context, branches&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> branch = branches.<span class="title function_">find</span>(<span class="function">(<span class="params">&#123;selector&#125;</span>) =&gt;</span> <span class="title function_">selector</span>(context));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Render</span>&gt;</span>&#123;branch ? branch.children : null&#125;<span class="tag">&lt;/<span class="name">Render</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»£ç ä¸ifModeå¾ˆç›¸ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯å¤šäº†ä¸ªbranchï¼Œè¿™é‡Œç”¨findæ–¹æ³•å¾ˆå·§å¦™ã€‚å‡å¦‚æˆ‘ä»£ç è¿™ä¹ˆå†™ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> [user,changeUser] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&#x27;foo&#x27;</span></span><br><span class="line">    &#125;) </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Whether</span> <span class="attr">context</span>=<span class="string">&#123;user&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Match</span> <span class="attr">selector</span>=<span class="string">&#123;user</span>=&gt;</span>user.type === &#x27;foo&#x27;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                111</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Match</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Match</span> <span class="attr">selector</span>=<span class="string">&#123;user</span>=&gt;</span>user.type === &#x27;bar&#x27;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                111</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Match</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Else</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                else</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Else</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Whether</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§elementToBranchçš„é€»è¾‘ï¼Œå‡å¦‚childrençš„æŸä¸€é¡¹ä¸æ˜¯Matchï¼Œä¼šç”Ÿæˆè¿”å›trueçš„selectorå‡½æ•°ï¼Œä½†æ˜¯æ•°ç»„çš„findæ–¹æ³•æ°¸è¿œåªè¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å€¼ã€‚æ‰€ä»¥æœ€åä¸€é¡¹æ˜¯ä¸æ˜¯Elseç»„ä»¶æ ¹æœ¬ä¸é‡è¦ï¼Œå†™æˆdivä¹Ÿå¯ä»¥ï¼Œå…³é”®æ˜¯é¡ºåºã€‚</p><p>æœ€åçœ‹ä¸€ä¸‹ä¸‰ä¸ªmodeéƒ½ç”¨åˆ°çš„Renderç»„ä»¶ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Render</span>: <span class="title class_">React</span>.<span class="property">SFC</span>&lt;<span class="title class_">RenderProp</span>&gt; = (&#123;children&#125;): <span class="title class_">React</span>.<span class="property">ReactElement</span>&lt;<span class="built_in">any</span>&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;isRenderFunc(children) ? children() : children&#125;<span class="tag">&lt;/&gt;</span></span>; <span class="comment">//æ‡’åŠ è½½çš„å®ç°</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ recycler-view</title>
      <link href="/2021/11/20/%E5%AD%A6%E4%B9%A0recycler-view/"/>
      <url>/2021/11/20/%E5%AD%A6%E4%B9%A0recycler-view/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¤§æ•°æ®çš„åˆ—è¡¨æ»šåŠ¨ä¸€ç›´æ˜¯å¾ˆå¤´ç–¼çš„é—®é¢˜ï¼Œå°¤å…¶æ— é™æ»šåŠ¨è¿™ç§åœºæ™¯ï¼Œä¸åƒäººå®¶å®‰å“ï¼Œæœ‰RecyclerViewè¿™ç§å†…ç½®ç»„ä»¶å¯ä»¥ç”¨ã€‚å‰ç«¯åªèƒ½å¯æ€œå·´å·´çš„è‡ªå·±å®ç°ï¼Œå¹¸å¥½å‰äººæ ½æ ‘ï¼Œåäººä¹˜å‡‰ï¼Œä¸šç•Œæœ‰åŒè¡Œå·²ç»å†™äº†ä¸€äº›å®ç°ï¼Œæœ¬æ–‡å°†è¦ä»‹ç»çš„ä¾¿æ˜¯å…¶ä¸­ä¸€ç§ã€‚</p><p><a href="https://github.com/hdcoo/recycler-view">https://github.com/hdcoo/recycler-view</a></p><h1 id="å¤§æ¦‚åŸç†"><a href="#å¤§æ¦‚åŸç†" class="headerlink" title="å¤§æ¦‚åŸç†"></a>å¤§æ¦‚åŸç†</h1><p>å…ˆå»<a href="https://github.com/hdcoo/recycler-view-demo">è¿™é‡Œ</a> ,ä¸‹è½½demoæºä»£ç ï¼Œcloneä¸‹æ¥ånpm install,ç„¶åè®¿é—®<a href="http://localhost:5211/recycler-view-demo/%EF%BC%8C">http://localhost:5211/recycler-view-demo/ï¼Œ</a> æˆ‘ä»¬è¦ä»‹ç»çš„æ˜¯ç»å…¸ä¸¤åˆ—å¸ƒå±€çš„ç€‘å¸ƒæµï¼Œä¹Ÿå°±æ˜¯å…¥å£æ˜¯waterfall.jsçš„é‚£ä¸ªä¾‹å­ã€‚</p><p>demoé¡¹ç›®è¿è¡Œèµ·æ¥ä»¥åï¼Œæ‰“å¼€æ§åˆ¶å°å‘ç°æ¯ä¸ªä¾‹å­çš„å¸ƒå±€éƒ½å¾ˆå¥‡æ€ªã€‚æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬å†™ä¸€ä¸ªå±€éƒ¨æ»šåŠ¨ï¼Œä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚</p><iframe src="https://codesandbox.io/embed/boring-lehmann-kwve4?fontsize=14&hidenavigation=1&theme=dark" title="awesome-mestorf-nb8r2" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p>å¯æ˜¯è¿™ä¸ªåº“çš„å¸ƒå±€æ˜¯è¿™æ ·çš„</p><iframe src="https://codesandbox.io/embed/practical-blackburn-qmf1w?fontsize=14&hidenavigation=1&theme=dark" title="awesome-mestorf-nb8r2" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p>å†…å±‚å…ƒç´ æ˜¯ä»¥ç»å¯¹å®šä½+translateçš„æ–¹å¼â€œè´´â€ä¸Šå»çš„ï¼Œæ¯”èµ·æ™®é€šçš„æµå¼å¸ƒå±€ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸€æ—¦å‘¨å›´çš„å…ƒç´ æœ‰å˜åŒ–ï¼ˆä½ç½®å˜åŒ–æˆ–è€…å¹²è„†ä»domæ ‘ä¸­åˆ é™¤ï¼‰ï¼Œä¸»ä½“å…ƒç´ çš„ä½ç½®ä¸ä¼šå˜åŒ–ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œåœ¨é¡µé¢åˆå§‹åŒ–ä¸­åªæ¸²æŸ“èƒ½è¦†ç›–ä¸€å±çš„å…ƒç´ ä¸ªæ•°ï¼ˆå‡å¦‚æ˜¯15ä¸ªï¼‰ï¼Œåœ¨æ»šåŠ¨å®¹å™¨çš„è¿‡ç¨‹ä¸­ï¼ŒåŠ¿å¿…æœ‰ä¸€äº›å…ƒç´ æ»šå‡ºå±å¹•ï¼ˆAï¼‰ï¼Œåˆæœ‰æ–°çš„å…ƒç´ å°†è¦å‡ºç°åœ¨å±å¹•å†…ï¼ˆBï¼‰ï¼Œæˆ‘ä»¬é‡å¤åˆ©ç”¨æ»šå‡ºå±å¹•çš„åºŸå¼ƒå…ƒç´ ï¼ˆAï¼‰ï¼Œæ”¹å˜ä»–ä»¬çš„translateï¼Œä½¿å…¶å‡ºç°åœ¨Båº”è¯¥å‡ºç°çš„ä½ç½®ï¼Œç„¶åæ”¹å˜Bçš„æ•°æ®ã€‚è¿™æ ·å³ä½¿æœ‰æˆåƒä¸Šä¸‡æ¡æ•°æ®ï¼Œæ¸²æŸ“åœ¨å®¹å™¨å†…çš„domä¹Ÿä»…ä»…åªæœ‰15ä¸ªï¼ˆå¯èƒ½å¤§äº15ï¼Œåªæœ‰Bçš„ä¸ªæ•°å¤§äºAçš„ä¸ªæ•°æ—¶ï¼Œæ‰ä¼šcreateElementï¼‰ã€‚è¿™å°±æ˜¯æ ¸å¿ƒæ‰€åœ¨ã€‚</p><p>å›åˆ°å®˜æ–¹çš„ä¸¤åˆ—ç€‘å¸ƒæµä¾‹å­</p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/%E5%8A%A8%E7%94%BB.gif?versionId=CAEQGxiBgICh8q_s5xciIGI0MWQyYTQ3MDdiZDRlZGI4YTViYWY1YjNlZDM2NTYy"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºå˜åŒ–çš„ä»…ä»…æ˜¯translateï¼Œå¤–å±‚recycler-scrollerçš„æœ€å¤§æ»šåŠ¨é«˜åº¦å¾ˆå¤§ï¼Œéšç€é¡µé¢çš„æ»šåŠ¨ï¼Œå¯è§çš„å…ƒç´ ä»…ä»…æ˜¯é‚£å‡ ä¸ªè¢«åå¤åˆ©ç”¨çš„å…ƒç´ ï¼Œå…¶å®recycler-scrollerä¸‹éƒ¨æœ‰å¤§ç‰‡çœ‹ä¸åˆ°çš„ç©ºç™½ï¼Œå®é™…é«˜åº¦æ˜¯ç”±ä¸€ä¸ªå®½é«˜éƒ½ä¸º1çš„ç»å¯¹å®šä½å…ƒç´ ï¼ˆsentineï¼‰æ’‘å¼€çš„ï¼Œè¿™ä¸ªå…ƒç´ çš„topä¾¿æ˜¯scrollerçš„æœ€å¤§æ»šåŠ¨é«˜åº¦ã€‚</p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/d8fd84a1-1504-4020-93f7-a550314c1459-image.png" alt="d8fd84a1-1504-4020-93f7-a550314c1459-image.png"></p><p>ä¸ºå•¥æœ‰ä¸ªcontainerï¼Œä»¥æˆ‘çš„ç†è§£ï¼Œä»è¿™ä¸ªåº“çš„åŸç†æ¥çœ‹ï¼Œcontainerçš„ä½œç”¨ä»…ä»…æ˜¯åŒºåˆ†å¯è§å…ƒç´ çš„domä¸sentineï¼Œæ–¹ä¾¿ç®¡ç†ï¼ˆæ¯”å¦‚è¯´å¾€containeré‡Œé¢appendå…ƒç´ ï¼‰ã€‚</p><h1 id="å…·ä½“çš„ä»£ç å®ç°"><a href="#å…·ä½“çš„ä»£ç å®ç°" class="headerlink" title="å…·ä½“çš„ä»£ç å®ç°"></a>å…·ä½“çš„ä»£ç å®ç°</h1><h2 id="æ•´ä½“è®¾è®¡"><a href="#æ•´ä½“è®¾è®¡" class="headerlink" title="æ•´ä½“è®¾è®¡"></a>æ•´ä½“è®¾è®¡</h2><p>ä»domç»“æ„æ¥çœ‹ï¼Œæ•´ä¸ªåº“åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šScroller &#x3D; Containe + Sentineã€‚</p><p>ä»ä»£ç å±‚æ¬¡æ¥çœ‹ï¼Œæ•´ä¸ªåº“åˆ†ä¸ºRecylerã€Renderä¸Sourceã€‚Recyleræ˜¯æ ¸å¿ƒå®ç°ï¼ŒRenderè´Ÿè´£domçš„åˆ›å»º&#x2F;æ›´æ–°ä»¥åŠä¸å¯è§å…ƒç´ çš„å›æ”¶åˆ©ç”¨ã€‚Sourceé¡¾åæ€ä¹‰æ•°æ®ä¹‹æºï¼Œç”±äºè¿™ä¸ªåº“çš„åŸç†æ‰€é™ï¼Œæ¯é¡¹æ•°æ®å¿…é¡»æä¾›heightä¸scrollTopã€‚</p><h2 id="å•è¡Œä»£ç åˆ†æ"><a href="#å•è¡Œä»£ç åˆ†æ" class="headerlink" title="å•è¡Œä»£ç åˆ†æ"></a>å•è¡Œä»£ç åˆ†æ</h2><p>é¦–å…ˆå…¥å£æ–‡ä»¶æ˜¯waterfail.js</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">getWaterfallRecycler</span>(<span class="params">scroller, container</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Recycler</span>(scroller, <span class="keyword">new</span> <span class="title class_">WaterfallSource</span>(), &#123;</span><br><span class="line">    container,</span><br><span class="line">    <span class="attr">renderer</span>: <span class="keyword">new</span> <span class="title class_">NumberRenderer</span>()</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦ä¸€ä¸ªæä¾›æ•°æ®ä¸æ¯é¡¹æ•°æ®çš„ä½ç½®å‚æ•°çš„Sourceå®ä¾‹ï¼Œéœ€è¦ä¸€ä¸ªæä¾›æ¯é¡¹å…ƒç´ å…·ä½“renderå®ç°ä»¥åŠå›æ”¶&#x2F;é‡Šæ”¾å±å¹•å¤–å…ƒç´ çš„Renderå®ä¾‹ï¼Œéœ€è¦ä¸€ä¸ªäº§ç”Ÿæ»šåŠ¨çš„çš„æ»šåŠ¨å®¹å™¨ï¼ˆscrollerï¼‰ï¼Œä»¥åŠç”¨äºç®¡ç†å±å¹•å†…ï¼ˆå‡†ç¡®è¯´åº”è¯¥æ˜¯å½“ä¸‹æ¸²æŸ“å‡ºçš„å…ƒç´ ï¼‰çš„å…ƒç´ ã€‚</p><p>æ¥ä¸‹æ¥çœ‹Recyclerçš„å…·ä½“å®ç°ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Recycler</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">EventEmitter</span> <span class="keyword">implements</span> <span class="title class_">IRecycler</span>&lt;T&gt;&#123;&#125;</span><br></pre></td></tr></table></figure><p>EventEmitteræ˜¯ä¸€ä¸ªç®€çŸ­çš„æ¶ˆæ¯å‘å°„å™¨ï¼Œç”¨äºå‘å¤–ç•Œé€šçŸ¥Recyclerçš„å„ç§æƒ…å†µï¼Œæ¯”å¦‚è¯´æ˜¯å¦æ­£åœ¨æ»šåŠ¨ä»¥åŠæ˜¯å¦æ»šåˆ°äº†åº•éƒ¨ã€‚</p><p>æˆ‘åŸºäºä½œè€…çš„æ³¨é‡Šç»™ä¸è¡¥å……</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Recycler</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">EventEmitter</span> <span class="keyword">implements</span> <span class="title class_">IRecycler</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">scroller: Window | HTMLElement, sources: ISource&lt;T&gt; | <span class="built_in">Array</span>&lt;ISource&lt;T&gt;&gt;, options: IOptions&lt;T&gt;</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç»Ÿä¸€ scroller æ“ä½œæ¥å£</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">scrollerOperations</span> = <span class="keyword">new</span> <span class="title class_">ScrollerOperations</span>(scroller);</span><br><span class="line">        <span class="comment">// æ»šåŠ¨å…ƒç´ å¯ä»¥æ˜¯æ™®é€šçš„domï¼Œä¹Ÿå¯ä»¥æ˜¯windowï¼Œè¿™ä¸ªç±»æŠ¹å¹³äº†ä¸¤è€…çš„å·®å¼‚ã€‚</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">scrollerOperations</span>.<span class="title function_">isScrollerValid</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="title class_">Exceptions</span>.<span class="title class_">TypeError</span>(<span class="string">&#x27;Invalid scroller, must be window or inside document.body&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ»šåŠ¨å®¹å™¨</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">scroller</span> = scroller;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">scrollerHeight</span> = <span class="variable language_">this</span>.<span class="property">scrollerOperations</span>.<span class="title function_">getOffsetHeight</span>();</span><br><span class="line">        <span class="comment">// scrollerHeightå³scrollerçš„offsetHeightï¼Œå…·ä½“åˆ°è¿™ä¸ªä¾‹å­ä¸Šï¼Œå³recycler-scrollerçš„offsetheight calc(100% - 60px)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// é»˜è®¤æ¸²æŸ“å™¨</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">renderer</span> = options.<span class="property">renderer</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®¹çº³å…ƒç´ çš„å®¹å™¨</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">container</span> = options.<span class="property">container</span> || <span class="variable language_">this</span>.<span class="property">scrollerOperations</span>.<span class="title function_">getElement</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é¡¶éƒ¨å’Œåº•éƒ¨é¢„ç•™ç©ºé—´</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">topPreserved</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(options.<span class="property">topPreserved</span> || <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bottomPreserved</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(options.<span class="property">bottomPreserved</span> || <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// è¿™ä¸¤é¡¹æ˜¯ä¸ºäº†é€‚åº”scrolleré¡¶éƒ¨æˆ–åº•éƒ¨æœ‰é¢å¤–å…ƒç´ çš„æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ»šåŠ¨æ­£åæ–¹å‘é¢„æ¸²æŸ“å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">runwayItems</span> = options.<span class="property">runwayItems</span> || <span class="number">5</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">runwayItemsOpposite</span> = options.<span class="property">runwayItemsOpposite</span> || <span class="number">2</span>;</span><br><span class="line">        <span class="comment">//åœ¨æ»šåŠ¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„containeré‡Œé¢å…ƒç´ çš„è¦†ç›–é¢ä¸æ­¢ä¸€å±çš„é«˜åº¦ï¼Œåº”è¯¥åŠ ä¸ŠrunwayItemsä¸runwayItemsOppositeä¸ªå…ƒç´ çš„é«˜åº¦ï¼Œä¹‹æ‰€ä»¥è®¾è®¡è¿™ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘çŒœæ˜¯ä¸ºäº†ç«Ÿå¯èƒ½çš„å‡å°‘ç™½å±æ—¶é—´ã€‚</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·ç¦»åº•éƒ¨å¤šå°‘ä¸ªå…ƒç´ æ—¶è§¦å‘åŠ è½½æ›´å¤š</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">threshold</span> = options.<span class="property">threshold</span> || <span class="number">5</span>;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªåº•éƒ¨æŒ‡çš„æ˜¯å…·æœ‰å®é™…æ»šåŠ¨é«˜åº¦çš„scrollerçš„åº•éƒ¨ï¼Œè€Œä¸æ˜¯çœ‹åˆ°çš„container</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…è®¸å¤šä¸ªå®ä¾‹ï¼Œå¯ä»¥åœ¨å®ä¾‹ä¹‹é—´åˆ‡æ¢ï¼ˆä¸ºäº†èƒ½åœ¨åŒä¸€ä¸ª scroller ä¸­åˆ‡æ¢ä¸åŒçš„å†…å®¹ï¼Œæ¯”å¦‚æœç´¢ç»“æœå’ŒåŸåˆ—è¡¨ä¹‹é—´åˆ‡æ¢ï¼‰</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initRunways</span>(sources);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">activatedRunway</span> = <span class="title class_">Recycler</span>.<span class="title function_">getDefaultRunwayKey</span>(sources);</span><br><span class="line">        <span class="comment">// ä½œè€…è®¾è®¡è¿™ä¸ªrunwayå¯èƒ½çœŸç”±ä»–æ‰€è¯´ï¼Œç”¨äºåœ¨åŒä¸€ä¸ªscrollerä¸­åˆ‡æ¢ä¸åŒçš„å†…å®¹ï¼Œä½†æ˜¯åˆæ¬¡é˜…è¯»æºç è¿™ä¸ªæ¦‚å¿µåè€Œæˆä¸ºä¸€ç§å¹²æ‰°ï¼Œæ‰€ä»¥å¯ä»¥å…ˆè®¤ä¸ºrunwayå°±æ˜¯ä¸€ä¸ªä¿å­˜äº†æ»šåŠ¨è¿‡ç¨‹ä¸­å„ç§é‡è¦å‚æ•°çš„å¯¹è±¡ã€‚</span></span><br><span class="line">        <span class="comment">// ç¨åä¼šä»‹ç»runway</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ– Dom äº‹ä»¶ç›‘å¬å™¨</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">scrollListener</span> = <span class="keyword">new</span> <span class="title class_">ScrollListener</span>(<span class="variable language_">this</span>.<span class="property">scroller</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">resizeListener</span> = <span class="keyword">new</span> <span class="title class_">ResizeListener</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ’‘å¼€æ»šåŠ¨å®¹å™¨</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sentinel</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sentinel</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sentinel</span>.<span class="property">style</span>.<span class="property">width</span> = <span class="string">&#x27;1px&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sentinel</span>.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&#x27;1px&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">scrollerOperations</span>.<span class="title function_">appendChild</span>(<span class="variable language_">this</span>.<span class="property">sentinel</span>);</span><br><span class="line">        <span class="comment">// scroller = container + Sentineï¼Œcontaineré‡Œé¢çš„å…ƒç´ å…¨éƒ¨ç»å¯¹å®šä½ï¼Œcontaineræœ¬èº«æ˜¯æ²¡æœ‰é«˜åº¦çš„ï¼Œä½†æ˜¯scrollerå´èƒ½æ»šåŠ¨ï¼ŒåŸå› å°±æ˜¯å†…éƒ¨æœ‰ä¸€ä¸ªtopå¾ˆå¤§çš„ç»å¯¹å®šä½å…ƒç´ æ’‘å¼€çš„ï¼Œè€Œè¿™ä¸ªå…ƒç´ çš„topå°±æ˜¯ç”±æ¯ä¸€é¡¹æ•°æ®çš„heightè®¡ç®—å¾—çŸ¥çš„ã€‚</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ®æ˜¯å¦å¯ç”¨ç¡¬ä»¶åŠ é€Ÿé€‰æ‹©æ¨¡æ¿</span></span><br><span class="line">        <span class="keyword">if</span> (options.<span class="property">enableAcceleration</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">transformTemplate</span> = <span class="function">(<span class="params">x, y</span>) =&gt;</span> <span class="string">`translate3d(<span class="subst">$&#123;x&#125;</span>, <span class="subst">$&#123;y&#125;</span>px, 0)`</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">transformTemplate</span> = <span class="function">(<span class="params">x, y</span>) =&gt;</span> <span class="string">`translate(<span class="subst">$&#123;x&#125;</span>, <span class="subst">$&#123;y&#125;</span>px)`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ– container position style</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(<span class="variable language_">this</span>.<span class="property">container</span>).<span class="property">position</span> === <span class="string">&#x27;static&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;relative&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å“¨å…µä½ç½®</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setSentinelPosition</span>();</span><br><span class="line">        <span class="comment">//ç»™Sentineå…ƒç´ è®¾ç½®topå€¼ï¼Œä»¥ä¾¿æ’‘å¼€scroller</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç›‘å¬äº‹ä»¶ï¼Œæ ¹æ® scroller éœ€è¦ä¸åŒçš„ç›‘å¬æ–¹å¼</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">scrollListener</span>.<span class="title function_">on</span>(<span class="variable language_">this</span>.<span class="property">onScroll</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">        <span class="comment">// ç›‘å¬scrollerçš„æ»šåŠ¨äº‹ä»¶ï¼Œä»¥ä¾¿å®æ—¶çš„æ¸²æŸ“å±å¹•å†…çš„å…ƒç´ ã€å›æ”¶å±å¹•å¤–çš„å…ƒç´ ï¼Œæ‰€ä»¥this.onScrollåšçš„äº‹å¾ˆå…³é”®ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (options.<span class="property">handleWindowResize</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">resizeListener</span>.<span class="title function_">on</span>(<span class="variable language_">this</span>.<span class="property">onResize</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå† runwaysï¼Œå¹¶è°ƒç”¨å¯¹åº”çš„ source.mount() æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ­¤ç›‘å¬ä¸€äº›äº‹ä»¶ï¼ˆæ¯”å¦‚é…ç½® lazyloadï¼‰</span></span><br><span class="line">        <span class="title function_">mapObject</span>(<span class="variable language_">this</span>.<span class="property">runways</span>, <span class="function">(<span class="params">runway</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">execute</span>(<span class="function">() =&gt;</span> runway.<span class="property">source</span>.<span class="title function_">mount</span>(<span class="variable language_">this</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// å¯ä»¥è·³è¿‡è¿™ä¸€å¥</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¸²æŸ“è§†å›¾ï¼ˆå¦‚æœ sources ä¸ä¸ºç©ºçš„è¯ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">getRunway</span>().<span class="property">source</span>.<span class="title function_">getLength</span>(<span class="variable language_">this</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">update</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœæ•°æ®ä¸ä¸ºç©ºçš„è¯ï¼Œæ¸²æŸ“å‡ºç¬¬ä¸€å±æ•°æ®ï¼Œthis.updateå†…éƒ¨ä¼šè°ƒç”¨this.onScroll</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨ onInitialized</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">emit</span>(<span class="title class_">Recycler</span>.<span class="property">Events</span>.<span class="property">Initialized</span>, <span class="variable language_">this</span>));</span><br><span class="line">        <span class="comment">//é€šçŸ¥å¤–ç•Œæ¡†æ¶å·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼Œå¹¶æ¸²æŸ“å‡ºç¬¬ä¸€å±æ•°æ®ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¯´æ˜constructorä¸­å‡ ä¸ªé‡è¦çš„æ­¥éª¤ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">initRunways</span>(sources);</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">activatedRunway</span> = <span class="title class_">Recycler</span>.<span class="title function_">getDefaultRunwayKey</span>(sources);</span><br></pre></td></tr></table></figure><p>initRunwaysè°ƒç”¨äº†addRunway,addRunwayè°ƒç”¨äº†getInitialRunwayã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> getInitialRunway&lt;U&gt;(<span class="attr">source</span>: <span class="title class_">ISource</span>&lt;U&gt;): <span class="title class_">IRunway</span>&lt;U&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">scrollTop</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">firstAttachedItem</span>: <span class="number">0</span>, </span><br><span class="line">      <span class="attr">lastAttachedItem</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">firstScreenItem</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">lastScreenItem</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">requestInProgress</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">runwayMaxScrollTop</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">nodes</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">screenNodes</span>: <span class="title function_">newSet</span>(),</span><br><span class="line">      source,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å¾ˆæ˜æ˜¾ï¼Œrunwayå°±æ˜¯ä¸€ä¸ªä¿å­˜äº†åœ¨æ»šåŠ¨è¿‡ç¨‹ä¸­å‡ ä¸ªæ¯”è¾ƒé‡è¦å‚æ•°çš„å¯¹è±¡ã€‚</p><p>scrollTopï¼šscrollerçš„scrollTop</p><p>requestInProgressï¼šæ˜¯å¦æ­£åœ¨è¯·æ±‚æ•°æ®ï¼Œ</p><p>nodesï¼šæ¸²æŸ“å‡ºæ¥çš„å…ƒç´ é›†åˆï¼ˆä¸ä»…ä»…æ˜¯å±å¹•å†…çš„å…ƒç´ ï¼‰</p><p>screenNodesï¼šnodesçš„ç¼“å­˜</p><p>runwayMaxScrollTopï¼šscrollerçš„æœ€å¤§æ»šåŠ¨é«˜åº¦ï¼Œå³Sentineçš„topå€¼ï¼Œå¯ä»¥ç”±sourceçš„heightè®¡ç®—å¾—å‡ºã€‚</p><p>è‡³äºfirstAttachedItem&#x2F;lastAttachedItem&#x2F;firstScreenItem&#x2F;lastScreenItemè¿™ä¸¤å¯¹çš„æ„æ€ï¼Ÿï¼Ÿä¸ºä»€ä¹ˆæ˜¯ä¸¤å¯¹ï¼Œè¿™ä¸ªåé¢ä¼šè§£é‡Šï¼Œè¿™é‡Œè®¤ä¸ºåªæœ‰ä¸€å¯¹å¥½äº†ï¼Œå³firstScreenItem&#x2F;lastScreenItemï¼Œæ„æ€æ˜¯æŠŠsourceä¸­çš„å“ªå‡ é¡¹æ¸²æŸ“åˆ°containerå†…ã€‚</p><p>è¿™æ ·ï¼ŒinitRunwaysçš„æ„æ€æ˜¯åˆå§‹åŒ–äº†è¿™æ ·ä¸€ä¸ªå¯¹è±¡ï¼Œè‡³äºactivatedRunwayæš‚ä¸”è·³è¿‡ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">update</span>()</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">update</span>(<span class="params">disableRender?: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">scrollerHeight</span> = <span class="variable language_">this</span>.<span class="property">scrollerOperations</span>.<span class="title function_">getOffsetHeight</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getRunway</span>().<span class="property">runwayMaxScrollTop</span> = <span class="variable language_">this</span>.<span class="title function_">getRunwayMaxScrollTop</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setSentinelPosition</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">emit</span>(<span class="title class_">Recycler</span>.<span class="property">Events</span>.<span class="property">Update</span>, <span class="variable language_">this</span>, disableRender);</span><br><span class="line">    !disableRender &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">onScroll</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>upadteå†…éƒ¨é¦–å…ˆç®—å‡ºscrollerçš„æ»šåŠ¨é«˜åº¦ï¼Œè°ƒç”¨setSentinelPositionï¼Œç„¶åæ‰‹åŠ¨è°ƒç”¨onScrollæ–¹æ³•æ¸²æŸ“å‡ºç¬¬ä¸€å±å…ƒç´ ã€‚æ‰€ä»¥å…³é”®æ˜¯onScrollçš„å®ç°ã€‚</p><p><a href="https://github.com/hdcoo/recycler-view/blob/master/src/Recycler.ts#L285">onScroll</a></p><p>å»ç¹ä»ç®€,onScrollå¹²çš„äº‹é¦–å…ˆç®—å‡ºåœ¨å½“å‰æ»šåŠ¨ä¸­åº”è¯¥è¢«æ¸²æŸ“å…ƒç´ çš„ç´¢å¼•ï¼ˆå…ˆä¸è€ƒè™‘å…·ä½“çš„å®ç°ï¼‰ï¼Œç„¶åæ ¹æ®æ»šåŠ¨çš„æ–¹å‘è°ƒç”¨fillæ–¹æ³•æ¸²æŸ“html</p><p><a href="https://github.com/hdcoo/recycler-view/blob/master/src/Recycler.ts#L332">fill</a></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fixedStart = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>, start);</span><br><span class="line"><span class="keyword">const</span> fixedEnd = <span class="title class_">Math</span>.<span class="title function_">min</span>(runway.<span class="property">source</span>.<span class="title function_">getLength</span>(<span class="variable language_">this</span>) - <span class="number">1</span>, end);</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤å¥å¾ˆç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆè¦é‡æ–°è®¡ç®—startå’Œendå‘¢</p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/d23cee97-7080-4a8f-89b0-24e87b67e522-image.png" alt="d23cee97-7080-4a8f-89b0-24e87b67e522-image.png"></p><p><img src="https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/%E5%8A%A8%E7%94%BB2.gif?versionId=CAEQGxiBgIC7n4v85xciIDNhYjIwMTQ3YTZlOTQ5MmFiMGMzZTU3ZWE5OWZlNmZh"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºç”±äºrunwayItemsOppositeä¸runwayItemsçš„å­˜åœ¨ï¼Œç®—å‡ºæ¥çš„startå¯èƒ½å°äº0ï¼Œendå¯èƒ½å¤§äºsourceçš„æœ€å¤§é•¿åº¦ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°è®¡ç®—ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆinitRunwayæ–¹æ³•é‡Œé¢æœ‰ä¸¤å¯¹å…³äºstartã€endçš„å€¼çš„åŸå› ã€‚</p><p>ç®—å‡ºæ­£ç¡®çš„startã€endåè°ƒç”¨äº†attachContentã€‚</p><p>attachContentåˆ†ä¸¤æ­¥ï¼š</p><ol><li>æ ¹æ®startã€endé‡Šæ”¾å±å¹•å¤–çš„å…ƒç´ ã€‚è¿™é‡Œæœ‰ä¸¤æ­¥ï¼Œé¦–å…ˆæ›´æ–°runway.nodesä¸runway.screenNodesï¼ŒscreenNodesæ˜¯nodesçš„ç¼“å­˜ï¼Œè¿™ä¿©è´§åªè´Ÿè´£æ¸²æŸ“containerå†…éƒ¨çš„å…ƒç´ ï¼Œå®ç°domçš„é‡å¤åˆ©ç”¨çš„æ˜¯renderer.releaseæ–¹æ³•ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">release</span>(<span class="attr">el</span>: <span class="title class_">HTMLElement</span>, <span class="attr">recycler</span>: <span class="title class_">IRecycler</span>&lt;T&gt;): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="property">using</span>.<span class="title function_">delete</span>(el);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="property">unused</span>.<span class="title function_">push</span>(el);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨releaseæ–¹æ³•æ—¶ç¼“å­˜äº†åºŸå¼ƒçš„å…ƒç´ ã€‚</p><ol start="2"><li>æ¸²æŸ“å½“å‰æ»šåŠ¨å±å¹•å†…çš„å…ƒç´ ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="title function_">attachContent</span>(<span class="params">start: <span class="built_in">number</span>, end: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> runway = <span class="variable language_">this</span>.<span class="title function_">getRunway</span>();</span><br><span class="line">    <span class="keyword">const</span> benchNodes = []; <span class="comment">// æ¿å‡³å…ƒç´ ï¼Œå³ç­‰å¾…è¢«æ”¾åˆ° DOM tree é‡Œçš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">changedNodes</span>: <span class="title class_">IChangedNodes</span> = []; <span class="comment">// æœ‰å˜åŒ–çš„èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡ç‚¹æ˜¯é‡Šæ”¾åœ¨å±å¹•å¤–çš„å…ƒç´ </span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">freeUnusedNodes</span>(start, end, <span class="variable language_">this</span>.<span class="property">isForceUpdate</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ¸²æŸ“èµ·å§‹ç‚¹åˆ°æ¸²æŸ“ç»ˆæ­¢ç‚¹è¿›è¡Œéå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = start; i &lt;= end; i++) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœ node å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œè¯´æ˜å…ƒç´ æœ¬æ¥å°±åœ¨å±å¹•ä¸Šï¼Œä¸éœ€è¦åšä»€ä¹ˆï¼ˆé™¤éæŒ‡å®šå¼ºåˆ¶æ›´æ–°ï¼‰</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isForceUpdate</span> &amp;&amp; runway.<span class="property">nodes</span>[i]) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> renderer = <span class="variable language_">this</span>.<span class="title function_">getRenderer</span>(i);</span><br><span class="line">      <span class="keyword">const</span> data = runway.<span class="property">source</span>.<span class="title function_">getData</span>(i, <span class="variable language_">this</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è°ƒç”¨æ¸²æŸ“å‡½æ•°ï¼Œè·å¾—ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">      <span class="comment">// è¿™ä¸ªèŠ‚ç‚¹å¯èƒ½åœ¨å±å¹•ä¸Šï¼Œä¹Ÿå¯èƒ½ä¸åœ¨ï¼Œå–å†³äºæ¸²æŸ“å™¨çš„è®¾è®¡ï¼ˆæ˜¯å¦æœ‰ç¼“å­˜ï¼‰å’Œå½“å‰æ»šåŠ¨çš„æ·±åº¦</span></span><br><span class="line">      <span class="comment">// å¦‚æœè¯¥èŠ‚ç‚¹åœ¨å±å¹•ä¸Šï¼Œæ€§èƒ½ä¼šæœ€ä½³ï¼Œå› ä¸ºåªéœ€è¦æ”¹å˜ä¸€ä¸‹ translate å°±è¡Œäº†ï¼Œä¸éœ€è¦ layout</span></span><br><span class="line">      <span class="keyword">const</span> node = runway.<span class="property">nodes</span>[i] = renderer.<span class="title function_">render</span>(data, <span class="variable language_">this</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å‘ç¼“å­˜ä¸­å­˜å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨äºç§»é™¤</span></span><br><span class="line">      runway.<span class="property">screenNodes</span>.<span class="title function_">add</span>(node);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å‘å˜åŒ–çš„èŠ‚ç‚¹æ•°ç»„ä¸­åŠ å…¥ä¸€é¡¹ï¼Œç­‰å¾…æ”¹å˜æ ·å¼ï¼ˆtranslate, height, etc...ï¼‰</span></span><br><span class="line">      changedNodes.<span class="title function_">push</span>(&#123;node, <span class="attr">index</span>: i&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœè¯¥èŠ‚ç‚¹çš„çˆ¶å…ƒç´ ä¸æ˜¯æŒ‡å®šçš„å®¹å™¨ï¼Œåˆ™åŠ å…¥æ¿å‡³å…ƒç´ æ•°ç»„ä¸­</span></span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">parentNode</span> !== <span class="variable language_">this</span>.<span class="property">container</span>) &#123;</span><br><span class="line">        benchNodes.<span class="title function_">push</span>(node);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰¹é‡ä¿®æ”¹èŠ‚ç‚¹æ ·å¼</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setNodesStyles</span>(changedNodes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰¹é‡åŠ å…¥å…ƒç´ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">    <span class="keyword">while</span> (benchNodes.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">container</span>.<span class="title function_">appendChild</span>(benchNodes.<span class="title function_">pop</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¹Ÿè®¸å¯ä»¥åŠ è½½æ›´å¤š</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">maybeLoadMore</span>(end);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™å‡ è¡Œä»£ç ç®—æ˜¯æ¯”è¾ƒæ ¸å¿ƒçš„å®ç°ã€‚å¦‚æœrunway.nodes[i]å­˜åœ¨ï¼Œåˆ™ä¸æ¸²æŸ“ï¼Œå³ä½¿ä¸å­˜åœ¨ï¼Œä¼šè°ƒç”¨renderer.renderæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä¼˜å…ˆä»renderçš„ç¼“å­˜ä¸­popä¸€ä¸ªå…ƒç´ å‡ºæ¥ï¼Œæ”¹å˜å®ƒçš„translateå’Œdataä»è€Œå®ç°domçš„é‡å¤åˆ©ç”¨ã€‚</p><p>å¹¶ä¸”ä¸ºäº†æ›´é«˜çš„æ€§èƒ½ï¼Œå®šä¹‰äº†changedNodesä¸benchNodesï¼Œå‰è€…åŒ…å«å½“æ¬¡æ»šåŠ¨ä¸­éœ€è¦æ¸²æŸ“çš„æ‰€æœ‰å…ƒç´ ï¼ˆç¼“å­˜ä¸­çš„å…ƒç´ +æ–°åˆ›å»ºçš„å…ƒç´ ï¼‰ï¼Œåè€…ä»…ä»…æ˜¯æ–°åˆ›å»ºçš„å…ƒç´ ï¼Œè¿™æ ·ä»…ä»…åªéœ€è¦æ”¹å˜å‰è€…çš„transtrateï¼ŒæŠŠåè€…appendåˆ°containerä¸­å°±å¯ä»¥äº†ã€‚</p><p>è¿™æ ·ï¼Œæ•´ä¸ªæµç¨‹ä¾¿èµ°å®Œäº†ï¼Œåé¢åœ¨scrolleræ»šåŠ¨è¿‡ç¨‹ä¸­ä¼šåå¤è°ƒç”¨this.onScrollï¼Œæ€è·¯å’Œä¸Šé¢çš„ä¸€æ ·ã€‚</p><h1 id="ç®€çŸ­çš„æµç¨‹"><a href="#ç®€çŸ­çš„æµç¨‹" class="headerlink" title="ç®€çŸ­çš„æµç¨‹"></a>ç®€çŸ­çš„æµç¨‹</h1><p>å»ç¹ä»ç®€ï¼Œä»æ„é€ å‡½æ•°å¼€å§‹ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š<br>constructor -&gt; this.update() -&gt; this.onScroll() -&gt; (this.getFirstScreenItem;this.getLastScreenItem,è®¡ç®—å‡ºç†è®ºä¸Šcontainerå†…æ¸²æŸ“å…ƒç´ çš„startã€endç´¢å¼•) -&gt; (this.fill(),è®¡ç®—å‡ºå®é™…çš„startã€endç´¢å¼•) -&gt; (this.attachContent(),å‡†å¤‡æ ¹æ®startã€endæ›´æ–°containerå†…çš„å…ƒç´ )</p><p>æŠŠattachContentå•æ‹å‡ºæ¥ã€‚</p><p>this.attachContent() -&gt; (this.freeUnusedNodes(),é‡Šæ”¾å±å¹•å¤–çš„å…ƒç´ ï¼Œå…¶å®æ˜¯æ”¾å…¥renderçš„unusedä¸­) -&gt; (æ¸²æŸ“å±å¹•å†…çš„å…ƒç´ )</p><p>å†è¿‡æ»¤ä¸€éï¼Œæ ¸å¿ƒå®ç°å°±ä¸‰æ­¥ï¼š</p><ol><li>ä¾æ®ä¸Šæ¬¡çš„startã€endè®¡ç®—æœ¬æ¬¡çš„startã€end (getFirstScreenItemã€getLastScreenItem)</li><li>ä¾æ®startã€endé‡Šæ”¾å±å¹•å¤–çš„å…ƒç´ </li><li>ä¾æ®startã€endæ›´æ–°å±å¹•å†…çš„å…ƒç´ </li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="title function_">getFirstScreenItem</span>(<span class="attr">initialAnchorItem</span>: <span class="built_in">number</span>, <span class="attr">scrollTop</span>: <span class="built_in">number</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i = initialAnchorItem;</span><br><span class="line">    <span class="keyword">const</span> runway = <span class="variable language_">this</span>.<span class="title function_">getRunway</span>();</span><br><span class="line">    <span class="keyword">const</span> sourceLastIndex = runway.<span class="property">source</span>.<span class="title function_">getLength</span>(<span class="variable language_">this</span>) - <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// æœ¬æ¬¡scrollTopå¤§äºä¸Šæ¬¡firstScreenItemå¯¹åº”çš„scrollTopï¼Œæ‰€ä»¥æ˜¯å¾€ä¸‹æ»š</span></span><br><span class="line">    <span class="keyword">if</span> (runway.<span class="property">source</span>.<span class="title function_">getScrollTop</span>(i, <span class="variable language_">this</span>) + runway.<span class="property">source</span>.<span class="title function_">getHeight</span>(i, <span class="variable language_">this</span>) &lt; scrollTop) &#123;</span><br><span class="line">        <span class="comment">//ä»ä¸Šä¸€æ¬¡firstScreenItemçš„ä¸‹ä¸€ä¸ªå…ƒç´ å¼€å§‹å¾€åéå†ï¼Œä¸€ç›´æ‰¾åˆ°scrollTopå¤§äºå½“å‰scrollTopçš„å…ƒç´ ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; sourceLastIndex &amp;&amp; runway.<span class="property">source</span>.<span class="title function_">getScrollTop</span>(++i, <span class="variable language_">this</span>) + runway.<span class="property">source</span>.<span class="title function_">getHeight</span>(i, <span class="variable language_">this</span>) &lt;= scrollTop) &#123;</span><br><span class="line">            <span class="comment">// do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// é€»è¾‘ä¸å¾€ä¸Šæ»šåŠ¨ç›¸å</span></span><br><span class="line">        <span class="keyword">while</span> (i &gt; <span class="number">0</span> &amp;&amp; runway.<span class="property">source</span>.<span class="title function_">getScrollTop</span>(--i, <span class="variable language_">this</span>) + runway.<span class="property">source</span>.<span class="title function_">getHeight</span>(i, <span class="variable language_">this</span>) &gt; scrollTop) &#123;</span><br><span class="line">            <span class="comment">// do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸Šé¢çš„å¾ªç¯å¾—åˆ°çš„ i çš„æ„ä¹‰æ˜¯åœ¨å±å¹•ä¹‹ä¸Šçš„æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬éœ€è¦çš„æ˜¯ åœ¨å±å¹•å†…çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="comment">// æ•…åŠ  1</span></span><br><span class="line">        i &lt; sourceLastIndex &amp;&amp; i &gt; <span class="number">0</span> &amp;&amp; ++i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="title function_">getLastScreenItem</span>(<span class="attr">initialAnchorItem</span>: <span class="built_in">number</span>, <span class="attr">scrollTop</span>: <span class="built_in">number</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„scrollTopæ˜¯scrollerçš„scrollTop + scrollerçš„offsetHeight</span></span><br><span class="line">    <span class="keyword">let</span> i = initialAnchorItem;</span><br><span class="line">    <span class="keyword">const</span> runway = <span class="variable language_">this</span>.<span class="title function_">getRunway</span>();</span><br><span class="line">    <span class="keyword">const</span> sourceLastIndex = runway.<span class="property">source</span>.<span class="title function_">getLength</span>(<span class="variable language_">this</span>) - <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å¾€ä¸Šæ»š</span></span><br><span class="line">    <span class="keyword">if</span> (runway.<span class="property">source</span>.<span class="title function_">getScrollTop</span>(i, <span class="variable language_">this</span>) &gt; scrollTop) &#123;</span><br><span class="line">        <span class="comment">// ä»ä¸Šä¸€æ¬¡çš„lastScreenItemçš„ä¸Šä¸€ä¸ªå…ƒç´ å¾€å‰éå†ï¼Œä¸€ç›´æ‰¾åˆ°scrollTopå°äºå½“å‰scrollTopçš„å…ƒç´ ç´¢å¼•</span></span><br><span class="line">      <span class="keyword">while</span> (i &gt; <span class="number">0</span> &amp;&amp; runway.<span class="property">source</span>.<span class="title function_">getScrollTop</span>(--i, <span class="variable language_">this</span>) &gt;= scrollTop) &#123;</span><br><span class="line">        <span class="comment">// do nothing</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// é€»è¾‘ä¸å¾€ä¸Šæ»šç›¸å</span></span><br><span class="line">      <span class="keyword">while</span> (i &lt; sourceLastIndex &amp;&amp; runway.<span class="property">source</span>.<span class="title function_">getScrollTop</span>(++i, <span class="variable language_">this</span>) &lt; scrollTop) &#123;</span><br><span class="line">        <span class="comment">// do nothing</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ä¸Šé¢çš„å¾ªç¯å¾—åˆ°çš„ i çš„æ„ä¹‰æ˜¯é¦–ä¸ª scrollTop &gt;= ç»™å®š scrollTop çš„ item</span></span><br><span class="line">      <span class="comment">// æˆ‘ä»¬éœ€è¦çš„æ˜¯ æœ€åä¸€ä¸ª scrollTop &lt;= ç»™å®š scrollTop çš„ item</span></span><br><span class="line">      <span class="comment">// æ•…å‡ 1</span></span><br><span class="line">      i &gt; <span class="number">0</span> &amp;&amp; i &lt; sourceLastIndex &amp;&amp; --i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="title function_">freeUnusedNodes</span>(<span class="params">start: <span class="built_in">number</span>, end?: <span class="built_in">number</span>, force?: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> runway = <span class="variable language_">this</span>.<span class="title function_">getRunway</span>();</span><br><span class="line">    <span class="keyword">if</span> (force || start &gt; runway.<span class="property">lastAttachedItem</span> || end &lt; runway.<span class="property">firstAttachedItem</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">freeNodesFromStart</span>(runway.<span class="property">firstAttachedItem</span>, <span class="title class_">Math</span>.<span class="title function_">min</span>(runway.<span class="property">source</span>.<span class="title function_">getLength</span>(<span class="variable language_">this</span>), runway.<span class="property">lastAttachedItem</span> + <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¯èƒ½å¤„ç†æŸç§è¾¹ç•Œæƒ…å†µ</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">freeNodesFromStart</span>(runway.<span class="property">firstAttachedItem</span>, start);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">freeNodesFromEnd</span>(end, runway.<span class="property">lastAttachedItem</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œä¾æ¬¡é‡Šæ”¾å±å¹•ä¸Šæ¬¡è¾¹ç•Œä»¥å¤–çš„å…ƒç´ ï¼Œé‡Šæ”¾æ–¹æ³•å°±æ˜¯ä½¿ç”¨forå¾ªç¯ä¾æ¬¡æ”¾å…¥renderçš„unusedä¸­ã€‚</p><p>æœ€åå°±æ˜¯æ›´æ–°å±å¹•å†…çš„å…ƒç´ ï¼Œæ›´æ–°æ–¹æ³•æ˜¯ä¼˜å…ˆå¤ç”¨renderçš„unusedä¸­çš„å…ƒç´ ï¼Œä»…ä»…æ”¹å˜ä»–ä»¬çš„translateï¼Œä¸ä¼šå¼•èµ·é‡æ’ï¼Œå¦‚æœitemå¾ˆå¤æ‚çš„è¯ï¼Œrender.updateæ–¹æ³•ä¹Ÿä¼šæ¶ˆè€—æ€§èƒ½ï¼Œä½†è¿™æ˜¯å¤–éƒ¨æ§åˆ¶çš„ã€‚å¦‚æœrender.unusedä¸­æ²¡æœ‰å…ƒç´ ï¼Œåˆ™éœ€è¦createDomï¼ˆä¸render.updateç±»ä¼¼ï¼‰ -&gt; appendDomï¼Œé™¤äº†é¦–æ¬¡æ¸²æŸ“ï¼Œä¸ä¼šå‡ºç°é«˜é¢‘appendDomçš„æƒ…å†µã€‚</p><p>æ‰€ä»¥å°±åº“æœ¬èº«æ¥è¯´ï¼Œæ€§èƒ½è¿˜æ˜¯æŒºé«˜çš„ã€‚</p><p>æœ€åï¼Œç”±äºè¿™ä¸ªåº“çš„ç‰¹æ®Šå¸ƒå±€ï¼Œå®ƒèƒ½å®ç°å¾ˆå¤šç§UIæ•ˆæœï¼Œæ™®é€šçš„å¤šåˆ—ã€ç”šè‡³å¤æ‚çš„å¤šåˆ—ç€‘å¸ƒæµã€‚ä¸è¶³çš„åœ°æ–¹å°±æ˜¯æ¯ä¸ªiteméƒ½éœ€è¦çŸ¥é“heightä¸scrollTopã€‚</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
