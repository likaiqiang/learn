{"title":"webpackå¸¸è§loaderå·¥ä½œåŸç†","slug":"webpackå¸¸è§loaderå·¥ä½œåŸç†","date":"2023-05-08T15:13:26.000Z","updated":"2023-11-21T14:19:22.813Z","comments":true,"path":"api/articles/webpackå¸¸è§loaderå·¥ä½œåŸç†.json","excerpt":null,"covers":["https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/62a133e5-68a4-4075-9139-6fa14982d7fb-image.png","https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/2854f00e-4d2a-4e0d-b0b6-85f0d91cafad-%E5%9B%BE%E7%89%87.png"],"content":"<h1 id=\"file-loaderä¸url-loader\"><a href=\"#file-loaderä¸url-loader\" class=\"headerlink\" title=\"file-loaderä¸url-loader\"></a>file-loaderä¸url-loader</h1><p>è¿™ä¿©loaderå°±æ˜¯çº¸è€è™ï¼Œæ›¾ç»è€æœ‰é¢è¯•é—®è¿™ä¿©loaderçš„åŒºåˆ«ï¼Œæ¯æ¬¡éƒ½å»è®°ğŸ˜‚ï¼Œå…¶å®åªè¦çœ‹çœ‹ä»–ä¿©çš„æºç å°±æ˜ç™½äº†ã€‚å…ˆæ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//webpack.config.js</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&#x27;@babel/register&#x27;</span>)(&#123;</span><br><span class=\"line\">    <span class=\"attr\">presets</span>: [<span class=\"string\">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/index.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">    <span class=\"attr\">module</span>:&#123;</span><br><span class=\"line\">        <span class=\"attr\">rules</span>:[</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(png|jpe?g|gif)$/i</span>,</span><br><span class=\"line\">                <span class=\"attr\">use</span>: [</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">loader</span>: path.<span class=\"title function_\">resolve</span>(__dirname,<span class=\"string\">&#x27;./src/loaders/file-loader/cjs.js&#x27;</span>)</span><br><span class=\"line\">                        <span class=\"comment\">// è¿™é‡Œæˆ‘ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œcopyäº†file-loaderçš„æºç </span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//./src/index.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> imgUrl = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./images/test.png&#x27;</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;imgUrl&#x27;</span>,imgUrl);</span><br></pre></td></tr></table></figure>\n<p>è¿˜éœ€è¦é…ç½®ä¸€ä¸‹debugç¯å¢ƒï¼Œæˆ‘ç”¨çš„æ˜¯webstormï¼Œå…¶ä»–ideåŒç†ï¼Œèƒ½è°ƒè¯•nodeå°±èƒ½è°ƒè¯•webpack-loaderã€‚</p>\n<p><img src=\"https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/62a133e5-68a4-4075-9139-6fa14982d7fb-image.png\" alt=\"62a133e5-68a4-4075-9139-6fa14982d7fb-image.png\"></p>\n<p>æœ€åè¿›å…¥æ­£æ–‡ï¼Œåœ¨<a href=\"https://github.com/webpack-contrib/file-loader/blob/master/src/index.js#L10\">loaderå‡½æ•°</a> è¿™é‡Œæ‰“ä¸ªæ–­ç‚¹ï¼Œå°±å¯ä»¥çœ‹file-loaderçš„æ‰§è¡Œè¿‡ç¨‹äº†ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">loader</span>(<span class=\"params\">content</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> options = <span class=\"title function_\">getOptions</span>(<span class=\"variable language_\">this</span>); <span class=\"comment\">//è¿™é‡Œæ‹¿åˆ°çš„optionså°±æ˜¯webpacké…ç½®æ–‡ä»¶file-loaderé‚£é‡Œä¼ è¿‡æ¥çš„optionsï¼Œæˆ‘ä»¬è¿™é‡Œä¸ºç©º</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">validate</span>(schema, options, &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;File Loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">baseDataPath</span>: <span class=\"string\">&#x27;options&#x27;</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"comment\">// éªŒè¯optionsåˆæ³•æ€§</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> context = options.<span class=\"property\">context</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">rootContext</span>; <span class=\"comment\">//è¿™ä¸é‡è¦</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> name = options.<span class=\"property\">name</span> || <span class=\"string\">&#x27;[contenthash].[ext]&#x27;</span>; <span class=\"comment\">//è¿™æ˜¯ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œåç»­ä¼šæ ¹æ®å®é™…æ›¿æ¢ä¸­æ‹¬å·é‡Œçš„å€¼</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = <span class=\"title function_\">interpolateName</span>(<span class=\"variable language_\">this</span>, name, &#123;</span><br><span class=\"line\">    context,</span><br><span class=\"line\">    content,</span><br><span class=\"line\">    <span class=\"attr\">regExp</span>: options.<span class=\"property\">regExp</span>,</span><br><span class=\"line\">  &#125;); <span class=\"comment\">//interpolateNameè¿™ä¸ªå‡½æ•°ä¼šæ ¹æ®èµ„æºçš„åŸå§‹ä¿¡æ¯æ›¿æ¢æ‰nameé‡Œçš„æ¨¡æ¿ï¼Œæœ€åç”Ÿæˆä¸€ä¸ªå¤„ç†è¿‡çš„èµ„æºåç§°ï¼Œç±»ä¼¼c04dc325df0375584b.png</span></span><br><span class=\"line\">    <span class=\"comment\">// è¿™é‡ŒçŸ¥é“ä½œç”¨å°±å¯ä»¥äº†ï¼Œå…ˆç•¥è¿‡</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> outputPath = url;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (options.<span class=\"property\">outputPath</span>) &#123; <span class=\"comment\">// æˆ‘ä»¬çš„optionsé‡Œé¢å•¥éƒ½æ²¡æœ‰ï¼Œè¿™å¥ä¸ä¼šæ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> options.<span class=\"property\">outputPath</span> === <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      outputPath = options.<span class=\"title function_\">outputPath</span>(url, <span class=\"variable language_\">this</span>.<span class=\"property\">resourcePath</span>, context);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      outputPath = path.<span class=\"property\">posix</span>.<span class=\"title function_\">join</span>(options.<span class=\"property\">outputPath</span>, url);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> publicPath = <span class=\"string\">`__webpack_public_path__ + <span class=\"subst\">$&#123;<span class=\"built_in\">JSON</span>.stringify(outputPath)&#125;</span>`</span>;</span><br><span class=\"line\">  <span class=\"comment\">// è¿™ä¸ªpublicPathæœ€åä¼šè¢«returnï¼Œä¹‹æ‰€ä»¥åœ¨å‰é¢æ‹¼ä¸ª__webpack_public_path__æ˜¯å› ä¸º__webpack_public_path__æ˜¯webpackæš´éœ²çš„å…¨å±€å˜é‡ï¼Œä»£è¡¨publicPath</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (options.<span class=\"property\">publicPath</span>) &#123; <span class=\"comment\">//è¿™å¥ä¹Ÿä¸æ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> options.<span class=\"property\">publicPath</span> === <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      publicPath = options.<span class=\"title function_\">publicPath</span>(url, <span class=\"variable language_\">this</span>.<span class=\"property\">resourcePath</span>, context);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      publicPath = <span class=\"string\">`<span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">        options.publicPath.endsWith(<span class=\"string\">&#x27;/&#x27;</span>)</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">          ? options.publicPath</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">          : <span class=\"string\">`<span class=\"subst\">$&#123;options.publicPath&#125;</span>/`</span></span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">      &#125;</span><span class=\"subst\">$&#123;url&#125;</span>`</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    publicPath = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(publicPath);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (options.<span class=\"property\">postTransformPublicPath</span>) &#123; <span class=\"comment\">//è¿™å¥ä¹Ÿä¸ä¼šæ‰§è¡Œ</span></span><br><span class=\"line\">    publicPath = options.<span class=\"title function_\">postTransformPublicPath</span>(publicPath);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> options.<span class=\"property\">emitFile</span> === <span class=\"string\">&#x27;undefined&#x27;</span> || options.<span class=\"property\">emitFile</span>) &#123;<span class=\"comment\">//è¿™å¥æ‰§è¡Œäº†</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> assetInfo = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> name === <span class=\"string\">&#x27;string&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> normalizedName = name;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> idx = normalizedName.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;?&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (idx &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        normalizedName = normalizedName.<span class=\"title function_\">substr</span>(<span class=\"number\">0</span>, idx);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> isImmutable = <span class=\"regexp\">/\\[([^:\\]]+:)?(hash|contenthash)(:[^\\]]+)?]/gi</span>.<span class=\"title function_\">test</span>(</span><br><span class=\"line\">        normalizedName</span><br><span class=\"line\">      );</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isImmutable === <span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">        assetInfo.<span class=\"property\">immutable</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    assetInfo.<span class=\"property\">sourceFilename</span> = <span class=\"title function_\">normalizePath</span>(</span><br><span class=\"line\">      path.<span class=\"title function_\">relative</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">rootContext</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">resourcePath</span>)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// ä¸Šé¢é‚£ä¸€å¨å…ˆä¸ç”¨çœ‹ï¼Œå…³é”®æ˜¯è¿™ä¸ªemitFieæ–¹æ³•ï¼Œæ–‡æ¡£åœ¨è¿™é‡Œhttps://webpack.docschina.org/api/loaders/#thisemitfile</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">emitFile</span>(outputPath, content, <span class=\"literal\">null</span>, assetInfo);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    <span class=\"comment\">//æœ€åreturnäº†ä¸€ä¸ªè¿™æ ·çš„ç»“æœ module.exports = __webpack_public_path__ + &quot;c04dc325df0375584b1fcd56895e3c6f.png&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> esModule =</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> options.<span class=\"property\">esModule</span> !== <span class=\"string\">&#x27;undefined&#x27;</span> ? options.<span class=\"property\">esModule</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;esModule ? <span class=\"string\">&#x27;export default&#x27;</span> : <span class=\"string\">&#x27;module.exports =&#x27;</span>&#125;</span> <span class=\"subst\">$&#123;publicPath&#125;</span>;`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç”±äºè¿™ä¸ªä¾‹å­çš„optionsæ˜¯ç©ºï¼Œæ‰€ä»¥çœç•¥äº†å¾ˆå¤šä»£ç ï¼Œè¿™æ˜¯çœç•¥åçš„file-loader</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> options = <span class=\"title function_\">getOptions</span>(<span class=\"variable language_\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">validate</span>(schema, options, &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;File Loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">baseDataPath</span>: <span class=\"string\">&#x27;options&#x27;</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> context = options.<span class=\"property\">context</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">rootContext</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> name = options.<span class=\"property\">name</span> || <span class=\"string\">&#x27;[contenthash].[ext]&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"title function_\">interpolateName</span>(<span class=\"variable language_\">this</span>, name, &#123;</span><br><span class=\"line\">    context,</span><br><span class=\"line\">    content,</span><br><span class=\"line\">    <span class=\"attr\">regExp</span>: options.<span class=\"property\">regExp</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">let</span> outputPath = url;</span><br><span class=\"line\"><span class=\"keyword\">let</span> publicPath = <span class=\"string\">`__webpack_public_path__ + <span class=\"subst\">$&#123;<span class=\"built_in\">JSON</span>.stringify(outputPath)&#125;</span>`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"title function_\">emitFile</span>(outputPath, content, <span class=\"literal\">null</span>, assetInfo);</span><br><span class=\"line\"><span class=\"keyword\">const</span> esModule =</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> options.<span class=\"property\">esModule</span> !== <span class=\"string\">&#x27;undefined&#x27;</span> ? options.<span class=\"property\">esModule</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;esModule ? <span class=\"string\">&#x27;export default&#x27;</span> : <span class=\"string\">&#x27;module.exports =&#x27;</span>&#125;</span> <span class=\"subst\">$&#123;publicPath&#125;</span>;`</span>;</span><br></pre></td></tr></table></figure>\n<p>è¿™å‡ è¡Œä»£ç ä½“ç°é™¤äº†file-loaderéƒ½å¹²äº†äº›ä»€ä¹ˆï¼Œå…¶å®å…³é”®ç‚¹å°±ä¸¤æ­¥ï¼Œé¦–å…ˆé€šè¿‡interpolateNameç¼–è¯‘nameï¼Œç„¶åé€šè¿‡this.emitFileæŠŠåŸå§‹èµ„æºcopyåˆ°distï¼Œé¡ºä¾¿æŠŠåå­—æ”¹æˆç¼–è¯‘åçš„nameï¼Œå®Œäº†ã€‚</p>\n<p>æ¥ä¸‹æ¥çœ‹<a href=\"https://github.com/webpack-contrib/url-loader/blob/master/src/index.js\">url-loader</a> è¿™ä¸ªä»£ç æ›´ç®€ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">loader</span>(<span class=\"params\">content</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Loader Options</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> options = <span class=\"title function_\">getOptions</span>(<span class=\"variable language_\">this</span>) || &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">validate</span>(schema, options, &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;URL Loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">baseDataPath</span>: <span class=\"string\">&#x27;options&#x27;</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// No limit or within the specified limit</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"title function_\">shouldTransform</span>(options.<span class=\"property\">limit</span>, content.<span class=\"property\">length</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; resourcePath &#125; = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> mimetype = <span class=\"title function_\">getMimetype</span>(options.<span class=\"property\">mimetype</span>, resourcePath);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> encoding = <span class=\"title function_\">getEncoding</span>(options.<span class=\"property\">encoding</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> content === <span class=\"string\">&#x27;string&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// eslint-disable-next-line no-param-reassign</span></span><br><span class=\"line\">      content = <span class=\"title class_\">Buffer</span>.<span class=\"title function_\">from</span>(content);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> encodedData = <span class=\"title function_\">getEncodedData</span>(</span><br><span class=\"line\">      options.<span class=\"property\">generator</span>,</span><br><span class=\"line\">      mimetype,</span><br><span class=\"line\">      encoding,</span><br><span class=\"line\">      content,</span><br><span class=\"line\">      resourcePath</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> esModule =</span><br><span class=\"line\">      <span class=\"keyword\">typeof</span> options.<span class=\"property\">esModule</span> !== <span class=\"string\">&#x27;undefined&#x27;</span> ? options.<span class=\"property\">esModule</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">      esModule ? <span class=\"string\">&#x27;export default&#x27;</span> : <span class=\"string\">&#x27;module.exports =&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">    &#125;</span> <span class=\"subst\">$&#123;<span class=\"built_in\">JSON</span>.stringify(encodedData)&#125;</span>`</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Normalize the fallback.</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">loader</span>: fallbackLoader,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: fallbackOptions,</span><br><span class=\"line\">  &#125; = <span class=\"title function_\">normalizeFallback</span>(options.<span class=\"property\">fallback</span>, options);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Require the fallback.</span></span><br><span class=\"line\">  <span class=\"comment\">// eslint-disable-next-line global-require, import/no-dynamic-require</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> fallback = <span class=\"built_in\">require</span>(fallbackLoader);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Call the fallback, passing a copy of the loader context. The copy has the query replaced. This way, the fallback</span></span><br><span class=\"line\">  <span class=\"comment\">// loader receives the query which was intended for it instead of the query which was intended for url-loader.</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> fallbackLoaderContext = <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(&#123;&#125;, <span class=\"variable language_\">this</span>, &#123;</span><br><span class=\"line\">    <span class=\"attr\">query</span>: fallbackOptions,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> fallback.<span class=\"title function_\">call</span>(fallbackLoaderContext, content);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢é‚£ä¸€å¤§å †ï¼Œå…³é”®æ­¥éª¤è¿˜æ˜¯ä¸¤ç‚¹ï¼Œä¸€ä¸ªæ˜¯shouldTransformï¼Œä¸€ä¸ªæ˜¯normalizeFallbackã€‚</p>\n<p>shouldTransformï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯å¦æŠŠæ–‡ä»¶è½¬æˆbase64ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">shouldTransform</span>(<span class=\"params\">limit, size</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> limit === <span class=\"string\">&#x27;boolean&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> limit;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> limit === <span class=\"string\">&#x27;string&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> size &lt;= <span class=\"built_in\">parseInt</span>(limit, <span class=\"number\">10</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> limit === <span class=\"string\">&#x27;number&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> size &lt;= limit;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»ä»£ç æ¥çœ‹ï¼Œlimitå¯ä»¥ç›´æ¥æ˜¯true&#x2F;falseï¼Œæˆ–è€…æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ä¼šè°ƒparseIntè½¬æˆæ•°å­—ï¼Œé€»è¾‘éƒ½ä¸€æ · size &lt;&#x3D; limitã€‚</p>\n<p>å¦‚æœæ»¡è¶³shouldTransformï¼Œä¼šè°ƒç”¨getEncodedDataæŠŠæ–‡ä»¶è½¬æˆbase64ã€‚</p>\n<p>æ¥ä¸‹æ¥æ˜¯normalizeFallback</p>\n<p><a href=\"https://github.com/webpack-contrib/url-loader/blob/master/src/utils/normalizeFallback.js#L3\">normalizeFallback</a> çœ‹åˆ°æ²¡æœ‰å‡½æ•°å†…ç¬¬ä¸€è¡Œlet loader &#x3D; â€˜file-loaderâ€™;<br>å†å›åˆ°url-loader</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">const</span> fallback = <span class=\"built_in\">require</span>(fallbackLoader); <span class=\"comment\">//è¿™é‡Œçš„fallbackå°±æ˜¯file-loader</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Call the fallback, passing a copy of the loader context. The copy has the query replaced. This way, the fallback</span></span><br><span class=\"line\"><span class=\"comment\">// loader receives the query which was intended for it instead of the query which was intended for url-loader.</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fallbackLoaderContext = <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(&#123;&#125;, <span class=\"variable language_\">this</span>, &#123;</span><br><span class=\"line\">    <span class=\"attr\">query</span>: fallbackOptions,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> fallback.<span class=\"title function_\">call</span>(fallbackLoaderContext, content); <span class=\"comment\">//æœ€åæ‰§è¡Œfile-loader</span></span><br></pre></td></tr></table></figure>\n<p>å®Œäº†ï¼Œæ‰€ä»¥è¿™ä¿©çš„åŒºåˆ«å°±æ˜¯url-loaderå†…éƒ¨ä¼šæ ¹æ®limitçš„å€¼å†³å®šç›´æ¥æŠŠæ–‡ä»¶è½¬æˆbase64è¿˜æ˜¯ç›´æ¥è°ƒç”¨file-loaderã€‚</p>\n<h1 id=\"sass-loaderã€css-loaderã€style-loader\"><a href=\"#sass-loaderã€css-loaderã€style-loader\" class=\"headerlink\" title=\"sass-loaderã€css-loaderã€style-loader\"></a>sass-loaderã€css-loaderã€style-loader</h1><h2 id=\"sass-loader\"><a href=\"#sass-loader\" class=\"headerlink\" title=\"sass-loader\"></a>sass-loader</h2><p><a href=\"https://github.com/webpack-contrib/sass-loader/blob/v13.2.2/src/index.js#L22\">æºç </a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">loader</span>(<span class=\"params\">content</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> options = <span class=\"variable language_\">this</span>.<span class=\"title function_\">getOptions</span>(schema); <span class=\"comment\">//è·å–ä½¿ç”¨sass-loaderæ—¶ä¼ å…¥çš„optionsï¼Œè¿™é‡Œä¸ºç©º</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> callback = <span class=\"variable language_\">this</span>.<span class=\"title function_\">async</span>(); <span class=\"comment\">//è¿™ä¸ªasyncå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„å‡½æ•°callbackï¼Œæ‰§è¡Œè¿™ä¸ªcallbackä¼šæŠŠå½“å‰loaderçš„ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªloaderã€‚è¿™é‡Œsass-loaderä¸æ˜¯æœ€ç»ˆçš„loaderï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸ªã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> implementation = <span class=\"title function_\">getSassImplementation</span>(<span class=\"variable language_\">this</span>, options.<span class=\"property\">implementation</span>);</span><br><span class=\"line\">    <span class=\"comment\">// è·å–sassè§£æå™¨ï¼Œå¯ä»¥æ˜¯node-sassã€dart-sassæˆ–è€…sass-embedded</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!implementation) &#123; <span class=\"comment\">// å¦‚æœè·å–ä¸åˆ°sassè§£æå™¨ï¼Œç›´æ¥è¿”å›ï¼Œå¹¶ä¸”ç»™ä¸‹ä¸€ä¸ªloader callbackä¸€ä¸ªç©º</span></span><br><span class=\"line\">        <span class=\"title function_\">callback</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> useSourceMap =</span><br><span class=\"line\">        <span class=\"keyword\">typeof</span> options.<span class=\"property\">sourceMap</span> === <span class=\"string\">&quot;boolean&quot;</span> ? options.<span class=\"property\">sourceMap</span> : <span class=\"variable language_\">this</span>.<span class=\"property\">sourceMap</span>; <span class=\"comment\">// æ˜¯å¦å¯ç”¨sourceMapï¼Œè¿™é‡Œæ˜¯true</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> sassOptions = <span class=\"keyword\">await</span> <span class=\"title function_\">getSassOptions</span>( </span><br><span class=\"line\">        <span class=\"variable language_\">this</span>,</span><br><span class=\"line\">        options,</span><br><span class=\"line\">        content,</span><br><span class=\"line\">        implementation,</span><br><span class=\"line\">        useSourceMap</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"keyword\">const</span> shouldUseWebpackImporter =</span><br><span class=\"line\">        <span class=\"keyword\">typeof</span> options.<span class=\"property\">webpackImporter</span> === <span class=\"string\">&quot;boolean&quot;</span></span><br><span class=\"line\">            ? options.<span class=\"property\">webpackImporter</span></span><br><span class=\"line\">            : <span class=\"literal\">true</span>;  <span class=\"comment\">//è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨webpackè§£ææºç é‡Œé¢çš„@importï¼Œè¿™é‡Œçš„å€¼æ˜¯true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (shouldUseWebpackImporter) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> isModernAPI = options.<span class=\"property\">api</span> === <span class=\"string\">&quot;modern&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!isModernAPI) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123; includePaths &#125; = sassOptions;</span><br><span class=\"line\"></span><br><span class=\"line\">            sassOptions.<span class=\"property\">importer</span>.<span class=\"title function_\">push</span>(</span><br><span class=\"line\">                <span class=\"title function_\">getWebpackImporter</span>(<span class=\"variable language_\">this</span>, implementation, includePaths)</span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            sassOptions.<span class=\"property\">importers</span>.<span class=\"title function_\">push</span>(</span><br><span class=\"line\">                <span class=\"title function_\">getModernWebpackImporter</span>(<span class=\"variable language_\">this</span>, implementation)</span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    <span class=\"comment\">// ä¸Šé¢çš„ä»£ç ç»†èŠ‚ä¸æ¸…æ¥šï¼Œæ€»çš„æ¥è¯´ï¼Œé€šè¿‡options.apiåˆ¤æ–­æ˜¯å¦æ˜¯æ–°ç‰ˆwebpackï¼Œæ–°æ—§ç‰ˆæœ¬webpackå¤„ç†@importæ–¹æ³•ä¸ä¸€æ ·</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> compile = <span class=\"title function_\">getCompileFn</span>(implementation, options); <span class=\"comment\">//é€šè¿‡ä¸Šé¢çš„implementationè·å–sassç¼–è¯‘å™¨</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = <span class=\"keyword\">await</span> <span class=\"title function_\">compile</span>(sassOptions, options) <span class=\"comment\">// ç¼–è¯‘sassï¼Œè¿™é‡Œå‡è®¾ç¼–è¯‘æ²¡æœ‰é”™è¯¯ï¼Œæ‰€ä»¥çœç•¥äº†å¤„ç†é”™è¯¯çš„ä»£ç </span></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> map =</span><br><span class=\"line\">        <span class=\"comment\">// Modern API, then legacy API</span></span><br><span class=\"line\">        result.<span class=\"property\">sourceMap</span></span><br><span class=\"line\">            ? result.<span class=\"property\">sourceMap</span></span><br><span class=\"line\">            : result.<span class=\"property\">map</span></span><br><span class=\"line\">                ? <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(result.<span class=\"property\">map</span>)</span><br><span class=\"line\">                : <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Modify source paths only for webpack, otherwise we do nothing</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (map &amp;&amp; useSourceMap) &#123;</span><br><span class=\"line\">        map = <span class=\"title function_\">normalizeSourceMap</span>(map, <span class=\"variable language_\">this</span>.<span class=\"property\">rootContext</span>);</span><br><span class=\"line\">    &#125; <span class=\"comment\">// è¿™é‡Œç”Ÿæˆçš„mapï¼Œæœ€åä¼šé€šè¿‡callbackä¼ ç»™ä¸‹ä¸€ä¸ªloaderï¼Œè¿™é‡Œä¸å…³å¿ƒsourceMapï¼Œç•¥</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Modern API</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> result.<span class=\"property\">loadedUrls</span> !== <span class=\"string\">&quot;undefined&quot;</span>) &#123;</span><br><span class=\"line\">        result.<span class=\"property\">loadedUrls</span></span><br><span class=\"line\">            .<span class=\"title function_\">filter</span>(<span class=\"function\">(<span class=\"params\">url</span>) =&gt;</span> url.<span class=\"property\">protocol</span> === <span class=\"string\">&quot;file:&quot;</span>)</span><br><span class=\"line\">            .<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">includedFile</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> normalizedIncludedFile = url.<span class=\"title function_\">fileURLToPath</span>(includedFile);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// Custom `importer` can return only `contents` so includedFile will be relative</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (path.<span class=\"title function_\">isAbsolute</span>(normalizedIncludedFile)) &#123;</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"title function_\">addDependency</span>(normalizedIncludedFile);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// Legacy API</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        <span class=\"keyword\">typeof</span> result.<span class=\"property\">stats</span> !== <span class=\"string\">&quot;undefined&quot;</span> &amp;&amp;</span><br><span class=\"line\">        <span class=\"keyword\">typeof</span> result.<span class=\"property\">stats</span>.<span class=\"property\">includedFiles</span> !== <span class=\"string\">&quot;undefined&quot;</span></span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">        result.<span class=\"property\">stats</span>.<span class=\"property\">includedFiles</span>.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">includedFile</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> normalizedIncludedFile = path.<span class=\"title function_\">normalize</span>(includedFile);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Custom `importer` can return only `contents` so includedFile will be relative</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (path.<span class=\"title function_\">isAbsolute</span>(normalizedIncludedFile)) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">addDependency</span>(normalizedIncludedFile);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ä¸Šé¢è¿™ä¸€å †ï¼Œç»†èŠ‚ä¸æ¸…æ¥šï¼Œæ€»çš„æ¥è¯´ï¼Œæ˜¯å¤„ç†sassæ–‡ä»¶é‡Œçš„å¼•å…¥çš„æœ¬åœ°æ–‡ä»¶ï¼ŒæŠŠå®ƒä»¬åŠ å…¥webpackçš„ä¾èµ–ä¸­ï¼Œä»¥ä¾¿åœ¨å®ƒä»¬å˜åŒ–æ—¶é‡æ–°ç¼–è¯‘sassæ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">callback</span>(<span class=\"literal\">null</span>, result.<span class=\"property\">css</span>.<span class=\"title function_\">toString</span>(), map);</span><br><span class=\"line\">    <span class=\"comment\">// æœ€åæŠŠç¼–è¯‘å¥½çš„cssä¼ é€’ç»™ä¸‹ä¸€ä¸ªloader</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ‰€æœ‰ï¼Œç®€å•è¯´ï¼Œå¦‚æœå¿½ç•¥å¤„ç†@importä¸source-mapçš„é€»è¾‘ï¼Œsass-loaderæ‰€åšçš„äº‹ï¼Œå°±æ˜¯å…ˆé€‰æ‹©åˆé€‚çš„sassè§£æå™¨ï¼Œç„¶åç¼–è¯‘sassæ–‡ä»¶æŠŠç»“æœä¼ ç»™ä¸‹ä¸€ä¸ªloaderã€‚</p>\n<h2 id=\"css-loader\"><a href=\"#css-loader\" class=\"headerlink\" title=\"css-loader\"></a>css-loader</h2><p><a href=\"https://github.com/webpack-contrib/css-loader/blob/v6.7.3/src/index.js#L33\">æºç </a></p>\n<p>è¿™ä¸ªloaderé¦–å…ˆä¼šæœ‰ä¸€å †å¤„ç†pluginçš„é€»è¾‘ï¼Œæˆ‘ä»¬è¿™é‡Œä¸å…³æ³¨pluginï¼Œç›´æ¥ä»<a href=\"https://github.com/webpack-contrib/css-loader/blob/v6.7.3/src/index.js#L155\">155</a> è¡Œå¼€å§‹çœ‹ã€‚<br> å½“ç„¶ï¼Œ155è¡Œè¿™é‡Œçš„pluginéç©º,å› ä¸º40è¡Œä¼šè°ƒç”¨normalizeOptionsé‡æ–°ç”Ÿæˆoptionsï¼Œè¿™é‡Œç”±äºæˆ‘ä»¬åˆšå¼€å§‹çš„rawOptionsæ˜¯ç©ºï¼Œè¿™é‡Œé‡æ–°ç”Ÿæˆçš„optionsé•¿è¿™æ ·: </p>\n<p><img src=\"https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/2854f00e-4d2a-4e0d-b0b6-85f0d91cafad-%E5%9B%BE%E7%89%87.png\" alt=\"2854f00e-4d2a-4e0d-b0b6-85f0d91cafad-å›¾ç‰‡.png\"></p>\n<p>ç”±äºoptions.urlä¸options.importæ˜¯trueï¼Œæ‰€ä»¥155è¡Œçš„pluginæ˜¯ä¸ªé•¿åº¦ä¸º2çš„æ•°ç»„ï¼Œè¿™é‡Œä¼šè°ƒç”¨postcsså¤„ç†è¿™ä¸ªpluginï¼Œä¸»è¦å¤„ç†cssæ–‡ä»¶é‡Œçš„@importä¸urlç›¸å…³ã€‚</p>\n<p>è¿™é‡Œå‡è®¾æ²¡æœ‰é”™è¯¯ï¼Œä¹Ÿæ²¡æœ‰warningï¼Œå‰©ä¸‹çš„é‚£ä¸€å †ä»£ç ç»†èŠ‚å…ˆä¸ç®¡ï¼Œç›´æ¥è·³åˆ°æœ€åä¸€è¡Œï¼Œæœ€åä¸€è¡Œcallbackäº†ä¸€ä¸ªç»è¿‡æ‹¼æ¥çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå­—ç¬¦ä¸²logå‡ºæ¥:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Imports</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ <span class=\"keyword\">from</span> <span class=\"string\">&quot;./loaders/css-loader/runtime/noSourceMaps.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ___CSS_LOADER_API_IMPORT___ <span class=\"keyword\">from</span> <span class=\"string\">&quot;./loaders/css-loader/runtime/api.js&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> ___CSS_LOADER_EXPORT___ = <span class=\"title function_\">___CSS_LOADER_API_IMPORT___</span>(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);</span><br><span class=\"line\"><span class=\"comment\">// Module</span></span><br><span class=\"line\">___CSS_LOADER_EXPORT___.<span class=\"title function_\">push</span>([<span class=\"variable language_\">module</span>.<span class=\"property\">id</span>, <span class=\"string\">&quot;.container &#123;\\n  max-width: 960px;\\n  margin: 0 auto;\\n  padding: 20px;\\n  background-color: #fff;\\n  border-radius: 4px;\\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); &#125;\\n  .container h1 &#123;\\n    color: #007bff;\\n    font-size: 36px;\\n    text-align: center; &#125;\\n&quot;</span>, <span class=\"string\">&quot;&quot;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Exports</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> ___CSS_LOADER_EXPORT___;</span><br></pre></td></tr></table></figure>\n<p>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œcss-loaderæŠŠcssè½¬æ¢æˆäº†å¯è¿è¡Œçš„jsï¼Œè½¬æ¢åçš„cssåˆ™é€šè¿‡å­—ç¬¦ä¸²çš„å½¢å¼æ”¾åœ¨___CSS_LOADER_EXPORT___è¿™ä¸ªå˜é‡ä¸Šï¼Œæœ€åå¯¼å‡º___CSS_LOADER_EXPORT___ã€‚</p>\n<p>è¿™ä¸ªæ–‡ä»¶ç«™åœ¨ä½¿ç”¨è€…çš„è§’åº¦ä¸Šæ¥çœ‹æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œcsså˜›ï¼Œè¦ä¹ˆé€šè¿‡linkæ ‡ç­¾å¼•å…¥ï¼Œè¦ä¹ˆé€šè¿‡styleæ’å…¥åˆ°headé‡Œã€‚å¦‚æœæ˜¯å‰è€…ï¼Œloaderæ˜¯åšä¸åˆ°äº†ï¼Œå› ä¸ºloaderçš„ä½œç”¨ä»…ä»…æ˜¯æŠŠå„ç§æ–‡ä»¶è½¬æ¢æˆå¯è¿è¡Œçš„jsï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”¨mini-css-extract-pluginï¼Œè¿™ä¸ªæ’ä»¶ä¼šåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­æ‹¿åˆ°cssæ–‡ä»¶çš„è·¯å¾„ï¼Œç„¶ååœ¨æ‰“åŒ…ç»“æŸé€šè¿‡linkæ ‡ç­¾æŠŠcssæ’å…¥htmlï¼Œéœ€è¦é…åˆhtmlwebpackpluginä½¿ç”¨ã€‚å¦‚æœæ˜¯åè€…ï¼Œå¯ä»¥ä½¿ç”¨style-loaderã€‚</p>\n<h2 id=\"style-loader\"><a href=\"#style-loader\" class=\"headerlink\" title=\"style-loader\"></a>style-loader</h2><p><a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/index.js#L28\">æºç </a></p>\n<p>è¿™ä¸ªloaderçš„å…¥å£æ˜¯ä¸€ä¸ªpitchå‡½æ•°ï¼Œæˆ‘ä»¬çŸ¥é“webpack loaderæ˜¯ä»å³å¾€å·¦æ‰§è¡Œçš„</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">rules</span>:[</span><br><span class=\"line\">     &#123;</span><br><span class=\"line\">        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.scss$/</span>,</span><br><span class=\"line\">        <span class=\"attr\">use</span>:[<span class=\"string\">&#x27;style-loader&#x27;</span>,<span class=\"string\">&#x27;css-loader&#x27;</span>,<span class=\"string\">&#x27;sass-loader&#x27;</span>]</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å‡å¦‚ä½ çš„webpacké…ç½®é•¿è¿™æ ·ï¼Œå¦‚æœæ²¡æœ‰pitchå‡½æ•°ï¼Œåº”è¯¥ä»å³å¾€å·¦ï¼Œå³sass-loader css-loader style-loaderï¼Œå¦‚æœä¸‰ä¸ªloaderéƒ½æœ‰pitchå‡½æ•°ï¼Œæ‰§è¡Œé¡ºåºå˜æˆè¿™æ ·ï¼Œstyle-loader-pitch css-loader-pitch sass-loader-pitch sass-loader css-loader style-loaderï¼Œå¦‚æœåœ¨è¿™æ¡ä»£ç é“¾çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰æŸä¸€ä¸ªloaderçš„pitchè¿”å›äº†ä¸€ä¸ªå€¼ï¼Œåé¢loaderçš„ä»£ç å°±ä¸æ‰§è¡Œäº†ã€‚</p>\n<p>å›åˆ°çœŸå®æƒ…å†µï¼Œè¿™é‡Œçš„style-loader-pitchè¿”å›äº†å€¼ï¼Œæ‰€ä»¥åªä¼šæ‰§è¡Œstyle-loader-pitchä¸style-loaderã€‚</p>\n<p>è¿™ä¸ªpitchå‡½æ•°å¤§å¤šæ•°é€»è¾‘æˆ‘ä»¬å¹¶ä¸éœ€è¦å…³æ³¨ï¼Œæˆ‘ä»…ä»…æƒ³çŸ¥é“å®ƒæ˜¯å¦‚ä½•æŠŠcssæ’å…¥domçš„ï¼ˆæˆ‘å¾ˆæ‡’ï¼‰ã€‚æ‰€ä»¥åªéœ€è¦å…³æ³¨è¿™ä¸ªloaderæœ€åè¿”å›äº†ä»€ä¹ˆä¸œè¥¿ï¼Œä¸‹é¢æ˜¯æˆ‘é€šè¿‡debuggeræå–å‡ºæ¥syle-loaderæœ€åç”Ÿæˆçš„ä¸œè¥¿ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"variable constant_\">API</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/injectStylesIntoStyleTag.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> domAPI <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/styleDomAPI.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> insertFn <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/insertBySelector.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> setAttributes <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/setAttributesWithoutAttributes.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> insertStyleElement <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/insertStyleElement.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> styleTagTransformFn <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/styleTagTransform.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> content, * <span class=\"keyword\">as</span> namedExport <span class=\"keyword\">from</span> <span class=\"string\">&quot;!!./loaders/css-loader/index.js!./loaders/sass-loader/index.js!./style.scss&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> options = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">options.<span class=\"property\">styleTagTransform</span> = styleTagTransformFn;</span><br><span class=\"line\">options.<span class=\"property\">setAttributes</span> = setAttributes;</span><br><span class=\"line\"></span><br><span class=\"line\">options.<span class=\"property\">insert</span> = insertFn.<span class=\"title function_\">bind</span>(<span class=\"literal\">null</span>, <span class=\"string\">&quot;head&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">options.<span class=\"property\">domAPI</span> = domAPI;</span><br><span class=\"line\">options.<span class=\"property\">insertStyleElement</span> = insertStyleElement;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> update = <span class=\"title function_\">API</span>(content, options);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable language_\">module</span>.<span class=\"property\">hot</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!content.<span class=\"property\">locals</span> || <span class=\"variable language_\">module</span>.<span class=\"property\">hot</span>.<span class=\"property\">invalidate</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isEqualLocals = <span class=\"keyword\">function</span> <span class=\"title function_\">isEqualLocals</span>(<span class=\"params\">a, b, isNamedExport</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!a &amp;&amp; b || a &amp;&amp; !b) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> p;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (p <span class=\"keyword\">in</span> a) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isNamedExport &amp;&amp; p === <span class=\"string\">&quot;default&quot;</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// eslint-disable-next-line no-continue</span></span><br><span class=\"line\">          <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (a[p] !== b[p]) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (p <span class=\"keyword\">in</span> b) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isNamedExport &amp;&amp; p === <span class=\"string\">&quot;default&quot;</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// eslint-disable-next-line no-continue</span></span><br><span class=\"line\">          <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!a[p]) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isNamedExport = !content.<span class=\"property\">locals</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> oldLocals = isNamedExport ? namedExport : content.<span class=\"property\">locals</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">module</span>.<span class=\"property\">hot</span>.<span class=\"title function_\">accept</span>(</span><br><span class=\"line\">      <span class=\"string\">&quot;!!./loaders/css-loader/index.js!./loaders/sass-loader/index.js!./style.scss&quot;</span>,</span><br><span class=\"line\">      <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_\">isEqualLocals</span>(oldLocals, isNamedExport ? namedExport : content.<span class=\"property\">locals</span>, isNamedExport)) &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">module</span>.<span class=\"property\">hot</span>.<span class=\"title function_\">invalidate</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        oldLocals = isNamedExport ? namedExport : content.<span class=\"property\">locals</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">update</span>(content);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">module</span>.<span class=\"property\">hot</span>.<span class=\"title function_\">dispose</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">update</span>();</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> * <span class=\"keyword\">from</span> <span class=\"string\">&quot;!!./loaders/css-loader/index.js!./loaders/sass-loader/index.js!./style.scss&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> content &amp;&amp; content.<span class=\"property\">locals</span> ? content.<span class=\"property\">locals</span> : <span class=\"literal\">undefined</span>;</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸€æ®µä»£ç ä¼šåœ¨æµè§ˆå™¨é‡Œæ‰§è¡Œï¼Œä¸»è¦æ˜¯è¿™ä¸€å¥</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> update = <span class=\"title function_\">API</span>(content, options);</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œçš„APIæ¥è‡ª<a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/runtime/injectStylesIntoStyleTag.js#L84\">è¿™é‡Œ</a> ,æ‰§è¡ŒAPIçš„è¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨<a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/runtime/injectStylesIntoStyleTag.js#L16\">modulesToDom</a> ,æ¥ç€æ˜¯<a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/runtime/injectStylesIntoStyleTag.js#L41\">addElementStyle</a> ,è¿™ä¸ªå‡½æ•°çš„å‰ä¸¤å¥å®Œæˆäº†æŠŠcssé€šè¿‡styleæ ‡ç­¾æ’å…¥åˆ°domä¸­çš„ä»»åŠ¡ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">addElementStyle</span>(<span class=\"params\">obj, options</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">     <span class=\"keyword\">const</span> api = options.<span class=\"title function_\">domAPI</span>(options);</span><br><span class=\"line\">     api.<span class=\"title function_\">update</span>(obj);</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œçš„domAPIæ¥è‡ª<a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/runtime/styleDomAPI.js#L56\">è¿™å„¿</a> ,é¦–å…ˆé€šè¿‡options.insertStyleElementç”ŸæˆstyleElementï¼ˆè¿™é‡Œä¼šç”Ÿæˆä¸€ä¸ªç©ºçš„styleæ ‡ç­¾ï¼‰ï¼Œç„¶ååœ¨updateå‡½æ•°å†…éƒ¨è°ƒç”¨äº†applyå‡½æ•°ï¼Œapplyå‡½æ•°é¦–å…ˆé€šè¿‡ä¸€ç³»åˆ—æ¡ä»¶å¯¹ä¼ è¿›æ¥çš„cssè¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿™é‡Œä¸æ˜¯é‡ç‚¹ï¼Œå…³é”®æ˜¯æœ€å: </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">options.<span class=\"title function_\">styleTagTransform</span>(css, styleElement, options.<span class=\"property\">options</span>);</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/runtime/styleTagTransform.js\">styleTagTransform</a></p>\n<p>ä»£ç å¾ˆç®€å•ï¼Œæˆ‘ä»¬è¿™é‡Œåªä¼šå‘½ä¸­&#96;&#96;styleElement.appendChild(document.createTextNode(css));&#96;è¿™ä¸€å¥ã€‚</p>\n<p>ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œstyle-loaderçš„pitchå‡½æ•°è¿”å›äº†å€¼ï¼Œåé¢çš„loaderä¸æ‰§è¡Œäº†ï¼Œé‚£æ˜¯æ€ä¹ˆæŠŠsassä»£ç è½¬æ¢æˆcssçš„ï¼Œæ³¨æ„çœ‹ä¸Šé¢style-loaderçš„è¿”å›å€¼é‡Œé¢æœ‰è¿™ä¹ˆä¸€å¥: </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> content, * <span class=\"keyword\">as</span> namedExport <span class=\"keyword\">from</span> <span class=\"string\">&quot;!!./loaders/css-loader/index.js!./loaders/sass-loader/index.js!./style.scss&quot;</span>;</span><br></pre></td></tr></table></figure>\n<p>webpackä¼šè§£æè¿™ä¸ªimportï¼ˆå¸¦æœ‰æ„Ÿå¹å·çš„ä¼šå¿½ç•¥ï¼‰ï¼Œç„¶ååœ¨importçš„è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œsass-loaderã€css-loaderã€‚</p>\n<h1 id=\"babel-loader\"><a href=\"#babel-loader\" class=\"headerlink\" title=\"babel-loader\"></a>babel-loader</h1><h1 id=\"vue-loader\"><a href=\"#vue-loader\" class=\"headerlink\" title=\"vue-loader\"></a>vue-loader</h1>","more":"<h1 id=\"file-loaderä¸url-loader\"><a href=\"#file-loaderä¸url-loader\" class=\"headerlink\" title=\"file-loaderä¸url-loader\"></a>file-loaderä¸url-loader</h1><p>è¿™ä¿©loaderå°±æ˜¯çº¸è€è™ï¼Œæ›¾ç»è€æœ‰é¢è¯•é—®è¿™ä¿©loaderçš„åŒºåˆ«ï¼Œæ¯æ¬¡éƒ½å»è®°ğŸ˜‚ï¼Œå…¶å®åªè¦çœ‹çœ‹ä»–ä¿©çš„æºç å°±æ˜ç™½äº†ã€‚å…ˆæ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//webpack.config.js</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&#x27;@babel/register&#x27;</span>)(&#123;</span><br><span class=\"line\">    <span class=\"attr\">presets</span>: [<span class=\"string\">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/index.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">    <span class=\"attr\">module</span>:&#123;</span><br><span class=\"line\">        <span class=\"attr\">rules</span>:[</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(png|jpe?g|gif)$/i</span>,</span><br><span class=\"line\">                <span class=\"attr\">use</span>: [</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">loader</span>: path.<span class=\"title function_\">resolve</span>(__dirname,<span class=\"string\">&#x27;./src/loaders/file-loader/cjs.js&#x27;</span>)</span><br><span class=\"line\">                        <span class=\"comment\">// è¿™é‡Œæˆ‘ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œcopyäº†file-loaderçš„æºç </span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//./src/index.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> imgUrl = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./images/test.png&#x27;</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;imgUrl&#x27;</span>,imgUrl);</span><br></pre></td></tr></table></figure>\n<p>è¿˜éœ€è¦é…ç½®ä¸€ä¸‹debugç¯å¢ƒï¼Œæˆ‘ç”¨çš„æ˜¯webstormï¼Œå…¶ä»–ideåŒç†ï¼Œèƒ½è°ƒè¯•nodeå°±èƒ½è°ƒè¯•webpack-loaderã€‚</p>\n<p><img src=\"https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/62a133e5-68a4-4075-9139-6fa14982d7fb-image.png\" alt=\"62a133e5-68a4-4075-9139-6fa14982d7fb-image.png\"></p>\n<p>æœ€åè¿›å…¥æ­£æ–‡ï¼Œåœ¨<a href=\"https://github.com/webpack-contrib/file-loader/blob/master/src/index.js#L10\">loaderå‡½æ•°</a> è¿™é‡Œæ‰“ä¸ªæ–­ç‚¹ï¼Œå°±å¯ä»¥çœ‹file-loaderçš„æ‰§è¡Œè¿‡ç¨‹äº†ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">loader</span>(<span class=\"params\">content</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> options = <span class=\"title function_\">getOptions</span>(<span class=\"variable language_\">this</span>); <span class=\"comment\">//è¿™é‡Œæ‹¿åˆ°çš„optionså°±æ˜¯webpacké…ç½®æ–‡ä»¶file-loaderé‚£é‡Œä¼ è¿‡æ¥çš„optionsï¼Œæˆ‘ä»¬è¿™é‡Œä¸ºç©º</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">validate</span>(schema, options, &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;File Loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">baseDataPath</span>: <span class=\"string\">&#x27;options&#x27;</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"comment\">// éªŒè¯optionsåˆæ³•æ€§</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> context = options.<span class=\"property\">context</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">rootContext</span>; <span class=\"comment\">//è¿™ä¸é‡è¦</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> name = options.<span class=\"property\">name</span> || <span class=\"string\">&#x27;[contenthash].[ext]&#x27;</span>; <span class=\"comment\">//è¿™æ˜¯ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œåç»­ä¼šæ ¹æ®å®é™…æ›¿æ¢ä¸­æ‹¬å·é‡Œçš„å€¼</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = <span class=\"title function_\">interpolateName</span>(<span class=\"variable language_\">this</span>, name, &#123;</span><br><span class=\"line\">    context,</span><br><span class=\"line\">    content,</span><br><span class=\"line\">    <span class=\"attr\">regExp</span>: options.<span class=\"property\">regExp</span>,</span><br><span class=\"line\">  &#125;); <span class=\"comment\">//interpolateNameè¿™ä¸ªå‡½æ•°ä¼šæ ¹æ®èµ„æºçš„åŸå§‹ä¿¡æ¯æ›¿æ¢æ‰nameé‡Œçš„æ¨¡æ¿ï¼Œæœ€åç”Ÿæˆä¸€ä¸ªå¤„ç†è¿‡çš„èµ„æºåç§°ï¼Œç±»ä¼¼c04dc325df0375584b.png</span></span><br><span class=\"line\">    <span class=\"comment\">// è¿™é‡ŒçŸ¥é“ä½œç”¨å°±å¯ä»¥äº†ï¼Œå…ˆç•¥è¿‡</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> outputPath = url;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (options.<span class=\"property\">outputPath</span>) &#123; <span class=\"comment\">// æˆ‘ä»¬çš„optionsé‡Œé¢å•¥éƒ½æ²¡æœ‰ï¼Œè¿™å¥ä¸ä¼šæ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> options.<span class=\"property\">outputPath</span> === <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      outputPath = options.<span class=\"title function_\">outputPath</span>(url, <span class=\"variable language_\">this</span>.<span class=\"property\">resourcePath</span>, context);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      outputPath = path.<span class=\"property\">posix</span>.<span class=\"title function_\">join</span>(options.<span class=\"property\">outputPath</span>, url);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> publicPath = <span class=\"string\">`__webpack_public_path__ + <span class=\"subst\">$&#123;<span class=\"built_in\">JSON</span>.stringify(outputPath)&#125;</span>`</span>;</span><br><span class=\"line\">  <span class=\"comment\">// è¿™ä¸ªpublicPathæœ€åä¼šè¢«returnï¼Œä¹‹æ‰€ä»¥åœ¨å‰é¢æ‹¼ä¸ª__webpack_public_path__æ˜¯å› ä¸º__webpack_public_path__æ˜¯webpackæš´éœ²çš„å…¨å±€å˜é‡ï¼Œä»£è¡¨publicPath</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (options.<span class=\"property\">publicPath</span>) &#123; <span class=\"comment\">//è¿™å¥ä¹Ÿä¸æ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> options.<span class=\"property\">publicPath</span> === <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      publicPath = options.<span class=\"title function_\">publicPath</span>(url, <span class=\"variable language_\">this</span>.<span class=\"property\">resourcePath</span>, context);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      publicPath = <span class=\"string\">`<span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">        options.publicPath.endsWith(<span class=\"string\">&#x27;/&#x27;</span>)</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">          ? options.publicPath</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">          : <span class=\"string\">`<span class=\"subst\">$&#123;options.publicPath&#125;</span>/`</span></span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">      &#125;</span><span class=\"subst\">$&#123;url&#125;</span>`</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    publicPath = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(publicPath);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (options.<span class=\"property\">postTransformPublicPath</span>) &#123; <span class=\"comment\">//è¿™å¥ä¹Ÿä¸ä¼šæ‰§è¡Œ</span></span><br><span class=\"line\">    publicPath = options.<span class=\"title function_\">postTransformPublicPath</span>(publicPath);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> options.<span class=\"property\">emitFile</span> === <span class=\"string\">&#x27;undefined&#x27;</span> || options.<span class=\"property\">emitFile</span>) &#123;<span class=\"comment\">//è¿™å¥æ‰§è¡Œäº†</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> assetInfo = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> name === <span class=\"string\">&#x27;string&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> normalizedName = name;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> idx = normalizedName.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;?&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (idx &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        normalizedName = normalizedName.<span class=\"title function_\">substr</span>(<span class=\"number\">0</span>, idx);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> isImmutable = <span class=\"regexp\">/\\[([^:\\]]+:)?(hash|contenthash)(:[^\\]]+)?]/gi</span>.<span class=\"title function_\">test</span>(</span><br><span class=\"line\">        normalizedName</span><br><span class=\"line\">      );</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isImmutable === <span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">        assetInfo.<span class=\"property\">immutable</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    assetInfo.<span class=\"property\">sourceFilename</span> = <span class=\"title function_\">normalizePath</span>(</span><br><span class=\"line\">      path.<span class=\"title function_\">relative</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">rootContext</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">resourcePath</span>)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// ä¸Šé¢é‚£ä¸€å¨å…ˆä¸ç”¨çœ‹ï¼Œå…³é”®æ˜¯è¿™ä¸ªemitFieæ–¹æ³•ï¼Œæ–‡æ¡£åœ¨è¿™é‡Œhttps://webpack.docschina.org/api/loaders/#thisemitfile</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">emitFile</span>(outputPath, content, <span class=\"literal\">null</span>, assetInfo);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    <span class=\"comment\">//æœ€åreturnäº†ä¸€ä¸ªè¿™æ ·çš„ç»“æœ module.exports = __webpack_public_path__ + &quot;c04dc325df0375584b1fcd56895e3c6f.png&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> esModule =</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> options.<span class=\"property\">esModule</span> !== <span class=\"string\">&#x27;undefined&#x27;</span> ? options.<span class=\"property\">esModule</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;esModule ? <span class=\"string\">&#x27;export default&#x27;</span> : <span class=\"string\">&#x27;module.exports =&#x27;</span>&#125;</span> <span class=\"subst\">$&#123;publicPath&#125;</span>;`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç”±äºè¿™ä¸ªä¾‹å­çš„optionsæ˜¯ç©ºï¼Œæ‰€ä»¥çœç•¥äº†å¾ˆå¤šä»£ç ï¼Œè¿™æ˜¯çœç•¥åçš„file-loader</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> options = <span class=\"title function_\">getOptions</span>(<span class=\"variable language_\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">validate</span>(schema, options, &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;File Loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">baseDataPath</span>: <span class=\"string\">&#x27;options&#x27;</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> context = options.<span class=\"property\">context</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">rootContext</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> name = options.<span class=\"property\">name</span> || <span class=\"string\">&#x27;[contenthash].[ext]&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"title function_\">interpolateName</span>(<span class=\"variable language_\">this</span>, name, &#123;</span><br><span class=\"line\">    context,</span><br><span class=\"line\">    content,</span><br><span class=\"line\">    <span class=\"attr\">regExp</span>: options.<span class=\"property\">regExp</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">let</span> outputPath = url;</span><br><span class=\"line\"><span class=\"keyword\">let</span> publicPath = <span class=\"string\">`__webpack_public_path__ + <span class=\"subst\">$&#123;<span class=\"built_in\">JSON</span>.stringify(outputPath)&#125;</span>`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"title function_\">emitFile</span>(outputPath, content, <span class=\"literal\">null</span>, assetInfo);</span><br><span class=\"line\"><span class=\"keyword\">const</span> esModule =</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> options.<span class=\"property\">esModule</span> !== <span class=\"string\">&#x27;undefined&#x27;</span> ? options.<span class=\"property\">esModule</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;esModule ? <span class=\"string\">&#x27;export default&#x27;</span> : <span class=\"string\">&#x27;module.exports =&#x27;</span>&#125;</span> <span class=\"subst\">$&#123;publicPath&#125;</span>;`</span>;</span><br></pre></td></tr></table></figure>\n<p>è¿™å‡ è¡Œä»£ç ä½“ç°é™¤äº†file-loaderéƒ½å¹²äº†äº›ä»€ä¹ˆï¼Œå…¶å®å…³é”®ç‚¹å°±ä¸¤æ­¥ï¼Œé¦–å…ˆé€šè¿‡interpolateNameç¼–è¯‘nameï¼Œç„¶åé€šè¿‡this.emitFileæŠŠåŸå§‹èµ„æºcopyåˆ°distï¼Œé¡ºä¾¿æŠŠåå­—æ”¹æˆç¼–è¯‘åçš„nameï¼Œå®Œäº†ã€‚</p>\n<p>æ¥ä¸‹æ¥çœ‹<a href=\"https://github.com/webpack-contrib/url-loader/blob/master/src/index.js\">url-loader</a> è¿™ä¸ªä»£ç æ›´ç®€ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">loader</span>(<span class=\"params\">content</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Loader Options</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> options = <span class=\"title function_\">getOptions</span>(<span class=\"variable language_\">this</span>) || &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">validate</span>(schema, options, &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;URL Loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">baseDataPath</span>: <span class=\"string\">&#x27;options&#x27;</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// No limit or within the specified limit</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"title function_\">shouldTransform</span>(options.<span class=\"property\">limit</span>, content.<span class=\"property\">length</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; resourcePath &#125; = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> mimetype = <span class=\"title function_\">getMimetype</span>(options.<span class=\"property\">mimetype</span>, resourcePath);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> encoding = <span class=\"title function_\">getEncoding</span>(options.<span class=\"property\">encoding</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> content === <span class=\"string\">&#x27;string&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// eslint-disable-next-line no-param-reassign</span></span><br><span class=\"line\">      content = <span class=\"title class_\">Buffer</span>.<span class=\"title function_\">from</span>(content);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> encodedData = <span class=\"title function_\">getEncodedData</span>(</span><br><span class=\"line\">      options.<span class=\"property\">generator</span>,</span><br><span class=\"line\">      mimetype,</span><br><span class=\"line\">      encoding,</span><br><span class=\"line\">      content,</span><br><span class=\"line\">      resourcePath</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> esModule =</span><br><span class=\"line\">      <span class=\"keyword\">typeof</span> options.<span class=\"property\">esModule</span> !== <span class=\"string\">&#x27;undefined&#x27;</span> ? options.<span class=\"property\">esModule</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">      esModule ? <span class=\"string\">&#x27;export default&#x27;</span> : <span class=\"string\">&#x27;module.exports =&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">    &#125;</span> <span class=\"subst\">$&#123;<span class=\"built_in\">JSON</span>.stringify(encodedData)&#125;</span>`</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Normalize the fallback.</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">loader</span>: fallbackLoader,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: fallbackOptions,</span><br><span class=\"line\">  &#125; = <span class=\"title function_\">normalizeFallback</span>(options.<span class=\"property\">fallback</span>, options);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Require the fallback.</span></span><br><span class=\"line\">  <span class=\"comment\">// eslint-disable-next-line global-require, import/no-dynamic-require</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> fallback = <span class=\"built_in\">require</span>(fallbackLoader);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Call the fallback, passing a copy of the loader context. The copy has the query replaced. This way, the fallback</span></span><br><span class=\"line\">  <span class=\"comment\">// loader receives the query which was intended for it instead of the query which was intended for url-loader.</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> fallbackLoaderContext = <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(&#123;&#125;, <span class=\"variable language_\">this</span>, &#123;</span><br><span class=\"line\">    <span class=\"attr\">query</span>: fallbackOptions,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> fallback.<span class=\"title function_\">call</span>(fallbackLoaderContext, content);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢é‚£ä¸€å¤§å †ï¼Œå…³é”®æ­¥éª¤è¿˜æ˜¯ä¸¤ç‚¹ï¼Œä¸€ä¸ªæ˜¯shouldTransformï¼Œä¸€ä¸ªæ˜¯normalizeFallbackã€‚</p>\n<p>shouldTransformï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯å¦æŠŠæ–‡ä»¶è½¬æˆbase64ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">shouldTransform</span>(<span class=\"params\">limit, size</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> limit === <span class=\"string\">&#x27;boolean&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> limit;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> limit === <span class=\"string\">&#x27;string&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> size &lt;= <span class=\"built_in\">parseInt</span>(limit, <span class=\"number\">10</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> limit === <span class=\"string\">&#x27;number&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> size &lt;= limit;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»ä»£ç æ¥çœ‹ï¼Œlimitå¯ä»¥ç›´æ¥æ˜¯true&#x2F;falseï¼Œæˆ–è€…æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ä¼šè°ƒparseIntè½¬æˆæ•°å­—ï¼Œé€»è¾‘éƒ½ä¸€æ · size &lt;&#x3D; limitã€‚</p>\n<p>å¦‚æœæ»¡è¶³shouldTransformï¼Œä¼šè°ƒç”¨getEncodedDataæŠŠæ–‡ä»¶è½¬æˆbase64ã€‚</p>\n<p>æ¥ä¸‹æ¥æ˜¯normalizeFallback</p>\n<p><a href=\"https://github.com/webpack-contrib/url-loader/blob/master/src/utils/normalizeFallback.js#L3\">normalizeFallback</a> çœ‹åˆ°æ²¡æœ‰å‡½æ•°å†…ç¬¬ä¸€è¡Œlet loader &#x3D; â€˜file-loaderâ€™;<br>å†å›åˆ°url-loader</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">const</span> fallback = <span class=\"built_in\">require</span>(fallbackLoader); <span class=\"comment\">//è¿™é‡Œçš„fallbackå°±æ˜¯file-loader</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Call the fallback, passing a copy of the loader context. The copy has the query replaced. This way, the fallback</span></span><br><span class=\"line\"><span class=\"comment\">// loader receives the query which was intended for it instead of the query which was intended for url-loader.</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fallbackLoaderContext = <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(&#123;&#125;, <span class=\"variable language_\">this</span>, &#123;</span><br><span class=\"line\">    <span class=\"attr\">query</span>: fallbackOptions,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> fallback.<span class=\"title function_\">call</span>(fallbackLoaderContext, content); <span class=\"comment\">//æœ€åæ‰§è¡Œfile-loader</span></span><br></pre></td></tr></table></figure>\n<p>å®Œäº†ï¼Œæ‰€ä»¥è¿™ä¿©çš„åŒºåˆ«å°±æ˜¯url-loaderå†…éƒ¨ä¼šæ ¹æ®limitçš„å€¼å†³å®šç›´æ¥æŠŠæ–‡ä»¶è½¬æˆbase64è¿˜æ˜¯ç›´æ¥è°ƒç”¨file-loaderã€‚</p>\n<h1 id=\"sass-loaderã€css-loaderã€style-loader\"><a href=\"#sass-loaderã€css-loaderã€style-loader\" class=\"headerlink\" title=\"sass-loaderã€css-loaderã€style-loader\"></a>sass-loaderã€css-loaderã€style-loader</h1><h2 id=\"sass-loader\"><a href=\"#sass-loader\" class=\"headerlink\" title=\"sass-loader\"></a>sass-loader</h2><p><a href=\"https://github.com/webpack-contrib/sass-loader/blob/v13.2.2/src/index.js#L22\">æºç </a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">loader</span>(<span class=\"params\">content</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> options = <span class=\"variable language_\">this</span>.<span class=\"title function_\">getOptions</span>(schema); <span class=\"comment\">//è·å–ä½¿ç”¨sass-loaderæ—¶ä¼ å…¥çš„optionsï¼Œè¿™é‡Œä¸ºç©º</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> callback = <span class=\"variable language_\">this</span>.<span class=\"title function_\">async</span>(); <span class=\"comment\">//è¿™ä¸ªasyncå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„å‡½æ•°callbackï¼Œæ‰§è¡Œè¿™ä¸ªcallbackä¼šæŠŠå½“å‰loaderçš„ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªloaderã€‚è¿™é‡Œsass-loaderä¸æ˜¯æœ€ç»ˆçš„loaderï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸ªã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> implementation = <span class=\"title function_\">getSassImplementation</span>(<span class=\"variable language_\">this</span>, options.<span class=\"property\">implementation</span>);</span><br><span class=\"line\">    <span class=\"comment\">// è·å–sassè§£æå™¨ï¼Œå¯ä»¥æ˜¯node-sassã€dart-sassæˆ–è€…sass-embedded</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!implementation) &#123; <span class=\"comment\">// å¦‚æœè·å–ä¸åˆ°sassè§£æå™¨ï¼Œç›´æ¥è¿”å›ï¼Œå¹¶ä¸”ç»™ä¸‹ä¸€ä¸ªloader callbackä¸€ä¸ªç©º</span></span><br><span class=\"line\">        <span class=\"title function_\">callback</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> useSourceMap =</span><br><span class=\"line\">        <span class=\"keyword\">typeof</span> options.<span class=\"property\">sourceMap</span> === <span class=\"string\">&quot;boolean&quot;</span> ? options.<span class=\"property\">sourceMap</span> : <span class=\"variable language_\">this</span>.<span class=\"property\">sourceMap</span>; <span class=\"comment\">// æ˜¯å¦å¯ç”¨sourceMapï¼Œè¿™é‡Œæ˜¯true</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> sassOptions = <span class=\"keyword\">await</span> <span class=\"title function_\">getSassOptions</span>( </span><br><span class=\"line\">        <span class=\"variable language_\">this</span>,</span><br><span class=\"line\">        options,</span><br><span class=\"line\">        content,</span><br><span class=\"line\">        implementation,</span><br><span class=\"line\">        useSourceMap</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"keyword\">const</span> shouldUseWebpackImporter =</span><br><span class=\"line\">        <span class=\"keyword\">typeof</span> options.<span class=\"property\">webpackImporter</span> === <span class=\"string\">&quot;boolean&quot;</span></span><br><span class=\"line\">            ? options.<span class=\"property\">webpackImporter</span></span><br><span class=\"line\">            : <span class=\"literal\">true</span>;  <span class=\"comment\">//è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨webpackè§£ææºç é‡Œé¢çš„@importï¼Œè¿™é‡Œçš„å€¼æ˜¯true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (shouldUseWebpackImporter) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> isModernAPI = options.<span class=\"property\">api</span> === <span class=\"string\">&quot;modern&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!isModernAPI) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123; includePaths &#125; = sassOptions;</span><br><span class=\"line\"></span><br><span class=\"line\">            sassOptions.<span class=\"property\">importer</span>.<span class=\"title function_\">push</span>(</span><br><span class=\"line\">                <span class=\"title function_\">getWebpackImporter</span>(<span class=\"variable language_\">this</span>, implementation, includePaths)</span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            sassOptions.<span class=\"property\">importers</span>.<span class=\"title function_\">push</span>(</span><br><span class=\"line\">                <span class=\"title function_\">getModernWebpackImporter</span>(<span class=\"variable language_\">this</span>, implementation)</span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    <span class=\"comment\">// ä¸Šé¢çš„ä»£ç ç»†èŠ‚ä¸æ¸…æ¥šï¼Œæ€»çš„æ¥è¯´ï¼Œé€šè¿‡options.apiåˆ¤æ–­æ˜¯å¦æ˜¯æ–°ç‰ˆwebpackï¼Œæ–°æ—§ç‰ˆæœ¬webpackå¤„ç†@importæ–¹æ³•ä¸ä¸€æ ·</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> compile = <span class=\"title function_\">getCompileFn</span>(implementation, options); <span class=\"comment\">//é€šè¿‡ä¸Šé¢çš„implementationè·å–sassç¼–è¯‘å™¨</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = <span class=\"keyword\">await</span> <span class=\"title function_\">compile</span>(sassOptions, options) <span class=\"comment\">// ç¼–è¯‘sassï¼Œè¿™é‡Œå‡è®¾ç¼–è¯‘æ²¡æœ‰é”™è¯¯ï¼Œæ‰€ä»¥çœç•¥äº†å¤„ç†é”™è¯¯çš„ä»£ç </span></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> map =</span><br><span class=\"line\">        <span class=\"comment\">// Modern API, then legacy API</span></span><br><span class=\"line\">        result.<span class=\"property\">sourceMap</span></span><br><span class=\"line\">            ? result.<span class=\"property\">sourceMap</span></span><br><span class=\"line\">            : result.<span class=\"property\">map</span></span><br><span class=\"line\">                ? <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(result.<span class=\"property\">map</span>)</span><br><span class=\"line\">                : <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Modify source paths only for webpack, otherwise we do nothing</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (map &amp;&amp; useSourceMap) &#123;</span><br><span class=\"line\">        map = <span class=\"title function_\">normalizeSourceMap</span>(map, <span class=\"variable language_\">this</span>.<span class=\"property\">rootContext</span>);</span><br><span class=\"line\">    &#125; <span class=\"comment\">// è¿™é‡Œç”Ÿæˆçš„mapï¼Œæœ€åä¼šé€šè¿‡callbackä¼ ç»™ä¸‹ä¸€ä¸ªloaderï¼Œè¿™é‡Œä¸å…³å¿ƒsourceMapï¼Œç•¥</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Modern API</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> result.<span class=\"property\">loadedUrls</span> !== <span class=\"string\">&quot;undefined&quot;</span>) &#123;</span><br><span class=\"line\">        result.<span class=\"property\">loadedUrls</span></span><br><span class=\"line\">            .<span class=\"title function_\">filter</span>(<span class=\"function\">(<span class=\"params\">url</span>) =&gt;</span> url.<span class=\"property\">protocol</span> === <span class=\"string\">&quot;file:&quot;</span>)</span><br><span class=\"line\">            .<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">includedFile</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> normalizedIncludedFile = url.<span class=\"title function_\">fileURLToPath</span>(includedFile);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// Custom `importer` can return only `contents` so includedFile will be relative</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (path.<span class=\"title function_\">isAbsolute</span>(normalizedIncludedFile)) &#123;</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"title function_\">addDependency</span>(normalizedIncludedFile);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// Legacy API</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        <span class=\"keyword\">typeof</span> result.<span class=\"property\">stats</span> !== <span class=\"string\">&quot;undefined&quot;</span> &amp;&amp;</span><br><span class=\"line\">        <span class=\"keyword\">typeof</span> result.<span class=\"property\">stats</span>.<span class=\"property\">includedFiles</span> !== <span class=\"string\">&quot;undefined&quot;</span></span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">        result.<span class=\"property\">stats</span>.<span class=\"property\">includedFiles</span>.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">includedFile</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> normalizedIncludedFile = path.<span class=\"title function_\">normalize</span>(includedFile);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Custom `importer` can return only `contents` so includedFile will be relative</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (path.<span class=\"title function_\">isAbsolute</span>(normalizedIncludedFile)) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">addDependency</span>(normalizedIncludedFile);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ä¸Šé¢è¿™ä¸€å †ï¼Œç»†èŠ‚ä¸æ¸…æ¥šï¼Œæ€»çš„æ¥è¯´ï¼Œæ˜¯å¤„ç†sassæ–‡ä»¶é‡Œçš„å¼•å…¥çš„æœ¬åœ°æ–‡ä»¶ï¼ŒæŠŠå®ƒä»¬åŠ å…¥webpackçš„ä¾èµ–ä¸­ï¼Œä»¥ä¾¿åœ¨å®ƒä»¬å˜åŒ–æ—¶é‡æ–°ç¼–è¯‘sassæ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">callback</span>(<span class=\"literal\">null</span>, result.<span class=\"property\">css</span>.<span class=\"title function_\">toString</span>(), map);</span><br><span class=\"line\">    <span class=\"comment\">// æœ€åæŠŠç¼–è¯‘å¥½çš„cssä¼ é€’ç»™ä¸‹ä¸€ä¸ªloader</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ‰€æœ‰ï¼Œç®€å•è¯´ï¼Œå¦‚æœå¿½ç•¥å¤„ç†@importä¸source-mapçš„é€»è¾‘ï¼Œsass-loaderæ‰€åšçš„äº‹ï¼Œå°±æ˜¯å…ˆé€‰æ‹©åˆé€‚çš„sassè§£æå™¨ï¼Œç„¶åç¼–è¯‘sassæ–‡ä»¶æŠŠç»“æœä¼ ç»™ä¸‹ä¸€ä¸ªloaderã€‚</p>\n<h2 id=\"css-loader\"><a href=\"#css-loader\" class=\"headerlink\" title=\"css-loader\"></a>css-loader</h2><p><a href=\"https://github.com/webpack-contrib/css-loader/blob/v6.7.3/src/index.js#L33\">æºç </a></p>\n<p>è¿™ä¸ªloaderé¦–å…ˆä¼šæœ‰ä¸€å †å¤„ç†pluginçš„é€»è¾‘ï¼Œæˆ‘ä»¬è¿™é‡Œä¸å…³æ³¨pluginï¼Œç›´æ¥ä»<a href=\"https://github.com/webpack-contrib/css-loader/blob/v6.7.3/src/index.js#L155\">155</a> è¡Œå¼€å§‹çœ‹ã€‚<br> å½“ç„¶ï¼Œ155è¡Œè¿™é‡Œçš„pluginéç©º,å› ä¸º40è¡Œä¼šè°ƒç”¨normalizeOptionsé‡æ–°ç”Ÿæˆoptionsï¼Œè¿™é‡Œç”±äºæˆ‘ä»¬åˆšå¼€å§‹çš„rawOptionsæ˜¯ç©ºï¼Œè¿™é‡Œé‡æ–°ç”Ÿæˆçš„optionsé•¿è¿™æ ·: </p>\n<p><img src=\"https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/2854f00e-4d2a-4e0d-b0b6-85f0d91cafad-%E5%9B%BE%E7%89%87.png\" alt=\"2854f00e-4d2a-4e0d-b0b6-85f0d91cafad-å›¾ç‰‡.png\"></p>\n<p>ç”±äºoptions.urlä¸options.importæ˜¯trueï¼Œæ‰€ä»¥155è¡Œçš„pluginæ˜¯ä¸ªé•¿åº¦ä¸º2çš„æ•°ç»„ï¼Œè¿™é‡Œä¼šè°ƒç”¨postcsså¤„ç†è¿™ä¸ªpluginï¼Œä¸»è¦å¤„ç†cssæ–‡ä»¶é‡Œçš„@importä¸urlç›¸å…³ã€‚</p>\n<p>è¿™é‡Œå‡è®¾æ²¡æœ‰é”™è¯¯ï¼Œä¹Ÿæ²¡æœ‰warningï¼Œå‰©ä¸‹çš„é‚£ä¸€å †ä»£ç ç»†èŠ‚å…ˆä¸ç®¡ï¼Œç›´æ¥è·³åˆ°æœ€åä¸€è¡Œï¼Œæœ€åä¸€è¡Œcallbackäº†ä¸€ä¸ªç»è¿‡æ‹¼æ¥çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå­—ç¬¦ä¸²logå‡ºæ¥:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Imports</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ <span class=\"keyword\">from</span> <span class=\"string\">&quot;./loaders/css-loader/runtime/noSourceMaps.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ___CSS_LOADER_API_IMPORT___ <span class=\"keyword\">from</span> <span class=\"string\">&quot;./loaders/css-loader/runtime/api.js&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> ___CSS_LOADER_EXPORT___ = <span class=\"title function_\">___CSS_LOADER_API_IMPORT___</span>(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);</span><br><span class=\"line\"><span class=\"comment\">// Module</span></span><br><span class=\"line\">___CSS_LOADER_EXPORT___.<span class=\"title function_\">push</span>([<span class=\"variable language_\">module</span>.<span class=\"property\">id</span>, <span class=\"string\">&quot;.container &#123;\\n  max-width: 960px;\\n  margin: 0 auto;\\n  padding: 20px;\\n  background-color: #fff;\\n  border-radius: 4px;\\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); &#125;\\n  .container h1 &#123;\\n    color: #007bff;\\n    font-size: 36px;\\n    text-align: center; &#125;\\n&quot;</span>, <span class=\"string\">&quot;&quot;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Exports</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> ___CSS_LOADER_EXPORT___;</span><br></pre></td></tr></table></figure>\n<p>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œcss-loaderæŠŠcssè½¬æ¢æˆäº†å¯è¿è¡Œçš„jsï¼Œè½¬æ¢åçš„cssåˆ™é€šè¿‡å­—ç¬¦ä¸²çš„å½¢å¼æ”¾åœ¨___CSS_LOADER_EXPORT___è¿™ä¸ªå˜é‡ä¸Šï¼Œæœ€åå¯¼å‡º___CSS_LOADER_EXPORT___ã€‚</p>\n<p>è¿™ä¸ªæ–‡ä»¶ç«™åœ¨ä½¿ç”¨è€…çš„è§’åº¦ä¸Šæ¥çœ‹æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œcsså˜›ï¼Œè¦ä¹ˆé€šè¿‡linkæ ‡ç­¾å¼•å…¥ï¼Œè¦ä¹ˆé€šè¿‡styleæ’å…¥åˆ°headé‡Œã€‚å¦‚æœæ˜¯å‰è€…ï¼Œloaderæ˜¯åšä¸åˆ°äº†ï¼Œå› ä¸ºloaderçš„ä½œç”¨ä»…ä»…æ˜¯æŠŠå„ç§æ–‡ä»¶è½¬æ¢æˆå¯è¿è¡Œçš„jsï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”¨mini-css-extract-pluginï¼Œè¿™ä¸ªæ’ä»¶ä¼šåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­æ‹¿åˆ°cssæ–‡ä»¶çš„è·¯å¾„ï¼Œç„¶ååœ¨æ‰“åŒ…ç»“æŸé€šè¿‡linkæ ‡ç­¾æŠŠcssæ’å…¥htmlï¼Œéœ€è¦é…åˆhtmlwebpackpluginä½¿ç”¨ã€‚å¦‚æœæ˜¯åè€…ï¼Œå¯ä»¥ä½¿ç”¨style-loaderã€‚</p>\n<h2 id=\"style-loader\"><a href=\"#style-loader\" class=\"headerlink\" title=\"style-loader\"></a>style-loader</h2><p><a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/index.js#L28\">æºç </a></p>\n<p>è¿™ä¸ªloaderçš„å…¥å£æ˜¯ä¸€ä¸ªpitchå‡½æ•°ï¼Œæˆ‘ä»¬çŸ¥é“webpack loaderæ˜¯ä»å³å¾€å·¦æ‰§è¡Œçš„</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">rules</span>:[</span><br><span class=\"line\">     &#123;</span><br><span class=\"line\">        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.scss$/</span>,</span><br><span class=\"line\">        <span class=\"attr\">use</span>:[<span class=\"string\">&#x27;style-loader&#x27;</span>,<span class=\"string\">&#x27;css-loader&#x27;</span>,<span class=\"string\">&#x27;sass-loader&#x27;</span>]</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å‡å¦‚ä½ çš„webpacké…ç½®é•¿è¿™æ ·ï¼Œå¦‚æœæ²¡æœ‰pitchå‡½æ•°ï¼Œåº”è¯¥ä»å³å¾€å·¦ï¼Œå³sass-loader css-loader style-loaderï¼Œå¦‚æœä¸‰ä¸ªloaderéƒ½æœ‰pitchå‡½æ•°ï¼Œæ‰§è¡Œé¡ºåºå˜æˆè¿™æ ·ï¼Œstyle-loader-pitch css-loader-pitch sass-loader-pitch sass-loader css-loader style-loaderï¼Œå¦‚æœåœ¨è¿™æ¡ä»£ç é“¾çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰æŸä¸€ä¸ªloaderçš„pitchè¿”å›äº†ä¸€ä¸ªå€¼ï¼Œåé¢loaderçš„ä»£ç å°±ä¸æ‰§è¡Œäº†ã€‚</p>\n<p>å›åˆ°çœŸå®æƒ…å†µï¼Œè¿™é‡Œçš„style-loader-pitchè¿”å›äº†å€¼ï¼Œæ‰€ä»¥åªä¼šæ‰§è¡Œstyle-loader-pitchä¸style-loaderã€‚</p>\n<p>è¿™ä¸ªpitchå‡½æ•°å¤§å¤šæ•°é€»è¾‘æˆ‘ä»¬å¹¶ä¸éœ€è¦å…³æ³¨ï¼Œæˆ‘ä»…ä»…æƒ³çŸ¥é“å®ƒæ˜¯å¦‚ä½•æŠŠcssæ’å…¥domçš„ï¼ˆæˆ‘å¾ˆæ‡’ï¼‰ã€‚æ‰€ä»¥åªéœ€è¦å…³æ³¨è¿™ä¸ªloaderæœ€åè¿”å›äº†ä»€ä¹ˆä¸œè¥¿ï¼Œä¸‹é¢æ˜¯æˆ‘é€šè¿‡debuggeræå–å‡ºæ¥syle-loaderæœ€åç”Ÿæˆçš„ä¸œè¥¿ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"variable constant_\">API</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/injectStylesIntoStyleTag.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> domAPI <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/styleDomAPI.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> insertFn <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/insertBySelector.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> setAttributes <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/setAttributesWithoutAttributes.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> insertStyleElement <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/insertStyleElement.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> styleTagTransformFn <span class=\"keyword\">from</span> <span class=\"string\">&quot;!./loaders/style-loader/runtime/styleTagTransform.js&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> content, * <span class=\"keyword\">as</span> namedExport <span class=\"keyword\">from</span> <span class=\"string\">&quot;!!./loaders/css-loader/index.js!./loaders/sass-loader/index.js!./style.scss&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> options = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">options.<span class=\"property\">styleTagTransform</span> = styleTagTransformFn;</span><br><span class=\"line\">options.<span class=\"property\">setAttributes</span> = setAttributes;</span><br><span class=\"line\"></span><br><span class=\"line\">options.<span class=\"property\">insert</span> = insertFn.<span class=\"title function_\">bind</span>(<span class=\"literal\">null</span>, <span class=\"string\">&quot;head&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">options.<span class=\"property\">domAPI</span> = domAPI;</span><br><span class=\"line\">options.<span class=\"property\">insertStyleElement</span> = insertStyleElement;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> update = <span class=\"title function_\">API</span>(content, options);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable language_\">module</span>.<span class=\"property\">hot</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!content.<span class=\"property\">locals</span> || <span class=\"variable language_\">module</span>.<span class=\"property\">hot</span>.<span class=\"property\">invalidate</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isEqualLocals = <span class=\"keyword\">function</span> <span class=\"title function_\">isEqualLocals</span>(<span class=\"params\">a, b, isNamedExport</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!a &amp;&amp; b || a &amp;&amp; !b) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> p;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (p <span class=\"keyword\">in</span> a) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isNamedExport &amp;&amp; p === <span class=\"string\">&quot;default&quot;</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// eslint-disable-next-line no-continue</span></span><br><span class=\"line\">          <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (a[p] !== b[p]) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (p <span class=\"keyword\">in</span> b) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isNamedExport &amp;&amp; p === <span class=\"string\">&quot;default&quot;</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// eslint-disable-next-line no-continue</span></span><br><span class=\"line\">          <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!a[p]) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isNamedExport = !content.<span class=\"property\">locals</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> oldLocals = isNamedExport ? namedExport : content.<span class=\"property\">locals</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">module</span>.<span class=\"property\">hot</span>.<span class=\"title function_\">accept</span>(</span><br><span class=\"line\">      <span class=\"string\">&quot;!!./loaders/css-loader/index.js!./loaders/sass-loader/index.js!./style.scss&quot;</span>,</span><br><span class=\"line\">      <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_\">isEqualLocals</span>(oldLocals, isNamedExport ? namedExport : content.<span class=\"property\">locals</span>, isNamedExport)) &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">module</span>.<span class=\"property\">hot</span>.<span class=\"title function_\">invalidate</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        oldLocals = isNamedExport ? namedExport : content.<span class=\"property\">locals</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">update</span>(content);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">module</span>.<span class=\"property\">hot</span>.<span class=\"title function_\">dispose</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">update</span>();</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> * <span class=\"keyword\">from</span> <span class=\"string\">&quot;!!./loaders/css-loader/index.js!./loaders/sass-loader/index.js!./style.scss&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> content &amp;&amp; content.<span class=\"property\">locals</span> ? content.<span class=\"property\">locals</span> : <span class=\"literal\">undefined</span>;</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸€æ®µä»£ç ä¼šåœ¨æµè§ˆå™¨é‡Œæ‰§è¡Œï¼Œä¸»è¦æ˜¯è¿™ä¸€å¥</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> update = <span class=\"title function_\">API</span>(content, options);</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œçš„APIæ¥è‡ª<a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/runtime/injectStylesIntoStyleTag.js#L84\">è¿™é‡Œ</a> ,æ‰§è¡ŒAPIçš„è¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨<a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/runtime/injectStylesIntoStyleTag.js#L16\">modulesToDom</a> ,æ¥ç€æ˜¯<a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/runtime/injectStylesIntoStyleTag.js#L41\">addElementStyle</a> ,è¿™ä¸ªå‡½æ•°çš„å‰ä¸¤å¥å®Œæˆäº†æŠŠcssé€šè¿‡styleæ ‡ç­¾æ’å…¥åˆ°domä¸­çš„ä»»åŠ¡ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">addElementStyle</span>(<span class=\"params\">obj, options</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">     <span class=\"keyword\">const</span> api = options.<span class=\"title function_\">domAPI</span>(options);</span><br><span class=\"line\">     api.<span class=\"title function_\">update</span>(obj);</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œçš„domAPIæ¥è‡ª<a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/runtime/styleDomAPI.js#L56\">è¿™å„¿</a> ,é¦–å…ˆé€šè¿‡options.insertStyleElementç”ŸæˆstyleElementï¼ˆè¿™é‡Œä¼šç”Ÿæˆä¸€ä¸ªç©ºçš„styleæ ‡ç­¾ï¼‰ï¼Œç„¶ååœ¨updateå‡½æ•°å†…éƒ¨è°ƒç”¨äº†applyå‡½æ•°ï¼Œapplyå‡½æ•°é¦–å…ˆé€šè¿‡ä¸€ç³»åˆ—æ¡ä»¶å¯¹ä¼ è¿›æ¥çš„cssè¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿™é‡Œä¸æ˜¯é‡ç‚¹ï¼Œå…³é”®æ˜¯æœ€å: </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">options.<span class=\"title function_\">styleTagTransform</span>(css, styleElement, options.<span class=\"property\">options</span>);</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/webpack-contrib/style-loader/blob/v3.3.2/src/runtime/styleTagTransform.js\">styleTagTransform</a></p>\n<p>ä»£ç å¾ˆç®€å•ï¼Œæˆ‘ä»¬è¿™é‡Œåªä¼šå‘½ä¸­&#96;&#96;styleElement.appendChild(document.createTextNode(css));&#96;è¿™ä¸€å¥ã€‚</p>\n<p>ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œstyle-loaderçš„pitchå‡½æ•°è¿”å›äº†å€¼ï¼Œåé¢çš„loaderä¸æ‰§è¡Œäº†ï¼Œé‚£æ˜¯æ€ä¹ˆæŠŠsassä»£ç è½¬æ¢æˆcssçš„ï¼Œæ³¨æ„çœ‹ä¸Šé¢style-loaderçš„è¿”å›å€¼é‡Œé¢æœ‰è¿™ä¹ˆä¸€å¥: </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> content, * <span class=\"keyword\">as</span> namedExport <span class=\"keyword\">from</span> <span class=\"string\">&quot;!!./loaders/css-loader/index.js!./loaders/sass-loader/index.js!./style.scss&quot;</span>;</span><br></pre></td></tr></table></figure>\n<p>webpackä¼šè§£æè¿™ä¸ªimportï¼ˆå¸¦æœ‰æ„Ÿå¹å·çš„ä¼šå¿½ç•¥ï¼‰ï¼Œç„¶ååœ¨importçš„è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œsass-loaderã€css-loaderã€‚</p>\n<h1 id=\"babel-loader\"><a href=\"#babel-loader\" class=\"headerlink\" title=\"babel-loader\"></a>babel-loader</h1><h1 id=\"vue-loader\"><a href=\"#vue-loader\" class=\"headerlink\" title=\"vue-loader\"></a>vue-loader</h1>","categories":[],"tags":[]}