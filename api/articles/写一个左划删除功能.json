{"title":"写一个左划删除功能","slug":"写一个左划删除功能","date":"2022-02-13T00:19:07.000Z","updated":"2023-05-12T10:28:06.837Z","comments":true,"path":"api/articles/写一个左划删除功能.json","excerpt":null,"covers":null,"content":"<p>需求是写一个小程序，用来实现一个app大部分功能。里面有个功能是列表的左划删除，可能app那边有现成的组件&#x2F;库可以用，小程序官方没有提供这样的组件，于是求助于google。</p>\n<p>搜到了<a href=\"https://segmentfault.com/a/1190000014831500\">这个</a> ,看起来挺好的，但是要求高度固定，我列表里面有图片，我无法确定图片的高度固定，跟相关人员沟通起来又是一堆废话，算是备选。</p>\n<p>然后找到了<a href=\"https://nutui.jd.com/#/swipe\">这个</a></p>\n<p>nutui的swipe组件，<a href=\"https://github.com/jdf2e/nutui/blob/6e63e992565ce404fbbe3a63d459794f141cb4a9/src/packages/__VUE/swipe/index.taro.vue\">源码</a> vue写的，我项目用的是react，不过没关系，vue3的Composition api与react hooks是师出同门。看懂它然后翻译一下(我又找到了一个适合自己的巨人)。</p>\n<h1 id=\"源码解读\"><a href=\"#源码解读\" class=\"headerlink\" title=\"源码解读\"></a>源码解读</h1><h2 id=\"布局\"><a href=\"#布局\" class=\"headerlink\" title=\"布局\"></a>布局</h2><p>html、css、js永远是一家人，不要看不起html、css，优秀的布局可以省好多代码。</p>\n<iframe src=\"https://codesandbox.io/embed/distracted-haibt-9sp3o?fontsize=14&hidenavigation=1&theme=light\" title=\"awesome-mestorf-nb8r2\" allow=\"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media\" style=\"width:100%; height:250px; border:0; border-radius: 4px; overflow:hidden;\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe>\n\n<p>布局分为3部分，content、left、right，content为列表的主要内容，left&#x2F;right分别表示向右&#x2F;左滑所展示的额外内容，然后left、right分别绝对定位，并且配合translate移出content的可见范围。</p>\n<h2 id=\"逻辑\"><a href=\"#逻辑\" class=\"headerlink\" title=\"逻辑\"></a>逻辑</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;view</span><br><span class=\"line\">    :class=&quot;classes&quot;</span><br><span class=\"line\">    :style=&quot;touchStyle&quot;</span><br><span class=\"line\">    @touchstart=&quot;onTouchStart&quot;</span><br><span class=\"line\">    @touchmove=&quot;onTouchMove&quot;</span><br><span class=\"line\">    @touchend=&quot;onTouchEnd&quot;</span><br><span class=\"line\">    @touchcancel=&quot;onTouchEnd&quot;</span><br><span class=\"line\">  &gt;</span><br><span class=\"line\">    &lt;view class=&quot;nut-swipe__left&quot; ref=&quot;leftRef&quot; :id=&quot;&#x27;leftRef-&#x27; + refRandomId&quot;&gt;</span><br><span class=\"line\">      &lt;slot name=&quot;left&quot;&gt;&lt;/slot&gt;</span><br><span class=\"line\">    &lt;/view&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;view class=&quot;nut-swipe__content&quot;&gt;</span><br><span class=\"line\">      &lt;slot name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class=\"line\">    &lt;/view&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;view class=&quot;nut-swipe__right&quot; ref=&quot;rightRef&quot; :id=&quot;&#x27;rightRef-&#x27; + refRandomId&quot;&gt;</span><br><span class=\"line\">      &lt;slot name=&quot;right&quot;&gt;&lt;/slot&gt;</span><br><span class=\"line\">    &lt;/view&gt;</span><br><span class=\"line\">  &lt;/view&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> touchStyle = <span class=\"title function_\">computed</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">transform</span>: <span class=\"string\">`translate3d(<span class=\"subst\">$&#123;state.offset&#125;</span>px, 0, 0)`</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>一目了然。有三个slot，分别对应上述布局中的content、left、right。监听了最外层view的touch事件，目的是根据touch时的各种值来控制offset的值，从而生成touchStyle，使最外层的view移动。</p>\n<p>那么如何得到touch事件的各种值呢，他们封装了个<a href=\"https://github.com/jdf2e/nutui/blob/6e63e992565ce404fbbe3a63d459794f141cb4a9/src/packages/utils/useTouch/index.ts\">useTouch</a> </p>\n<p>代码还是挺简的</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> startX = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>); <span class=\"comment\">//滑动起始x值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> startY = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);<span class=\"comment\">// 滑动起始y值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> deltaX = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);<span class=\"comment\">// 滑动的x值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> deltaY = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>); <span class=\"comment\">// 滑动的y值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> offsetX = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);<span class=\"comment\">// deltaX的绝对值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> offsetY = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>); <span class=\"comment\">// deltaY的绝对值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> direction = ref&lt;<span class=\"title class_\">Direction</span>&gt;(<span class=\"string\">&#x27;&#x27;</span>); <span class=\"comment\">// 滑动的方向</span></span><br></pre></td></tr></table></figure>\n<p>有三个函数，reset&#x2F;start&#x2F;move，start与move分别在touchStart与touchMove时调用，用来记录滑动的距离，调用start时会调用reset。</p>\n<p>值得一提的是，这里计算滑动方向的方法</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getDirection</span>(<span class=\"params\">x: <span class=\"built_in\">number</span>, y: <span class=\"built_in\">number</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (x &gt; y &amp;&amp; x &gt; <span class=\"variable constant_\">MIN_DISTANCE</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;horizontal&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (y &gt; x &amp;&amp; y &gt; <span class=\"variable constant_\">MIN_DISTANCE</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;vertical&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>是根据每次滑动offsetX与offsetY的大小以及滑动距离是否大于10决定的。</p>\n<p>再来看swipe组件处理滑动的逻辑</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">initWidth</span> = <span class=\"keyword\">async</span> (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">    leftRefWidth.<span class=\"property\">value</span> = <span class=\"keyword\">await</span> <span class=\"title function_\">getRefWidth</span>(leftRef);</span><br><span class=\"line\">    rightRefWidth.<span class=\"property\">value</span> = <span class=\"keyword\">await</span> <span class=\"title function_\">getRefWidth</span>(rightRef);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">initWidth</span>();</span><br><span class=\"line\">    &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>首先拿到left slot与right slot的宽度，如果没有，就是0。然后会监听touchstart、touchmove、touchend事件。</p>\n<p>touchstart</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">onTouchStart</span>(<span class=\"params\">event: Event</span>) &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (props.<span class=\"property\">disabled</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    touch.<span class=\"title function_\">start</span>(event);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>平淡无奇，核心是调用了touch.start方法。</p>\n<p>onTouchMove</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">onTouchMove</span>(<span class=\"params\">event: Event</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (props.<span class=\"property\">disabled</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    touch.<span class=\"title function_\">move</span>(event);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (touch.<span class=\"title function_\">isHorizontal</span>()) &#123;</span><br><span class=\"line\">      state.<span class=\"property\">moving</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      <span class=\"title function_\">setoffset</span>(touch.<span class=\"property\">deltaX</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (props.<span class=\"property\">touchMovePreventDefault</span>) &#123;</span><br><span class=\"line\">        event.<span class=\"title function_\">preventDefault</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (props.<span class=\"property\">touchMoveStopPropagation</span>) &#123;</span><br><span class=\"line\">        event.<span class=\"title function_\">stopPropagation</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>核心是调用touch.move以及setoffset方法。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setoffset</span> = (<span class=\"params\">deltaX: <span class=\"built_in\">number</span></span>) =&gt; &#123;</span><br><span class=\"line\">      position = deltaX &gt; <span class=\"number\">0</span> ? <span class=\"string\">&#x27;right&#x27;</span> : <span class=\"string\">&#x27;left&#x27;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> offset = deltaX;</span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (position) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;left&#x27;</span>:</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (opened &amp;&amp; oldPosition === position) &#123;</span><br><span class=\"line\">            offset = -rightRefWidth.<span class=\"property\">value</span>;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            offset = <span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(deltaX) &gt; rightRefWidth.<span class=\"property\">value</span> ? -rightRefWidth.<span class=\"property\">value</span> : deltaX;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;right&#x27;</span>:</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (opened &amp;&amp; oldPosition === position) &#123;</span><br><span class=\"line\">            offset = leftRefWidth.<span class=\"property\">value</span>;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            offset = <span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(deltaX) &gt; leftRefWidth.<span class=\"property\">value</span> ? leftRefWidth.<span class=\"property\">value</span> : deltaX;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      state.<span class=\"property\">offset</span> = offset;</span><br><span class=\"line\">    &#125;;</span><br></pre></td></tr></table></figure>\n<p>这几行if else写的很精妙。swipe组件同时支持左&#x2F;右滑，先来看左划的逻辑。</p>\n<p>opened表示是否已经打开，如果是true并且本次滑动方向与上一次一致，那么offset永远等于-rightRefWidth。</p>\n<p>假设是第一次滑，并且right slot不为空，走的是这句代码。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">offset = <span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(deltaX) &gt; rightRefWidth.<span class=\"property\">value</span> ? -rightRefWidth.<span class=\"property\">value</span> : deltaX;</span><br></pre></td></tr></table></figure>\n<p>精妙的三元表达式，无形中处理了很多边界情况，先看最正常的：第一次滑，并且right slot不为空。</p>\n<p>这时Math.abs(deltaX) &lt; rightRefWidth，所以offset为deltaX。</p>\n<p>那什么时候Math.abs(deltaX) &gt;&#x3D; rightRefWidth呢，要么right slot完全被划出，要么right slot 为空。假设right slot为空，这时再左滑是滑不动的。</p>\n<p>右滑同理。</p>\n<p>onTouchEnd</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">onTouchEnd</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (state.<span class=\"property\">moving</span>) &#123;</span><br><span class=\"line\">  state.<span class=\"property\">moving</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  oldPosition = position;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (position) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;left&#x27;</span>:</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(state.<span class=\"property\">offset</span>) &lt;= rightRefWidth.<span class=\"property\">value</span> / <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">close</span>();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        state.<span class=\"property\">offset</span> = -rightRefWidth.<span class=\"property\">value</span>;</span><br><span class=\"line\">        <span class=\"title function_\">open</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;right&#x27;</span>:</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(state.<span class=\"property\">offset</span>) &lt;= leftRefWidth.<span class=\"property\">value</span> / <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">close</span>();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        state.<span class=\"property\">offset</span> = leftRefWidth.<span class=\"property\">value</span>;</span><br><span class=\"line\">        <span class=\"title function_\">open</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个方法隐藏着一个小小的交互体验。假设onTouchEnd触发时，左滑的距离小于rightRefWidth的一半，会自动close，反之open。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">open</span> = (<span class=\"params\">p: SwipePosition = <span class=\"string\">&#x27;&#x27;</span></span>) =&gt; &#123;</span><br><span class=\"line\">     opened = <span class=\"literal\">true</span>;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (p) &#123;</span><br><span class=\"line\">       state.<span class=\"property\">offset</span> = p === <span class=\"string\">&#x27;left&#x27;</span> ? -rightRefWidth.<span class=\"property\">value</span> : leftRefWidth.<span class=\"property\">value</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"comment\">// emit(&#x27;open&#x27;, &#123;</span></span><br><span class=\"line\">     <span class=\"comment\">//   name: props.name,</span></span><br><span class=\"line\">     <span class=\"comment\">//   position: position || p</span></span><br><span class=\"line\">     <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">   &#125;;</span><br><span class=\"line\">   <span class=\"keyword\">const</span> <span class=\"title function_\">close</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">     state.<span class=\"property\">offset</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">     opened = <span class=\"literal\">false</span>;</span><br><span class=\"line\">     <span class=\"comment\">// emit(&#x27;close&#x27;, &#123;</span></span><br><span class=\"line\">     <span class=\"comment\">//   name: props.name,</span></span><br><span class=\"line\">     <span class=\"comment\">//   position</span></span><br><span class=\"line\">     <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">   &#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>open与close所做的事是分别让offset达到最大值或者最小值。</p>\n","more":"<p>需求是写一个小程序，用来实现一个app大部分功能。里面有个功能是列表的左划删除，可能app那边有现成的组件&#x2F;库可以用，小程序官方没有提供这样的组件，于是求助于google。</p>\n<p>搜到了<a href=\"https://segmentfault.com/a/1190000014831500\">这个</a> ,看起来挺好的，但是要求高度固定，我列表里面有图片，我无法确定图片的高度固定，跟相关人员沟通起来又是一堆废话，算是备选。</p>\n<p>然后找到了<a href=\"https://nutui.jd.com/#/swipe\">这个</a></p>\n<p>nutui的swipe组件，<a href=\"https://github.com/jdf2e/nutui/blob/6e63e992565ce404fbbe3a63d459794f141cb4a9/src/packages/__VUE/swipe/index.taro.vue\">源码</a> vue写的，我项目用的是react，不过没关系，vue3的Composition api与react hooks是师出同门。看懂它然后翻译一下(我又找到了一个适合自己的巨人)。</p>\n<h1 id=\"源码解读\"><a href=\"#源码解读\" class=\"headerlink\" title=\"源码解读\"></a>源码解读</h1><h2 id=\"布局\"><a href=\"#布局\" class=\"headerlink\" title=\"布局\"></a>布局</h2><p>html、css、js永远是一家人，不要看不起html、css，优秀的布局可以省好多代码。</p>\n<iframe src=\"https://codesandbox.io/embed/distracted-haibt-9sp3o?fontsize=14&hidenavigation=1&theme=light\" title=\"awesome-mestorf-nb8r2\" allow=\"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media\" style=\"width:100%; height:250px; border:0; border-radius: 4px; overflow:hidden;\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe>\n\n<p>布局分为3部分，content、left、right，content为列表的主要内容，left&#x2F;right分别表示向右&#x2F;左滑所展示的额外内容，然后left、right分别绝对定位，并且配合translate移出content的可见范围。</p>\n<h2 id=\"逻辑\"><a href=\"#逻辑\" class=\"headerlink\" title=\"逻辑\"></a>逻辑</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;view</span><br><span class=\"line\">    :class=&quot;classes&quot;</span><br><span class=\"line\">    :style=&quot;touchStyle&quot;</span><br><span class=\"line\">    @touchstart=&quot;onTouchStart&quot;</span><br><span class=\"line\">    @touchmove=&quot;onTouchMove&quot;</span><br><span class=\"line\">    @touchend=&quot;onTouchEnd&quot;</span><br><span class=\"line\">    @touchcancel=&quot;onTouchEnd&quot;</span><br><span class=\"line\">  &gt;</span><br><span class=\"line\">    &lt;view class=&quot;nut-swipe__left&quot; ref=&quot;leftRef&quot; :id=&quot;&#x27;leftRef-&#x27; + refRandomId&quot;&gt;</span><br><span class=\"line\">      &lt;slot name=&quot;left&quot;&gt;&lt;/slot&gt;</span><br><span class=\"line\">    &lt;/view&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;view class=&quot;nut-swipe__content&quot;&gt;</span><br><span class=\"line\">      &lt;slot name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class=\"line\">    &lt;/view&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;view class=&quot;nut-swipe__right&quot; ref=&quot;rightRef&quot; :id=&quot;&#x27;rightRef-&#x27; + refRandomId&quot;&gt;</span><br><span class=\"line\">      &lt;slot name=&quot;right&quot;&gt;&lt;/slot&gt;</span><br><span class=\"line\">    &lt;/view&gt;</span><br><span class=\"line\">  &lt;/view&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> touchStyle = <span class=\"title function_\">computed</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">transform</span>: <span class=\"string\">`translate3d(<span class=\"subst\">$&#123;state.offset&#125;</span>px, 0, 0)`</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>一目了然。有三个slot，分别对应上述布局中的content、left、right。监听了最外层view的touch事件，目的是根据touch时的各种值来控制offset的值，从而生成touchStyle，使最外层的view移动。</p>\n<p>那么如何得到touch事件的各种值呢，他们封装了个<a href=\"https://github.com/jdf2e/nutui/blob/6e63e992565ce404fbbe3a63d459794f141cb4a9/src/packages/utils/useTouch/index.ts\">useTouch</a> </p>\n<p>代码还是挺简的</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> startX = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>); <span class=\"comment\">//滑动起始x值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> startY = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);<span class=\"comment\">// 滑动起始y值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> deltaX = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);<span class=\"comment\">// 滑动的x值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> deltaY = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>); <span class=\"comment\">// 滑动的y值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> offsetX = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);<span class=\"comment\">// deltaX的绝对值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> offsetY = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>); <span class=\"comment\">// deltaY的绝对值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> direction = ref&lt;<span class=\"title class_\">Direction</span>&gt;(<span class=\"string\">&#x27;&#x27;</span>); <span class=\"comment\">// 滑动的方向</span></span><br></pre></td></tr></table></figure>\n<p>有三个函数，reset&#x2F;start&#x2F;move，start与move分别在touchStart与touchMove时调用，用来记录滑动的距离，调用start时会调用reset。</p>\n<p>值得一提的是，这里计算滑动方向的方法</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getDirection</span>(<span class=\"params\">x: <span class=\"built_in\">number</span>, y: <span class=\"built_in\">number</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (x &gt; y &amp;&amp; x &gt; <span class=\"variable constant_\">MIN_DISTANCE</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;horizontal&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (y &gt; x &amp;&amp; y &gt; <span class=\"variable constant_\">MIN_DISTANCE</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;vertical&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>是根据每次滑动offsetX与offsetY的大小以及滑动距离是否大于10决定的。</p>\n<p>再来看swipe组件处理滑动的逻辑</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">initWidth</span> = <span class=\"keyword\">async</span> (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">    leftRefWidth.<span class=\"property\">value</span> = <span class=\"keyword\">await</span> <span class=\"title function_\">getRefWidth</span>(leftRef);</span><br><span class=\"line\">    rightRefWidth.<span class=\"property\">value</span> = <span class=\"keyword\">await</span> <span class=\"title function_\">getRefWidth</span>(rightRef);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">initWidth</span>();</span><br><span class=\"line\">    &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>首先拿到left slot与right slot的宽度，如果没有，就是0。然后会监听touchstart、touchmove、touchend事件。</p>\n<p>touchstart</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">onTouchStart</span>(<span class=\"params\">event: Event</span>) &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (props.<span class=\"property\">disabled</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    touch.<span class=\"title function_\">start</span>(event);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>平淡无奇，核心是调用了touch.start方法。</p>\n<p>onTouchMove</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">onTouchMove</span>(<span class=\"params\">event: Event</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (props.<span class=\"property\">disabled</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    touch.<span class=\"title function_\">move</span>(event);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (touch.<span class=\"title function_\">isHorizontal</span>()) &#123;</span><br><span class=\"line\">      state.<span class=\"property\">moving</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      <span class=\"title function_\">setoffset</span>(touch.<span class=\"property\">deltaX</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (props.<span class=\"property\">touchMovePreventDefault</span>) &#123;</span><br><span class=\"line\">        event.<span class=\"title function_\">preventDefault</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (props.<span class=\"property\">touchMoveStopPropagation</span>) &#123;</span><br><span class=\"line\">        event.<span class=\"title function_\">stopPropagation</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>核心是调用touch.move以及setoffset方法。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setoffset</span> = (<span class=\"params\">deltaX: <span class=\"built_in\">number</span></span>) =&gt; &#123;</span><br><span class=\"line\">      position = deltaX &gt; <span class=\"number\">0</span> ? <span class=\"string\">&#x27;right&#x27;</span> : <span class=\"string\">&#x27;left&#x27;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> offset = deltaX;</span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (position) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;left&#x27;</span>:</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (opened &amp;&amp; oldPosition === position) &#123;</span><br><span class=\"line\">            offset = -rightRefWidth.<span class=\"property\">value</span>;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            offset = <span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(deltaX) &gt; rightRefWidth.<span class=\"property\">value</span> ? -rightRefWidth.<span class=\"property\">value</span> : deltaX;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;right&#x27;</span>:</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (opened &amp;&amp; oldPosition === position) &#123;</span><br><span class=\"line\">            offset = leftRefWidth.<span class=\"property\">value</span>;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            offset = <span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(deltaX) &gt; leftRefWidth.<span class=\"property\">value</span> ? leftRefWidth.<span class=\"property\">value</span> : deltaX;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      state.<span class=\"property\">offset</span> = offset;</span><br><span class=\"line\">    &#125;;</span><br></pre></td></tr></table></figure>\n<p>这几行if else写的很精妙。swipe组件同时支持左&#x2F;右滑，先来看左划的逻辑。</p>\n<p>opened表示是否已经打开，如果是true并且本次滑动方向与上一次一致，那么offset永远等于-rightRefWidth。</p>\n<p>假设是第一次滑，并且right slot不为空，走的是这句代码。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">offset = <span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(deltaX) &gt; rightRefWidth.<span class=\"property\">value</span> ? -rightRefWidth.<span class=\"property\">value</span> : deltaX;</span><br></pre></td></tr></table></figure>\n<p>精妙的三元表达式，无形中处理了很多边界情况，先看最正常的：第一次滑，并且right slot不为空。</p>\n<p>这时Math.abs(deltaX) &lt; rightRefWidth，所以offset为deltaX。</p>\n<p>那什么时候Math.abs(deltaX) &gt;&#x3D; rightRefWidth呢，要么right slot完全被划出，要么right slot 为空。假设right slot为空，这时再左滑是滑不动的。</p>\n<p>右滑同理。</p>\n<p>onTouchEnd</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">onTouchEnd</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (state.<span class=\"property\">moving</span>) &#123;</span><br><span class=\"line\">  state.<span class=\"property\">moving</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  oldPosition = position;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (position) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;left&#x27;</span>:</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(state.<span class=\"property\">offset</span>) &lt;= rightRefWidth.<span class=\"property\">value</span> / <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">close</span>();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        state.<span class=\"property\">offset</span> = -rightRefWidth.<span class=\"property\">value</span>;</span><br><span class=\"line\">        <span class=\"title function_\">open</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;right&#x27;</span>:</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(state.<span class=\"property\">offset</span>) &lt;= leftRefWidth.<span class=\"property\">value</span> / <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">close</span>();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        state.<span class=\"property\">offset</span> = leftRefWidth.<span class=\"property\">value</span>;</span><br><span class=\"line\">        <span class=\"title function_\">open</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个方法隐藏着一个小小的交互体验。假设onTouchEnd触发时，左滑的距离小于rightRefWidth的一半，会自动close，反之open。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">open</span> = (<span class=\"params\">p: SwipePosition = <span class=\"string\">&#x27;&#x27;</span></span>) =&gt; &#123;</span><br><span class=\"line\">     opened = <span class=\"literal\">true</span>;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (p) &#123;</span><br><span class=\"line\">       state.<span class=\"property\">offset</span> = p === <span class=\"string\">&#x27;left&#x27;</span> ? -rightRefWidth.<span class=\"property\">value</span> : leftRefWidth.<span class=\"property\">value</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"comment\">// emit(&#x27;open&#x27;, &#123;</span></span><br><span class=\"line\">     <span class=\"comment\">//   name: props.name,</span></span><br><span class=\"line\">     <span class=\"comment\">//   position: position || p</span></span><br><span class=\"line\">     <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">   &#125;;</span><br><span class=\"line\">   <span class=\"keyword\">const</span> <span class=\"title function_\">close</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">     state.<span class=\"property\">offset</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">     opened = <span class=\"literal\">false</span>;</span><br><span class=\"line\">     <span class=\"comment\">// emit(&#x27;close&#x27;, &#123;</span></span><br><span class=\"line\">     <span class=\"comment\">//   name: props.name,</span></span><br><span class=\"line\">     <span class=\"comment\">//   position</span></span><br><span class=\"line\">     <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">   &#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>open与close所做的事是分别让offset达到最大值或者最小值。</p>\n","categories":[],"tags":[]}