{"title":"æ•´ç†reacté‡Œé¢é‚£äº›å®¹æ˜“è®©äººæ··æ·†çš„æ¦‚å¿µ ğŸ˜‚","slug":"æ•´ç†reacté‡Œé¢é‚£äº›å®¹æ˜“è®©äººæ··æ·†çš„æ¦‚å¿µ-u-1F602","date":"2023-04-19T14:19:09.000Z","updated":"2023-09-05T06:49:29.131Z","comments":true,"path":"api/articles/æ•´ç†reacté‡Œé¢é‚£äº›å®¹æ˜“è®©äººæ··æ·†çš„æ¦‚å¿µ-u-1F602.json","excerpt":null,"covers":["https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/0193a7ad-6941-4d1c-a999-b556be454daa-image.png"],"content":"<h1 id=\"reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber\"><a href=\"#reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber\" class=\"headerlink\" title=\"reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber\"></a>reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber</h1><p>åœ¨è§£é‡Šä¸ºä»€ä¹ˆä¹‹å‰ï¼Œå…ˆæ¥è¯´ä¸€è¯´react16ä¹‹å‰ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">componentWillMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child componentWillMount&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child render&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>child<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child componentDidMount&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">componentWillReceiveProps</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child componentWillReceiveProps&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">shouldComponentUpdate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child shouldComponentUpdate&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">componentWillUpdate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child componentWillUpdate&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">componentDidUpdate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child componentDidUpdate&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">super</span>()</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123;</span><br><span class=\"line\">            <span class=\"attr\">count</span>:<span class=\"number\">0</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">Child</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span>=&gt;</span>&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                            count: this.state.count + 1</span></span><br><span class=\"line\"><span class=\"language-xml\">                        &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        add</span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;this.state.count&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢çš„ä¾‹å­ç”¨react15æ¥è¿è¡Œï¼Œchildç»„ä»¶æ²¡æœ‰stateä¸propsï¼Œä½†æ˜¯éšç€Appç»„ä»¶çš„æ›´æ–°ï¼ˆç‚¹å‡»addæŒ‰é’®ï¼‰ï¼Œchildç»„ä»¶ä¹Ÿè·Ÿç€æ›´æ–°äº†ï¼ˆè§¦å‘äº†componentWillReceivePropsã€shouldComponentUpdateã€componentWillUpdateã€renderä¸componentDidUpdateï¼‰ï¼Œè¿™æ˜¾ç„¶ä¸åˆç†ï¼Œä¸‡ä¸€childç»„ä»¶å¾ˆå¤§å‘¢ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œreact16ä¹‹å‰å¯ä»¥ä½¿ç”¨shouldComponentUpdateæ¥é˜»æ­¢ç»„ä»¶ä¸å¿…è¦çš„æ›´æ–°ã€‚</p>\n<p>è™½ç„¶shouldComponentUpdateå¯ä»¥è§£å†³è¿™ç§æƒ…å†µï¼Œä½†æ˜¯è¿™ç§ç°è±¡æš´éœ²äº†reactçš„ä¸€ä¸ªå¼Šç«¯ï¼Œçˆ¶ç»„ä»¶æ›´æ–°ï¼Œå­ç»„ä»¶ä¹Ÿä¼šæ— è„‘æ›´æ–°ï¼Œé™¤éè°ƒç”¨shouldComponentUpdateï¼Œä¸ºä»€ä¹ˆvueæ²¡æœ‰è¿™ç§å¼Šç«¯ï¼ŒåŸå› å°±æ˜¯vueæœ‰å“åº”å¼ç³»ç»Ÿï¼Œæ‰€ä»¥vueå¯ä»¥å¾ˆæ˜ç¡®çš„çŸ¥é“å“ªäº›ä¾èµ–éœ€è¦æ›´æ–°ï¼Œè€Œä¸éœ€è¦é‡æ–°renderæ•´æ£µæ ‘ã€‚æœ‰äº›æƒ…å†µå¯ä»¥ç”¨shouldComponentUpdateè§„é¿æ‰æ— ç”¨æ›´æ–°ï¼Œä½†æ˜¯reactè‚¯å®šæœ‰æœºä¼šé‡æ–°renderä¸€é¢—å·¨å¤§çš„æ ‘ã€‚æˆ‘ä»¬çŸ¥é“reactç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ï¼Œå…ˆè°ƒç”¨renderï¼Œç”Ÿæˆæ–°çš„è™šæ‹Ÿdomï¼Œç„¶åæ‰§è¡Œdiffç®—æ³•ï¼Œæ¯”å¯¹æ–°æ—§è™šæ‹Ÿdomä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œæœ€åä½œç”¨åˆ°çœŸå®domä¸Šã€‚åœ¨è¿™äº›æ­¥éª¤ä¸­ï¼Œå‡å¦‚ç»„ä»¶æ ‘å¾ˆå¤§ï¼Œdiffç®—æ³•åˆ™éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚javascriptæ˜¯å•çº¿ç¨‹è¯­è¨€ï¼Œé•¿æ—¶é—´çš„diffä¼šå¡ä½ä¸»çº¿ç¨‹ï¼Œè¿™ç§ç°è±¡åœ¨react16ä¹‹å‰æ˜¯æ²¡åŠæ³•è§£å†³çš„ã€‚</p>\n<p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œreact16å¼•å…¥äº†fiberï¼Œé¦–å…ˆè¯´è¯´ä»€ä¹ˆæ˜¯fiberï¼Œfiberæ˜¯ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥æè¿°ä¸€ä¸ªè™šæ‹Ÿdomï¼Œå‡å¦‚æœ‰ä»¥ä¸‹æ ‘å½¢ç»“æ„<br><img src=\"https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/0193a7ad-6941-4d1c-a999-b556be454daa-image.png\" alt=\"0193a7ad-6941-4d1c-a999-b556be454daa-image.png\"></p>\n<p>react16ä¹‹å‰è¿™ä¹ˆæè¿°</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> vnodes = &#123;</span><br><span class=\"line\">    <span class=\"attr\">key</span>:<span class=\"string\">&#x27;1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">children</span>:[</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">key</span>:<span class=\"string\">&#x27;2&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">children</span>:[</span><br><span class=\"line\">                &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;3&#x27;</span>&#125;,</span><br><span class=\"line\">                &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;4&#x27;</span>&#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">key</span>:<span class=\"string\">&#x27;5&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">children</span>:[</span><br><span class=\"line\">                &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;6&#x27;</span>&#125;,</span><br><span class=\"line\">                &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;7&#x27;</span>&#125;,</span><br><span class=\"line\">                &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;8&#x27;</span>&#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>react16ä¹‹åè¿™ä¹ˆæè¿°</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> vnodes = &#123;</span><br><span class=\"line\">    <span class=\"attr\">key</span>:<span class=\"string\">&#x27;1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">child</span>:&#123;</span><br><span class=\"line\">        <span class=\"attr\">key</span>:<span class=\"string\">&#x27;2&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;1&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">child</span>:&#123;</span><br><span class=\"line\">            <span class=\"attr\">key</span>:<span class=\"string\">&#x27;3&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;2&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">sibling</span>:&#123;</span><br><span class=\"line\">                <span class=\"attr\">key</span>:<span class=\"string\">&#x27;4&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;2&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">sibling</span>:&#123;</span><br><span class=\"line\">            <span class=\"attr\">key</span>:<span class=\"string\">&#x27;5&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;1&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">child</span>:&#123;</span><br><span class=\"line\">                <span class=\"attr\">key</span>:<span class=\"string\">&#x27;6&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;5&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">sibling</span>:&#123;</span><br><span class=\"line\">                    <span class=\"attr\">key</span>:<span class=\"string\">&#x27;7&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;5&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">sibling</span>:&#123;</span><br><span class=\"line\">                        <span class=\"attr\">key</span>:<span class=\"string\">&#x27;8&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;5&#x27;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¯¹æ¯”åŒä¸€å¼ å›¾çš„ä¸¤ç§vnodesï¼Œå¾ˆæ˜æ˜¾ï¼Œç¬¬ä¸€ä¸ªvnodesåœ¨diffçš„è¿‡ç¨‹ä¸­æ˜¯æ²¡æ³•æš‚åœçš„ï¼Œå› ä¸ºå®ƒæ¯ä¸ªèŠ‚ç‚¹åªæœ‰childrenï¼Œç¬¬äºŒä¸ªvnodesæ¯ä¸ªèŠ‚ç‚¹çš„æè¿°éƒ½åŒ…å«è‡ªå·±ä¸å…¶ä»–èŠ‚ç‚¹çš„å…³ç³»ï¼Œè¿™æ ·å³ä½¿diffæš‚åœï¼Œä¸‹æ¬¡ç»§ç»­æ—¶ä¹Ÿèƒ½æ‰¾åˆ°æœªå®Œæˆçš„èŠ‚ç‚¹ã€‚</p>\n<p>react16ä»¥åå¼•å…¥äº†è°ƒåº¦å™¨çš„æ¦‚å¿µï¼Œå®ƒçš„ä½œç”¨æ˜¯ç»™ä»»åŠ¡åˆ†çº§ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ç”±ç”¨æˆ·è§¦å‘çš„æ›´æ–°ä¼˜å…ˆçº§æ˜¯å¤§äºç»„ä»¶æ›´æ–°çš„ï¼Œå‡å¦‚reactæ­£åœ¨æ›´æ–°ä¸€ä¸ªå¤§ç»„ä»¶ï¼Œdiffç®—æ³•æ­£åœ¨å¦‚ç«å¦‚è¼çš„å·¥ä½œï¼Œè¿™æ—¶ç”¨æˆ·ç‚¹å‡»äº†æŸä¸ªæŒ‰é’®è¦æ±‚æ˜¾ç¤ºä¸€ä¸ªæç¤ºï¼Œé‚£è¿™ä¸ªæ›´æ–°çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œreactä¼šæš‚åœå¤§ç»„ä»¶çš„æ›´æ–°ï¼ˆä¾èµ–äºfiberèŠ‚ç‚¹çš„å¯æš‚åœç»“æ„ï¼‰ï¼Œå…ˆå»å“åº”æŒ‰é’®çš„æç¤ºï¼Œå®Œäº†ç»§ç»­å¤§ç»„ä»¶çš„æ›´æ–°ï¼Œreactç”¨è¿™ç§æœºåˆ¶æ¥è§£å†³æ›´æ–°å¤§ç»„ä»¶ä¸»çº¿ç¨‹æ²¡æœ‰å“åº”çš„é—®é¢˜ã€‚</p>\n<h1 id=\"å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–\"><a href=\"#å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–\" class=\"headerlink\" title=\"å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–\"></a>å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–</h1><h2 id=\"renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\"><a href=\"#renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\" class=\"headerlink\" title=\"renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\"></a>renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ä¸Šé¢è¯´ç»„ä»¶æ›´æ–°å¯ä»¥è¢«æš‚åœï¼Œé‚£ä¼šä¸ä¼šå‡ºç°ç•Œé¢æ›´æ–°ä¸€åŠçš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸ä¼šå‡ºç°çš„ï¼ŒåŸå› æ˜¯ï¼Œreact16ä¹‹åï¼Œç»„ä»¶æ›´æ–°è¢«åˆ†ä¸ºrenderé˜¶æ®µä¸commité˜¶æ®µï¼Œrenderé˜¶æ®µåŒ…æ‹¬renderå‡½æ•°çš„æ‰§è¡Œï¼Œdiffç®—æ³•çš„æ‰§è¡Œï¼Œä¸€æ—¦diffç®—æ³•æ‰§è¡Œå®Œæ¯•ï¼Œç»„ä»¶å¼€å§‹æ›´æ–°çœŸå®domï¼Œå°±è¿›å…¥äº†commité˜¶æ®µï¼Œrenderé˜¶æ®µå¯ä»¥è¢«åå¤æ‰§è¡Œï¼ˆå¯ä¸­æ–­ï¼Œå¯ç»§ç»­ï¼‰ï¼Œè€Œcommité˜¶æ®µæ¯æ¬¡æ›´æ–°åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°domæ¸²æŸ“ä¸€åŠçš„æƒ…å†µã€‚</p>\n<p>é‚£å“ªäº›ç”Ÿå‘½å‘¨æœŸå±äºrenderé˜¶æ®µï¼Œå“ªäº›å±äºcommité˜¶æ®µï¼Œé¦–å…ˆrenderå‡½æ•°è‚¯å®šæ˜¯åœ¨renderé˜¶æ®µæ‰§è¡Œçš„ï¼Œå› ä¸ºrenderå‡½æ•°çš„ä½œç”¨å°±æ˜¯ç”Ÿæˆè™šæ‹Ÿdomï¼Œå®Œäº†æ‰æ˜¯diffç»„ä»¶ä»¥åŠæ›´æ–°çœŸå®domçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥è‚¯å®šrenderå‡½æ•°ä»¥åŠå®ƒä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½å±äºrenderé˜¶æ®µã€‚ä¹‹å‰è¯´è¿‡renderé˜¶æ®µçš„ä»£ç æ˜¯å¯ä»¥è¢«åå¤æ‰§è¡Œçš„ï¼Œè¿™å°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚åœ¨componentWillReceivePropsã€componentWillUpdateè¿™äº›å‡½æ•°å†…æ‰§è¡Œäº†æŸäº›å‰¯ä½œç”¨ä»£ç ï¼Œè¿™ç§ç”Ÿå‘½å‘¨æœŸè¢«åå¤è°ƒç”¨çš„æœºåˆ¶å°±ä¼šå¯¼è‡´å‰¯ä½œç”¨è¢«åå¤æ‰§è¡Œï¼Œè¿™æ˜¾ç„¶ä¸å¯¹ï¼Œreactä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œå¯¹renderé˜¶æ®µçš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸè¿›è¡Œäº†æ”¹é€ ï¼Œå…¶å®ä¸»è¦é‡‡å–äº†ä¸¤ç§æ”¹é€ æ‰‹æ®µï¼š</p>\n<ol>\n<li>æŠŠå®ä¾‹æ–¹æ³•æ”¹æˆé™æ€æ–¹æ³•ï¼Œæ¯”å¦‚æŠŠcomponentWillReceivePropsæ”¹æˆstatic getDerivedStateFromPropsï¼Œè¿™æ ·æ”¹çš„ç›®çš„å°±æ˜¯ä¸è®©è®¿é—®thisï¼Œä¸€ä¸ªçº¯å‡½æ•°è¢«åå¤æ‰§è¡Œå…¶å®æ²¡ä»€ä¹ˆä¸å¥½ã€‚</li>\n<li>æ ‡è®°æŸäº›æ–¹æ³•æ˜¯ä¸å®‰å…¨çš„ï¼Œéšç€ç‰ˆæœ¬çš„å‡çº§ï¼Œé€æ­¥åºŸå¼ƒã€‚</li>\n</ol>\n<p>åº†å¹¸çš„æ˜¯ï¼ŒshouldComponentUpdateè¿™ä¸ªæ–¹æ³•é€ƒè¿‡ä¸€åŠ«ï¼ŒåŸå› å¯èƒ½æ˜¯è¿™ä¸ªæ–¹æ³•è¯­ä¹‰å¤ªæ˜æ˜¾äº†ï¼Œå¤§æ¦‚æ²¡æœ‰ä»€ä¹ˆäººåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æ‰§è¡Œå‰¯ä½œç”¨ä»£ç ã€‚</p>\n<h2 id=\"commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\"><a href=\"#commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\" class=\"headerlink\" title=\"commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\"></a>commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ä¸Šé¢è¯´renderå‡½æ•°ä»¥åŠä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½å±äºrenderé˜¶æ®µï¼Œé‚£commité˜¶æ®µå‘¢ï¼Œæœ‰äººä¼šè¯´componentWillUpdateï¼Ÿå¾ˆé—æ†¾ï¼Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸä¹Ÿå±äºrenderé˜¶æ®µï¼Œå¹¶ä¸”react16ä»¥åè¢«æ‰“ä¸Šäº†ä¸å®‰å…¨çš„æ ‡è®°ï¼Œé‚£æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥çŸ¥é“æ›´æ–°è¿›å…¥äº†commité˜¶æ®µï¼Œreact16æ–°åŠ äº†getSnapshotBeforeUpdateï¼Œåˆ«çœ‹è¿™ä¸ªæ–¹æ³•çš„å‘½åä¹Ÿæ˜¯getxxxä¹‹ç±»çš„é£æ ¼ï¼Œå®ƒå´æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆreactè¿™æ¬¡è®©äººå¤§æ–¹çš„è®¿é—®thisï¼ŒåŸå› åœ¨äºæ›´æ–°å·²ç»è¿›å…¥commité˜¶æ®µï¼Œå³ä½¿æœ‰å‰¯ä½œç”¨ä¹Ÿåªæ‰§è¡Œä¸€æ¬¡æ²¡ä»€ä¹ˆä¸å¥½ã€‚</p>\n<p>getSnapshotBeforeUpdateè¿™ä¸ªæ–¹æ³•ä¼šåœ¨diffç»“æŸï¼ˆæ˜¯ç»“æŸä¸æ˜¯ä¸­æ–­ï¼‰ï¼Œå·²ç»çŸ¥é“å“ªäº›doméœ€è¦æ›´æ–°ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¢«æ›´æ–°çš„æ—¶å€™è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç¨³å®šçš„è·å–æ›´æ–°å‰çš„domçŠ¶æ€ã€‚</p>\n<h2 id=\"æ•è·error\"><a href=\"#æ•è·error\" class=\"headerlink\" title=\"æ•è·error\"></a>æ•è·error</h2><p>react16ä»¥åæ–°å¢äº†ä¸€ä¸ªå«getDerivedStateFromErrorçš„ç”Ÿå‘½å‘¨æœŸï¼Œä»è¿™ä¸ªå‡½æ•°çš„åå­—æ¥çœ‹å¾ˆåƒgetDerivedStateFromPropsï¼Œæ²¡é”™å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå°±æ˜¯ä¸è®©ä½ è®¿é—®thisã€‚react16ä¹‹å‰æ˜¯æ€ä¹ˆæ•è·é”™è¯¯å‘¢ï¼Œæœ‰ä¸€ä¸ªå«componentDidCatchçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨react16ä»¥åä¹Ÿä¸€ç›´ä¿ç•™ï¼Œä¸ºä»€ä¹ˆå‡ºç°æ—¢ç”Ÿç‘œä½•ç”Ÿäº®çš„åœºé¢ï¼ŒåŸå› åœ¨äºè¿™ä¿©æ–¹æ³•çš„èŒè´£ä¸åŒï¼Œä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; count, onClick &#125; = <span class=\"variable language_\">this</span>.<span class=\"property\">props</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count &lt; <span class=\"number\">5</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;onClick&#125;</span>&gt;</span>add<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;count&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">super</span>(props);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123;</span><br><span class=\"line\">            <span class=\"attr\">count</span>: <span class=\"number\">0</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"title function_\">getDerivedStateFromError</span>(<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;getDerivedStateFromError has error&quot;</span>, error);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">componentDidCatch</span>(<span class=\"params\">error, info</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;componentDidCatch has error&quot;</span>, error, info);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>app<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">Child</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                    <span class=\"attr\">count</span>=<span class=\"string\">&#123;this.state.count&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                    <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                            count: this.state.count + 1</span></span><br><span class=\"line\"><span class=\"language-xml\">                        &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; <span class=\"comment\">// react18.2.0</span></span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬åœ¨å­ç»„ä»¶çš„renderå‡½æ•°é‡Œé¢æŠ›ä¸€ä¸ªé”™ï¼Œç»“æœå‘ç°åªæœ‰getDerivedStateFromErrorå“åº”äº†ï¼Œæˆ‘ä»¬æ¢ä¸ªä¾‹å­ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">ErrorBoundary</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">super</span>(props);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123; <span class=\"attr\">hasError</span>: <span class=\"literal\">false</span> &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">componentDidCatch</span>(<span class=\"params\">error, info</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;componentDidCatch has error&quot;</span>, error);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123; <span class=\"attr\">hasError</span>: <span class=\"literal\">true</span> &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"title function_\">getDerivedStateFromError</span>(<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;getDerivedStateFromError has error&quot;</span>, error);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">hasError</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Something went wrong.<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">props</span>.<span class=\"property\">children</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">MyComponent</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">super</span>(props);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123; <span class=\"attr\">value</span>: <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">componentDidUpdate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">value</span> === <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&quot;I crashed!&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    handleClick = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123; <span class=\"attr\">value</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">value</span> + <span class=\"number\">1</span> &#125;);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.handleClick&#125;</span>&gt;</span>&#123;this.state.value&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">ErrorBoundary</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">ErrorBoundary</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125; <span class=\"comment\">// react18.2.0</span></span><br></pre></td></tr></table></figure>\n<p>åœ¨å­ç»„ä»¶çš„componentDidUpdateï¼ˆcommité˜¶æ®µï¼‰é‡Œé¢æŠ›ä¸ªé”™ï¼Œç»“æœgetDerivedStateFromErrorä¸componentDidCatchéƒ½å“åº”äº†ã€‚</p>\n<p>å¯¹æ¯”è¿™ä¸¤ä¸ªä¾‹å­ä½ ä¼šå‘ç°ï¼ŒreactæŠŠæ•è·é”™è¯¯è¿™ä¸ªè¡Œä¸ºåˆ†ä¸ºæœ‰å‰¯ä½œç”¨çš„æ•è·ä¸æ— å‰¯ä½œç”¨çš„æ•è·ï¼Œåƒåœ¨renderå‡½æ•°é‡Œé¢å‘ç”Ÿçš„é”™è¯¯ï¼Œrenderå‡½æ•°å¤„äºrenderé˜¶æ®µï¼Œreactè‚¯å®šä¸å¸Œæœ›å¼€å‘è€…è®¿é—®thisï¼Œæ‰€ä»¥ç†æ‰€å½“ç„¶çš„åªæœ‰getDerivedStateFromErrorå“åº”ï¼Œè€Œåœ¨componentDidUpdateé‡Œé¢æŠ›çš„é”™ï¼Œç”±äºå·²ç»å¤„äºcommité˜¶æ®µï¼Œå¼€å‘è€…æƒ³å¹²ä»€ä¹ˆreactä¸ä¼šå»å¹²é¢„ï¼Œè¿™æ—¶çš„æ•è·é”™è¯¯çš„è¡Œä¸ºå¯èƒ½æ˜¯çº¯çš„ä¹Ÿå¯èƒ½æ˜¯ä¸çº¯çš„ï¼Œæ‰€ä»¥ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šå“åº”ã€‚</p>\n<h2 id=\"Suspense\"><a href=\"#Suspense\" class=\"headerlink\" title=\"Suspense\"></a>Suspense</h2><h2 id=\"hooks\"><a href=\"#hooks\" class=\"headerlink\" title=\"hooks\"></a>hooks</h2><p>è¿™é‡Œä¸ä¸€ä¸€ä»‹ç»æ¯ä¸ªhookï¼Œåªæ˜¯è¯´æ˜ä¸ºä»€ä¹ˆä¼šæ¨å‡ºhooksï¼Œä»¥åŠrenderä¸commité˜¶æ®µéƒ½æœ‰å“ªäº›hookã€‚</p>\n<h3 id=\"ä¸ºä»€ä¹ˆæ¨å‡ºhooks\"><a href=\"#ä¸ºä»€ä¹ˆæ¨å‡ºhooks\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆæ¨å‡ºhooks\"></a>ä¸ºä»€ä¹ˆæ¨å‡ºhooks</h3><ol>\n<li>é¦–å…ˆreact16ä»¥åç”±äºå¼•å…¥äº†å¯ä¸­æ–­æ›´æ–°ï¼Œåœ¨renderé˜¶æ®µè®¿é—®thiså°†å˜å¾—ä¸å®‰å…¨ï¼Œé™¤äº†ä¸Šé¢çš„ä¸¤ç§æ”¹é€ å¤–ï¼Œå®Œå…¨æœç»thisä¹Ÿæ˜¯ä¸€ç§æ–¹æ¡ˆï¼Œæ‰€ä»¥reactæ›´æ¨å´‡ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ã€‚</li>\n<li>react hooksåœ¨é€»è¾‘å¤ç”¨æ–¹é¢æ˜¯ä¸€æŠŠåˆ©å™¨ï¼Œå®ƒå¯èƒ½å¾ˆå®¹æ˜“çš„æŠŠé€»è¾‘ä¸æ¸²æŸ“åˆ†å¼€ï¼Œä¸ºä»€ä¹ˆè¦åˆ†å¼€ï¼Œç®€è€Œè¨€ä¹‹ï¼Œæ¸²æŸ“ï¼ˆuiï¼‰æ˜¯å¾ˆéš¾æŠ½è±¡ä¸å¤ç”¨çš„ï¼Œè€Œé€»è¾‘æ°æ°ç›¸åã€‚</li>\n</ol>\n<h3 id=\"renderé˜¶æ®µçš„hooks\"><a href=\"#renderé˜¶æ®µçš„hooks\" class=\"headerlink\" title=\"renderé˜¶æ®µçš„hooks\"></a>renderé˜¶æ®µçš„hooks</h3><p>useStateã€useMemoã€useCallbackã€useRefã€useContextã€useReducerã€useEffectã€useLayoutEffect</p>\n<p>å…¶ä¸­useEffectã€useLayoutEffectè¿™ä¿©å…è®¸æ‰§è¡Œå‰¯ä½œç”¨çš„hookä¹Ÿæ˜¯åœ¨renderé˜¶æ®µæ‰§è¡Œçš„ã€‚ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œrenderé˜¶æ®µä¸æ˜¯ä¸è®©æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œå˜›ï¼Œè¿™ä¿©è™½ç„¶åœ¨renderé˜¶æ®µæ‰§è¡Œï¼Œä½†æ˜¯å®ƒä»¬çš„å›è°ƒå‡½æ•°ä¸åœ¨renderé˜¶æ®µæ‰§è¡Œã€‚</p>\n<h3 id=\"commité˜¶æ®µçš„hooks\"><a href=\"#commité˜¶æ®µçš„hooks\" class=\"headerlink\" title=\"commité˜¶æ®µçš„hooks\"></a>commité˜¶æ®µçš„hooks</h3><p>useEffectä¸useLayoutEffectçš„å›è°ƒå‡½æ•°ã€‚</p>\n<p>å…ˆè¯´useLayoutEffectã€‚è¿™ä¸ªhookä¼šåœ¨domæ›´æ–°å®Œæ¯•ï¼Œä½†æ˜¯æµè§ˆå™¨è¿˜æ²¡æœ‰æ¥å¾—åŠç»˜åˆ¶ä¹‹å‰åŒæ­¥æ‰§è¡Œã€‚è¿™å¥è¯æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘ä»¬çŸ¥é“javascriptåªæ˜¯ç”¨æ¥æ“ä½œdomï¼ŒåƒsetStateä¹‹ç±»æ“ä½œæˆ–è€…æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œdomåªæ˜¯æ”¹å˜äº†å†…å­˜é‡Œä¸€é¢—domæ ‘ä¸Šçš„æŸäº›èŠ‚ç‚¹ï¼ŒçœŸæ­£æŠŠdomæ ‘ç»˜åˆ¶æˆå±å¹•ä¸Šå½¢å½¢è‰²è‰²çš„ç”»é¢æ˜¯æµè§ˆå™¨å®Œæˆçš„ï¼Œå‡è®¾æˆ‘ä»¬æµè§ˆå™¨ä¸€ç§’ç»˜åˆ¶60å¸§ï¼Œé‚£ç»˜åˆ¶ä¸€å¸§çš„æ—¶é—´å°±æ˜¯16msï¼Œè€Œjavascriptæ˜¯å•çº¿ç¨‹è¯­è¨€ï¼Œæ‰§è¡Œjsä»£ç ä¸uiç»˜åˆ¶æ˜¯äº’æ–¥çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬åœ¨16mså†…ç”¨10msçš„æ—¶é—´æ¥æ›´æ–°domæ ‘ï¼Œé‚£ä¹ˆè¿˜å‰©æœ€å¤š6msç”¨æ¥æ‰§è¡ŒuseLayoutEffectã€‚</p>\n<p>æ‰€ä»¥è¿™ä¸ªhookå†…éƒ¨é€‚åˆæ‰§è¡Œä¸€äº›çŸ­å°ç²¾æ‚çš„ä»£ç ï¼Œå‡å¦‚æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œé‚£è¿™ä¸€æ¬¡æ›´æ–°å°±æ²¡æœ‰è¢«ç»˜åˆ¶ï¼Œäººå°±ä¼šæ„Ÿè§‰åˆ°å¡ã€‚</p>\n<p>å¯¹æ¯”ä»‹ç»ç±»ç»„ä»¶æ—¶ä¹Ÿæœ‰ä¸ªåœ¨commité˜¶æ®µæ‰§è¡Œçš„å‡½æ•°ï¼ŒgetSnapshotBeforeUpdateï¼ŒuseLayoutEffectä¸getSnapshotBeforeUpdateçš„æ‰§è¡Œæ—¶æœºå´æœ‰ç»†å¾®çš„å·®åˆ«ï¼Œå‰è€…æ˜¯åœ¨çœŸå®domæ›´æ–°å®Œæ¯•æµè§ˆå™¨è¿˜æœªç»˜åˆ¶ä¹‹å‰è§¦å‘ï¼Œè¿™æ—¶æ‹¿åˆ°çš„æ˜¯æ›´æ–°åçš„domï¼Œåè€…æ˜¯åœ¨çœŸå®domè¿˜æœªæ›´æ–°å³å°†æ›´æ–°æ—¶è§¦å‘ï¼Œè¿™æ—¶æ‹¿åˆ°çš„æ˜¯æ›´æ–°å‰çš„domã€‚</p>\n<p>æœ€åè¯´ä¸€ä¸‹useEffectï¼Œè¿™ä¸ªhookçš„å›è°ƒå‡½æ•°æ˜¯åœ¨commité˜¶æ®µæ‰§è¡Œå®Œæ¯•å¼‚æ­¥æ‰§è¡Œçš„ã€‚è¿™æ—¶domå·²ç»æ›´æ–°å®Œæ¯•å¹¶ä¸”æµè§ˆå™¨ä¹Ÿå®Œæˆäº†ç»˜åˆ¶ï¼Œå› ä¸ºæ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸åƒuseLayoutEffecté‚£ä¹ˆå°å¿ƒç¿¼ç¿¼çš„ã€‚</p>\n","more":"<h1 id=\"reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber\"><a href=\"#reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber\" class=\"headerlink\" title=\"reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber\"></a>reactä¸ºä»€ä¹ˆè¦å¼•å…¥fiber</h1><p>åœ¨è§£é‡Šä¸ºä»€ä¹ˆä¹‹å‰ï¼Œå…ˆæ¥è¯´ä¸€è¯´react16ä¹‹å‰ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">componentWillMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child componentWillMount&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child render&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>child<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child componentDidMount&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">componentWillReceiveProps</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child componentWillReceiveProps&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">shouldComponentUpdate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child shouldComponentUpdate&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">componentWillUpdate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child componentWillUpdate&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">componentDidUpdate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;Child componentDidUpdate&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">super</span>()</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123;</span><br><span class=\"line\">            <span class=\"attr\">count</span>:<span class=\"number\">0</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">Child</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span>=&gt;</span>&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                            count: this.state.count + 1</span></span><br><span class=\"line\"><span class=\"language-xml\">                        &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        add</span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;this.state.count&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢çš„ä¾‹å­ç”¨react15æ¥è¿è¡Œï¼Œchildç»„ä»¶æ²¡æœ‰stateä¸propsï¼Œä½†æ˜¯éšç€Appç»„ä»¶çš„æ›´æ–°ï¼ˆç‚¹å‡»addæŒ‰é’®ï¼‰ï¼Œchildç»„ä»¶ä¹Ÿè·Ÿç€æ›´æ–°äº†ï¼ˆè§¦å‘äº†componentWillReceivePropsã€shouldComponentUpdateã€componentWillUpdateã€renderä¸componentDidUpdateï¼‰ï¼Œè¿™æ˜¾ç„¶ä¸åˆç†ï¼Œä¸‡ä¸€childç»„ä»¶å¾ˆå¤§å‘¢ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œreact16ä¹‹å‰å¯ä»¥ä½¿ç”¨shouldComponentUpdateæ¥é˜»æ­¢ç»„ä»¶ä¸å¿…è¦çš„æ›´æ–°ã€‚</p>\n<p>è™½ç„¶shouldComponentUpdateå¯ä»¥è§£å†³è¿™ç§æƒ…å†µï¼Œä½†æ˜¯è¿™ç§ç°è±¡æš´éœ²äº†reactçš„ä¸€ä¸ªå¼Šç«¯ï¼Œçˆ¶ç»„ä»¶æ›´æ–°ï¼Œå­ç»„ä»¶ä¹Ÿä¼šæ— è„‘æ›´æ–°ï¼Œé™¤éè°ƒç”¨shouldComponentUpdateï¼Œä¸ºä»€ä¹ˆvueæ²¡æœ‰è¿™ç§å¼Šç«¯ï¼ŒåŸå› å°±æ˜¯vueæœ‰å“åº”å¼ç³»ç»Ÿï¼Œæ‰€ä»¥vueå¯ä»¥å¾ˆæ˜ç¡®çš„çŸ¥é“å“ªäº›ä¾èµ–éœ€è¦æ›´æ–°ï¼Œè€Œä¸éœ€è¦é‡æ–°renderæ•´æ£µæ ‘ã€‚æœ‰äº›æƒ…å†µå¯ä»¥ç”¨shouldComponentUpdateè§„é¿æ‰æ— ç”¨æ›´æ–°ï¼Œä½†æ˜¯reactè‚¯å®šæœ‰æœºä¼šé‡æ–°renderä¸€é¢—å·¨å¤§çš„æ ‘ã€‚æˆ‘ä»¬çŸ¥é“reactç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ï¼Œå…ˆè°ƒç”¨renderï¼Œç”Ÿæˆæ–°çš„è™šæ‹Ÿdomï¼Œç„¶åæ‰§è¡Œdiffç®—æ³•ï¼Œæ¯”å¯¹æ–°æ—§è™šæ‹Ÿdomä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œæœ€åä½œç”¨åˆ°çœŸå®domä¸Šã€‚åœ¨è¿™äº›æ­¥éª¤ä¸­ï¼Œå‡å¦‚ç»„ä»¶æ ‘å¾ˆå¤§ï¼Œdiffç®—æ³•åˆ™éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚javascriptæ˜¯å•çº¿ç¨‹è¯­è¨€ï¼Œé•¿æ—¶é—´çš„diffä¼šå¡ä½ä¸»çº¿ç¨‹ï¼Œè¿™ç§ç°è±¡åœ¨react16ä¹‹å‰æ˜¯æ²¡åŠæ³•è§£å†³çš„ã€‚</p>\n<p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œreact16å¼•å…¥äº†fiberï¼Œé¦–å…ˆè¯´è¯´ä»€ä¹ˆæ˜¯fiberï¼Œfiberæ˜¯ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥æè¿°ä¸€ä¸ªè™šæ‹Ÿdomï¼Œå‡å¦‚æœ‰ä»¥ä¸‹æ ‘å½¢ç»“æ„<br><img src=\"https://likaiqiang-blog.oss-cn-beijing.aliyuncs.com/images/0193a7ad-6941-4d1c-a999-b556be454daa-image.png\" alt=\"0193a7ad-6941-4d1c-a999-b556be454daa-image.png\"></p>\n<p>react16ä¹‹å‰è¿™ä¹ˆæè¿°</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> vnodes = &#123;</span><br><span class=\"line\">    <span class=\"attr\">key</span>:<span class=\"string\">&#x27;1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">children</span>:[</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">key</span>:<span class=\"string\">&#x27;2&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">children</span>:[</span><br><span class=\"line\">                &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;3&#x27;</span>&#125;,</span><br><span class=\"line\">                &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;4&#x27;</span>&#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">key</span>:<span class=\"string\">&#x27;5&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">children</span>:[</span><br><span class=\"line\">                &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;6&#x27;</span>&#125;,</span><br><span class=\"line\">                &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;7&#x27;</span>&#125;,</span><br><span class=\"line\">                &#123;<span class=\"attr\">key</span>: <span class=\"string\">&#x27;8&#x27;</span>&#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>react16ä¹‹åè¿™ä¹ˆæè¿°</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> vnodes = &#123;</span><br><span class=\"line\">    <span class=\"attr\">key</span>:<span class=\"string\">&#x27;1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">child</span>:&#123;</span><br><span class=\"line\">        <span class=\"attr\">key</span>:<span class=\"string\">&#x27;2&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;1&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">child</span>:&#123;</span><br><span class=\"line\">            <span class=\"attr\">key</span>:<span class=\"string\">&#x27;3&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;2&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">sibling</span>:&#123;</span><br><span class=\"line\">                <span class=\"attr\">key</span>:<span class=\"string\">&#x27;4&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;2&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">sibling</span>:&#123;</span><br><span class=\"line\">            <span class=\"attr\">key</span>:<span class=\"string\">&#x27;5&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;1&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">child</span>:&#123;</span><br><span class=\"line\">                <span class=\"attr\">key</span>:<span class=\"string\">&#x27;6&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;5&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">sibling</span>:&#123;</span><br><span class=\"line\">                    <span class=\"attr\">key</span>:<span class=\"string\">&#x27;7&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;5&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">sibling</span>:&#123;</span><br><span class=\"line\">                        <span class=\"attr\">key</span>:<span class=\"string\">&#x27;8&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">parent</span>:<span class=\"string\">&#x27;5&#x27;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¯¹æ¯”åŒä¸€å¼ å›¾çš„ä¸¤ç§vnodesï¼Œå¾ˆæ˜æ˜¾ï¼Œç¬¬ä¸€ä¸ªvnodesåœ¨diffçš„è¿‡ç¨‹ä¸­æ˜¯æ²¡æ³•æš‚åœçš„ï¼Œå› ä¸ºå®ƒæ¯ä¸ªèŠ‚ç‚¹åªæœ‰childrenï¼Œç¬¬äºŒä¸ªvnodesæ¯ä¸ªèŠ‚ç‚¹çš„æè¿°éƒ½åŒ…å«è‡ªå·±ä¸å…¶ä»–èŠ‚ç‚¹çš„å…³ç³»ï¼Œè¿™æ ·å³ä½¿diffæš‚åœï¼Œä¸‹æ¬¡ç»§ç»­æ—¶ä¹Ÿèƒ½æ‰¾åˆ°æœªå®Œæˆçš„èŠ‚ç‚¹ã€‚</p>\n<p>react16ä»¥åå¼•å…¥äº†è°ƒåº¦å™¨çš„æ¦‚å¿µï¼Œå®ƒçš„ä½œç”¨æ˜¯ç»™ä»»åŠ¡åˆ†çº§ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ç”±ç”¨æˆ·è§¦å‘çš„æ›´æ–°ä¼˜å…ˆçº§æ˜¯å¤§äºç»„ä»¶æ›´æ–°çš„ï¼Œå‡å¦‚reactæ­£åœ¨æ›´æ–°ä¸€ä¸ªå¤§ç»„ä»¶ï¼Œdiffç®—æ³•æ­£åœ¨å¦‚ç«å¦‚è¼çš„å·¥ä½œï¼Œè¿™æ—¶ç”¨æˆ·ç‚¹å‡»äº†æŸä¸ªæŒ‰é’®è¦æ±‚æ˜¾ç¤ºä¸€ä¸ªæç¤ºï¼Œé‚£è¿™ä¸ªæ›´æ–°çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œreactä¼šæš‚åœå¤§ç»„ä»¶çš„æ›´æ–°ï¼ˆä¾èµ–äºfiberèŠ‚ç‚¹çš„å¯æš‚åœç»“æ„ï¼‰ï¼Œå…ˆå»å“åº”æŒ‰é’®çš„æç¤ºï¼Œå®Œäº†ç»§ç»­å¤§ç»„ä»¶çš„æ›´æ–°ï¼Œreactç”¨è¿™ç§æœºåˆ¶æ¥è§£å†³æ›´æ–°å¤§ç»„ä»¶ä¸»çº¿ç¨‹æ²¡æœ‰å“åº”çš„é—®é¢˜ã€‚</p>\n<h1 id=\"å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–\"><a href=\"#å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–\" class=\"headerlink\" title=\"å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–\"></a>å¼•å…¥fiberåæ‰€å¸¦æ¥çš„çš„å˜åŒ–</h1><h2 id=\"renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\"><a href=\"#renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\" class=\"headerlink\" title=\"renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\"></a>renderé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ä¸Šé¢è¯´ç»„ä»¶æ›´æ–°å¯ä»¥è¢«æš‚åœï¼Œé‚£ä¼šä¸ä¼šå‡ºç°ç•Œé¢æ›´æ–°ä¸€åŠçš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸ä¼šå‡ºç°çš„ï¼ŒåŸå› æ˜¯ï¼Œreact16ä¹‹åï¼Œç»„ä»¶æ›´æ–°è¢«åˆ†ä¸ºrenderé˜¶æ®µä¸commité˜¶æ®µï¼Œrenderé˜¶æ®µåŒ…æ‹¬renderå‡½æ•°çš„æ‰§è¡Œï¼Œdiffç®—æ³•çš„æ‰§è¡Œï¼Œä¸€æ—¦diffç®—æ³•æ‰§è¡Œå®Œæ¯•ï¼Œç»„ä»¶å¼€å§‹æ›´æ–°çœŸå®domï¼Œå°±è¿›å…¥äº†commité˜¶æ®µï¼Œrenderé˜¶æ®µå¯ä»¥è¢«åå¤æ‰§è¡Œï¼ˆå¯ä¸­æ–­ï¼Œå¯ç»§ç»­ï¼‰ï¼Œè€Œcommité˜¶æ®µæ¯æ¬¡æ›´æ–°åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°domæ¸²æŸ“ä¸€åŠçš„æƒ…å†µã€‚</p>\n<p>é‚£å“ªäº›ç”Ÿå‘½å‘¨æœŸå±äºrenderé˜¶æ®µï¼Œå“ªäº›å±äºcommité˜¶æ®µï¼Œé¦–å…ˆrenderå‡½æ•°è‚¯å®šæ˜¯åœ¨renderé˜¶æ®µæ‰§è¡Œçš„ï¼Œå› ä¸ºrenderå‡½æ•°çš„ä½œç”¨å°±æ˜¯ç”Ÿæˆè™šæ‹Ÿdomï¼Œå®Œäº†æ‰æ˜¯diffç»„ä»¶ä»¥åŠæ›´æ–°çœŸå®domçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥è‚¯å®šrenderå‡½æ•°ä»¥åŠå®ƒä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½å±äºrenderé˜¶æ®µã€‚ä¹‹å‰è¯´è¿‡renderé˜¶æ®µçš„ä»£ç æ˜¯å¯ä»¥è¢«åå¤æ‰§è¡Œçš„ï¼Œè¿™å°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚åœ¨componentWillReceivePropsã€componentWillUpdateè¿™äº›å‡½æ•°å†…æ‰§è¡Œäº†æŸäº›å‰¯ä½œç”¨ä»£ç ï¼Œè¿™ç§ç”Ÿå‘½å‘¨æœŸè¢«åå¤è°ƒç”¨çš„æœºåˆ¶å°±ä¼šå¯¼è‡´å‰¯ä½œç”¨è¢«åå¤æ‰§è¡Œï¼Œè¿™æ˜¾ç„¶ä¸å¯¹ï¼Œreactä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œå¯¹renderé˜¶æ®µçš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸè¿›è¡Œäº†æ”¹é€ ï¼Œå…¶å®ä¸»è¦é‡‡å–äº†ä¸¤ç§æ”¹é€ æ‰‹æ®µï¼š</p>\n<ol>\n<li>æŠŠå®ä¾‹æ–¹æ³•æ”¹æˆé™æ€æ–¹æ³•ï¼Œæ¯”å¦‚æŠŠcomponentWillReceivePropsæ”¹æˆstatic getDerivedStateFromPropsï¼Œè¿™æ ·æ”¹çš„ç›®çš„å°±æ˜¯ä¸è®©è®¿é—®thisï¼Œä¸€ä¸ªçº¯å‡½æ•°è¢«åå¤æ‰§è¡Œå…¶å®æ²¡ä»€ä¹ˆä¸å¥½ã€‚</li>\n<li>æ ‡è®°æŸäº›æ–¹æ³•æ˜¯ä¸å®‰å…¨çš„ï¼Œéšç€ç‰ˆæœ¬çš„å‡çº§ï¼Œé€æ­¥åºŸå¼ƒã€‚</li>\n</ol>\n<p>åº†å¹¸çš„æ˜¯ï¼ŒshouldComponentUpdateè¿™ä¸ªæ–¹æ³•é€ƒè¿‡ä¸€åŠ«ï¼ŒåŸå› å¯èƒ½æ˜¯è¿™ä¸ªæ–¹æ³•è¯­ä¹‰å¤ªæ˜æ˜¾äº†ï¼Œå¤§æ¦‚æ²¡æœ‰ä»€ä¹ˆäººåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æ‰§è¡Œå‰¯ä½œç”¨ä»£ç ã€‚</p>\n<h2 id=\"commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\"><a href=\"#commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\" class=\"headerlink\" title=\"commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ\"></a>commité˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ä¸Šé¢è¯´renderå‡½æ•°ä»¥åŠä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½å±äºrenderé˜¶æ®µï¼Œé‚£commité˜¶æ®µå‘¢ï¼Œæœ‰äººä¼šè¯´componentWillUpdateï¼Ÿå¾ˆé—æ†¾ï¼Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸä¹Ÿå±äºrenderé˜¶æ®µï¼Œå¹¶ä¸”react16ä»¥åè¢«æ‰“ä¸Šäº†ä¸å®‰å…¨çš„æ ‡è®°ï¼Œé‚£æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥çŸ¥é“æ›´æ–°è¿›å…¥äº†commité˜¶æ®µï¼Œreact16æ–°åŠ äº†getSnapshotBeforeUpdateï¼Œåˆ«çœ‹è¿™ä¸ªæ–¹æ³•çš„å‘½åä¹Ÿæ˜¯getxxxä¹‹ç±»çš„é£æ ¼ï¼Œå®ƒå´æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆreactè¿™æ¬¡è®©äººå¤§æ–¹çš„è®¿é—®thisï¼ŒåŸå› åœ¨äºæ›´æ–°å·²ç»è¿›å…¥commité˜¶æ®µï¼Œå³ä½¿æœ‰å‰¯ä½œç”¨ä¹Ÿåªæ‰§è¡Œä¸€æ¬¡æ²¡ä»€ä¹ˆä¸å¥½ã€‚</p>\n<p>getSnapshotBeforeUpdateè¿™ä¸ªæ–¹æ³•ä¼šåœ¨diffç»“æŸï¼ˆæ˜¯ç»“æŸä¸æ˜¯ä¸­æ–­ï¼‰ï¼Œå·²ç»çŸ¥é“å“ªäº›doméœ€è¦æ›´æ–°ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¢«æ›´æ–°çš„æ—¶å€™è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç¨³å®šçš„è·å–æ›´æ–°å‰çš„domçŠ¶æ€ã€‚</p>\n<h2 id=\"æ•è·error\"><a href=\"#æ•è·error\" class=\"headerlink\" title=\"æ•è·error\"></a>æ•è·error</h2><p>react16ä»¥åæ–°å¢äº†ä¸€ä¸ªå«getDerivedStateFromErrorçš„ç”Ÿå‘½å‘¨æœŸï¼Œä»è¿™ä¸ªå‡½æ•°çš„åå­—æ¥çœ‹å¾ˆåƒgetDerivedStateFromPropsï¼Œæ²¡é”™å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå°±æ˜¯ä¸è®©ä½ è®¿é—®thisã€‚react16ä¹‹å‰æ˜¯æ€ä¹ˆæ•è·é”™è¯¯å‘¢ï¼Œæœ‰ä¸€ä¸ªå«componentDidCatchçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨react16ä»¥åä¹Ÿä¸€ç›´ä¿ç•™ï¼Œä¸ºä»€ä¹ˆå‡ºç°æ—¢ç”Ÿç‘œä½•ç”Ÿäº®çš„åœºé¢ï¼ŒåŸå› åœ¨äºè¿™ä¿©æ–¹æ³•çš„èŒè´£ä¸åŒï¼Œä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; count, onClick &#125; = <span class=\"variable language_\">this</span>.<span class=\"property\">props</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count &lt; <span class=\"number\">5</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;onClick&#125;</span>&gt;</span>add<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;count&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">super</span>(props);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123;</span><br><span class=\"line\">            <span class=\"attr\">count</span>: <span class=\"number\">0</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"title function_\">getDerivedStateFromError</span>(<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;getDerivedStateFromError has error&quot;</span>, error);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">componentDidCatch</span>(<span class=\"params\">error, info</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;componentDidCatch has error&quot;</span>, error, info);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>app<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">Child</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                    <span class=\"attr\">count</span>=<span class=\"string\">&#123;this.state.count&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                    <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                            count: this.state.count + 1</span></span><br><span class=\"line\"><span class=\"language-xml\">                        &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; <span class=\"comment\">// react18.2.0</span></span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬åœ¨å­ç»„ä»¶çš„renderå‡½æ•°é‡Œé¢æŠ›ä¸€ä¸ªé”™ï¼Œç»“æœå‘ç°åªæœ‰getDerivedStateFromErrorå“åº”äº†ï¼Œæˆ‘ä»¬æ¢ä¸ªä¾‹å­ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">ErrorBoundary</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">super</span>(props);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123; <span class=\"attr\">hasError</span>: <span class=\"literal\">false</span> &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">componentDidCatch</span>(<span class=\"params\">error, info</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;componentDidCatch has error&quot;</span>, error);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123; <span class=\"attr\">hasError</span>: <span class=\"literal\">true</span> &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"title function_\">getDerivedStateFromError</span>(<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;getDerivedStateFromError has error&quot;</span>, error);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">hasError</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Something went wrong.<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">props</span>.<span class=\"property\">children</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">MyComponent</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">super</span>(props);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123; <span class=\"attr\">value</span>: <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">componentDidUpdate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">value</span> === <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&quot;I crashed!&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    handleClick = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123; <span class=\"attr\">value</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">value</span> + <span class=\"number\">1</span> &#125;);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.handleClick&#125;</span>&gt;</span>&#123;this.state.value&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">ErrorBoundary</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">ErrorBoundary</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125; <span class=\"comment\">// react18.2.0</span></span><br></pre></td></tr></table></figure>\n<p>åœ¨å­ç»„ä»¶çš„componentDidUpdateï¼ˆcommité˜¶æ®µï¼‰é‡Œé¢æŠ›ä¸ªé”™ï¼Œç»“æœgetDerivedStateFromErrorä¸componentDidCatchéƒ½å“åº”äº†ã€‚</p>\n<p>å¯¹æ¯”è¿™ä¸¤ä¸ªä¾‹å­ä½ ä¼šå‘ç°ï¼ŒreactæŠŠæ•è·é”™è¯¯è¿™ä¸ªè¡Œä¸ºåˆ†ä¸ºæœ‰å‰¯ä½œç”¨çš„æ•è·ä¸æ— å‰¯ä½œç”¨çš„æ•è·ï¼Œåƒåœ¨renderå‡½æ•°é‡Œé¢å‘ç”Ÿçš„é”™è¯¯ï¼Œrenderå‡½æ•°å¤„äºrenderé˜¶æ®µï¼Œreactè‚¯å®šä¸å¸Œæœ›å¼€å‘è€…è®¿é—®thisï¼Œæ‰€ä»¥ç†æ‰€å½“ç„¶çš„åªæœ‰getDerivedStateFromErrorå“åº”ï¼Œè€Œåœ¨componentDidUpdateé‡Œé¢æŠ›çš„é”™ï¼Œç”±äºå·²ç»å¤„äºcommité˜¶æ®µï¼Œå¼€å‘è€…æƒ³å¹²ä»€ä¹ˆreactä¸ä¼šå»å¹²é¢„ï¼Œè¿™æ—¶çš„æ•è·é”™è¯¯çš„è¡Œä¸ºå¯èƒ½æ˜¯çº¯çš„ä¹Ÿå¯èƒ½æ˜¯ä¸çº¯çš„ï¼Œæ‰€ä»¥ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šå“åº”ã€‚</p>\n<h2 id=\"Suspense\"><a href=\"#Suspense\" class=\"headerlink\" title=\"Suspense\"></a>Suspense</h2><h2 id=\"hooks\"><a href=\"#hooks\" class=\"headerlink\" title=\"hooks\"></a>hooks</h2><p>è¿™é‡Œä¸ä¸€ä¸€ä»‹ç»æ¯ä¸ªhookï¼Œåªæ˜¯è¯´æ˜ä¸ºä»€ä¹ˆä¼šæ¨å‡ºhooksï¼Œä»¥åŠrenderä¸commité˜¶æ®µéƒ½æœ‰å“ªäº›hookã€‚</p>\n<h3 id=\"ä¸ºä»€ä¹ˆæ¨å‡ºhooks\"><a href=\"#ä¸ºä»€ä¹ˆæ¨å‡ºhooks\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆæ¨å‡ºhooks\"></a>ä¸ºä»€ä¹ˆæ¨å‡ºhooks</h3><ol>\n<li>é¦–å…ˆreact16ä»¥åç”±äºå¼•å…¥äº†å¯ä¸­æ–­æ›´æ–°ï¼Œåœ¨renderé˜¶æ®µè®¿é—®thiså°†å˜å¾—ä¸å®‰å…¨ï¼Œé™¤äº†ä¸Šé¢çš„ä¸¤ç§æ”¹é€ å¤–ï¼Œå®Œå…¨æœç»thisä¹Ÿæ˜¯ä¸€ç§æ–¹æ¡ˆï¼Œæ‰€ä»¥reactæ›´æ¨å´‡ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ã€‚</li>\n<li>react hooksåœ¨é€»è¾‘å¤ç”¨æ–¹é¢æ˜¯ä¸€æŠŠåˆ©å™¨ï¼Œå®ƒå¯èƒ½å¾ˆå®¹æ˜“çš„æŠŠé€»è¾‘ä¸æ¸²æŸ“åˆ†å¼€ï¼Œä¸ºä»€ä¹ˆè¦åˆ†å¼€ï¼Œç®€è€Œè¨€ä¹‹ï¼Œæ¸²æŸ“ï¼ˆuiï¼‰æ˜¯å¾ˆéš¾æŠ½è±¡ä¸å¤ç”¨çš„ï¼Œè€Œé€»è¾‘æ°æ°ç›¸åã€‚</li>\n</ol>\n<h3 id=\"renderé˜¶æ®µçš„hooks\"><a href=\"#renderé˜¶æ®µçš„hooks\" class=\"headerlink\" title=\"renderé˜¶æ®µçš„hooks\"></a>renderé˜¶æ®µçš„hooks</h3><p>useStateã€useMemoã€useCallbackã€useRefã€useContextã€useReducerã€useEffectã€useLayoutEffect</p>\n<p>å…¶ä¸­useEffectã€useLayoutEffectè¿™ä¿©å…è®¸æ‰§è¡Œå‰¯ä½œç”¨çš„hookä¹Ÿæ˜¯åœ¨renderé˜¶æ®µæ‰§è¡Œçš„ã€‚ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œrenderé˜¶æ®µä¸æ˜¯ä¸è®©æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œå˜›ï¼Œè¿™ä¿©è™½ç„¶åœ¨renderé˜¶æ®µæ‰§è¡Œï¼Œä½†æ˜¯å®ƒä»¬çš„å›è°ƒå‡½æ•°ä¸åœ¨renderé˜¶æ®µæ‰§è¡Œã€‚</p>\n<h3 id=\"commité˜¶æ®µçš„hooks\"><a href=\"#commité˜¶æ®µçš„hooks\" class=\"headerlink\" title=\"commité˜¶æ®µçš„hooks\"></a>commité˜¶æ®µçš„hooks</h3><p>useEffectä¸useLayoutEffectçš„å›è°ƒå‡½æ•°ã€‚</p>\n<p>å…ˆè¯´useLayoutEffectã€‚è¿™ä¸ªhookä¼šåœ¨domæ›´æ–°å®Œæ¯•ï¼Œä½†æ˜¯æµè§ˆå™¨è¿˜æ²¡æœ‰æ¥å¾—åŠç»˜åˆ¶ä¹‹å‰åŒæ­¥æ‰§è¡Œã€‚è¿™å¥è¯æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘ä»¬çŸ¥é“javascriptåªæ˜¯ç”¨æ¥æ“ä½œdomï¼ŒåƒsetStateä¹‹ç±»æ“ä½œæˆ–è€…æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œdomåªæ˜¯æ”¹å˜äº†å†…å­˜é‡Œä¸€é¢—domæ ‘ä¸Šçš„æŸäº›èŠ‚ç‚¹ï¼ŒçœŸæ­£æŠŠdomæ ‘ç»˜åˆ¶æˆå±å¹•ä¸Šå½¢å½¢è‰²è‰²çš„ç”»é¢æ˜¯æµè§ˆå™¨å®Œæˆçš„ï¼Œå‡è®¾æˆ‘ä»¬æµè§ˆå™¨ä¸€ç§’ç»˜åˆ¶60å¸§ï¼Œé‚£ç»˜åˆ¶ä¸€å¸§çš„æ—¶é—´å°±æ˜¯16msï¼Œè€Œjavascriptæ˜¯å•çº¿ç¨‹è¯­è¨€ï¼Œæ‰§è¡Œjsä»£ç ä¸uiç»˜åˆ¶æ˜¯äº’æ–¥çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬åœ¨16mså†…ç”¨10msçš„æ—¶é—´æ¥æ›´æ–°domæ ‘ï¼Œé‚£ä¹ˆè¿˜å‰©æœ€å¤š6msç”¨æ¥æ‰§è¡ŒuseLayoutEffectã€‚</p>\n<p>æ‰€ä»¥è¿™ä¸ªhookå†…éƒ¨é€‚åˆæ‰§è¡Œä¸€äº›çŸ­å°ç²¾æ‚çš„ä»£ç ï¼Œå‡å¦‚æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œé‚£è¿™ä¸€æ¬¡æ›´æ–°å°±æ²¡æœ‰è¢«ç»˜åˆ¶ï¼Œäººå°±ä¼šæ„Ÿè§‰åˆ°å¡ã€‚</p>\n<p>å¯¹æ¯”ä»‹ç»ç±»ç»„ä»¶æ—¶ä¹Ÿæœ‰ä¸ªåœ¨commité˜¶æ®µæ‰§è¡Œçš„å‡½æ•°ï¼ŒgetSnapshotBeforeUpdateï¼ŒuseLayoutEffectä¸getSnapshotBeforeUpdateçš„æ‰§è¡Œæ—¶æœºå´æœ‰ç»†å¾®çš„å·®åˆ«ï¼Œå‰è€…æ˜¯åœ¨çœŸå®domæ›´æ–°å®Œæ¯•æµè§ˆå™¨è¿˜æœªç»˜åˆ¶ä¹‹å‰è§¦å‘ï¼Œè¿™æ—¶æ‹¿åˆ°çš„æ˜¯æ›´æ–°åçš„domï¼Œåè€…æ˜¯åœ¨çœŸå®domè¿˜æœªæ›´æ–°å³å°†æ›´æ–°æ—¶è§¦å‘ï¼Œè¿™æ—¶æ‹¿åˆ°çš„æ˜¯æ›´æ–°å‰çš„domã€‚</p>\n<p>æœ€åè¯´ä¸€ä¸‹useEffectï¼Œè¿™ä¸ªhookçš„å›è°ƒå‡½æ•°æ˜¯åœ¨commité˜¶æ®µæ‰§è¡Œå®Œæ¯•å¼‚æ­¥æ‰§è¡Œçš„ã€‚è¿™æ—¶domå·²ç»æ›´æ–°å®Œæ¯•å¹¶ä¸”æµè§ˆå™¨ä¹Ÿå®Œæˆäº†ç»˜åˆ¶ï¼Œå› ä¸ºæ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸åƒuseLayoutEffecté‚£ä¹ˆå°å¿ƒç¿¼ç¿¼çš„ã€‚</p>\n","categories":[],"tags":[]}